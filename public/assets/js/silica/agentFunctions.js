class _commissionPayment{constructor(e=0,t=0,n="",o="2021-01-01",a="2021-01-01",i=0,s=0,r=0,l=0,m="2021-01-01",c=0,d=0){this.companyid=e,this.userid=t,this.agentname=n,this.startdate=o,this.enddate=a,this.amountestimated=i,this.withholdingtaxamount=s,this.amounteprocessed=r,this.accountbank=l,this.processeddate=m,this.accountbanksource=c,this.sourceid=d}}var COMMISSION_PAYMENT_NEW=new _commissionPayment,COMMISSION_PAYMENT_PRODUCTS="";function agentListOnLoad(){try{showNotification(),checkUserStatusAfterExecute(function(){setTriggerButtonByText("txtAgentLISInitialDate","btAgentLisViewAll"),setTriggerButtonByText("txtAgentLISInitialDate","btAgentLisViewAll"),agentListDetails(),hideNotification()})}catch(e){showNotification(e.message,0)}}function agentListDetails(){try{var e=document.getElementById("txtAgentLISInitialDate").value,t=document.getElementById("txtAgentLISEndDate").value;showNotification();var n=new XMLHttpRequest,o="action=getGmeAgentList&initialDate="+e+"&endDate="+t;n.open("POST","_aqconections/agent_crud.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter(),document.getElementById("lbResultOnList").innerHTML=e.length;let n=document.getElementById("tblAgentLISDetailsTable");n.innerHTML="";var t=0;e.forEach(e=>(function(e){let o=JSON.parse(e);t+=1;let a=n.insertRow(-1);a.setAttribute("class","borderGray");let i=a.insertCell(-1);i.setAttribute("class","colRowNumber"),i.innerHTML=t;let s=a.insertCell(-1);s.setAttribute("class","colProductId"),s.innerHTML=o.id,a.insertCell(-1).innerHTML=o.userfullname,a.insertCell(-1).innerHTML=o.age,a.insertCell(-1).innerHTML=o.taxid,a.insertCell(-1).innerHTML=o.phone,a.insertCell(-1).innerHTML=o.email,a.insertCell(-1).innerHTML=o.iban;let r=a.insertCell(-1);r.style.textAlign="center",r.innerHTML=setLocalDate(o.entrydate,10);let l=a.insertCell(-1);l.style.textAlign="center",l.innerHTML=setLocalDate(o.lastActivity,16)})(e)),hideNotification()}},n.send(o)}catch(e){showNotification(e.message,0)}}function agentReportComissionOnLoad(){showNotification(""),checkUserStatusAfterExecute(function(){agentReportCommissionGetDetails(),setTriggerButtonByText("txtAgentRepComInitialDate","btAgentRepComViewAll"),setTriggerButtonByText("txtAgentRepComEndDate","btAgentRepComViewAll"),hideNotification()})}function agentReportCommissionGetDetails(){var e=document.getElementById("selAgentRepComCommissionStatus").value,t=document.getElementById("txtAgentRepComInitialDate").value,n=document.getElementById("txtAgentRepComEndDate").value;showNotification();var o=new XMLHttpRequest,a="action=getGmeCommissionReport&paymentStatus="+e+"&initialDate="+t+"&endDate="+n;o.open("POST","_aqconections/agent_crud.php",!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var a=JSON.parse(this.responseText);let o=document.getElementById("tblAgentRepComDetailsTable");o.innerHTML="";var i=0,s=0;a.forEach(a=>(function(a){i+=1;let r=JSON.parse(a),l=o.insertRow(-1);l.id="trCommissionReport"+r.id+t+n,l.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_COMMISSION_REPORT",l.id));let m=l.insertCell(-1);m.setAttribute("class","colRowNumber"),m.innerHTML=i,l.insertCell(-1).innerHTML=r.id,l.insertCell(-1).innerHTML=r.userfullname,l.insertCell(-1).innerHTML=r.iban;let c=l.insertCell(-1);c.setAttribute("class","colAmount");let d=Number(r.commission);if(s+=d,c.innerHTML=formatNumber(d),0==e&&d>0){let e=l.insertCell(-1);e.setAttribute("class","noPrint");let o=document.createElement("button");o.setAttribute("class","labelPayment"),o.type="button",o.innerHTML="Processar",o.onclick=function(){setSelectedRowOnClick(l,"SELECTED_ROW_COMMISSION_REPORT"),agentReportCommissionNewPayment(r,t,n)},e.appendChild(o)}})(a));let r=o.insertRow(-1);r.setAttribute("class","borderGray"),r.style.fontSize="large";let l=r.insertCell(-1);l.setAttribute("colspan","4"),l.style.textAlign="center",l.innerHTML="TOTAL".bold();let m=r.insertCell(-1);m.setAttribute("class","colAmount"),m.innerHTML=formatNumber(s).bold(),hideNotification()}},o.send(a)}function agentReportCommissionNewPayment(e,t,n){COMMISSION_PAYMENT_NEW.companyid=5e3,COMMISSION_PAYMENT_NEW.userid=e.id,COMMISSION_PAYMENT_NEW.agentname=e.userfullname,COMMISSION_PAYMENT_NEW.startdate=t,COMMISSION_PAYMENT_NEW.enddate=n,COMMISSION_PAYMENT_NEW.amountestimated=Number(e.commission),COMMISSION_PAYMENT_NEW.withholdingtaxamount=.065*Number(e.commission),COMMISSION_PAYMENT_NEW.amounteprocessed=.935*Number(e.commission),COMMISSION_PAYMENT_NEW.accountbank=e.iban,COMMISSION_PAYMENT_NEW.processeddate=setLocalDate(new Date,10),COMMISSION_PAYMENT_NEW.accountbanksource=-1,COMMISSION_PAYMENT_NEW.sourceid=SYSTEM_USER_STATUS.userId,showParts("divAgentRepComPaymentDetails"),document.getElementById("lbCommDetAgentName").innerHTML=COMMISSION_PAYMENT_NEW.agentname,document.getElementById("lbCommDetStartDate").innerHTML=t,document.getElementById("lbCommDetEndDate").innerHTML=n,document.getElementById("lbCommDetCommissionEstimated").innerHTML=formatNumber(COMMISSION_PAYMENT_NEW.amountestimated);var o=document.getElementById("numCommDetWithHoldingTaxAmount");o.value=COMMISSION_PAYMENT_NEW.withholdingtaxamount.toFixed(2),o.max=.9*COMMISSION_PAYMENT_NEW.amountestimated,document.getElementById("numCommDetCommissionToPay").value=COMMISSION_PAYMENT_NEW.amounteprocessed.toFixed(2),document.getElementById("lbCommDetIban").innerHTML=COMMISSION_PAYMENT_NEW.accountbank,document.getElementById("txtCommDetProcessedDate").value=COMMISSION_PAYMENT_NEW.processeddate,document.getElementById("selCommDetAccountBankSource").value=-1,agentReportCommissionNewDetails(COMMISSION_PAYMENT_NEW.userid,t,n)}function agentReportCommissionWithHoldingTaxChange(){var e=Number(document.getElementById("numCommDetWithHoldingTaxAmount").value);isNaN(e)&&(e=0),e<0&&(e=0),e>.9*Number(COMMISSION_PAYMENT_NEW.amountestimated)&&(e=.9*Number(COMMISSION_PAYMENT_NEW.amountestimated)),document.getElementById("numCommDetWithHoldingTaxAmount").value=e.toFixed(2),COMMISSION_PAYMENT_NEW.withholdingtaxamount=e,COMMISSION_PAYMENT_NEW.amounteprocessed=COMMISSION_PAYMENT_NEW.amountestimated-e,document.getElementById("numCommDetCommissionToPay").value=COMMISSION_PAYMENT_NEW.amounteprocessed.toFixed(2)}function agentReportCommissionNewDetails(e,t,n){COMMISSION_PAYMENT_PRODUCTS="0";var o=new XMLHttpRequest,a="action=getComissionReportNewPayment&companyId=5000&userId="+e+"&initialDate="+t+"&endDate="+n;o.open("POST","_aqconections/agent_crud.php",!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var e=JSON.parse(this.responseText);let n=document.getElementById("tblCommDetProductTable");n.innerHTML="";var t=0;e.forEach(e=>(function(e){t+=1;let o=JSON.parse(e),a=Number(o.sellerComission),i=Number(o.managerComission),s=Number(a+i);s,COMMISSION_PAYMENT_PRODUCTS+=", "+o.id;let r=n.insertRow(-1);r.setAttribute("class","borderGray");let l=r.insertCell(-1);l.setAttribute("class","colRowNumber"),l.innerHTML=t;let m=r.insertCell(-1);const c=o.invoicenumber;m.innerHTML=c,r.insertCell(-1).innerHTML=o.invoicedate,r.insertCell(-1).innerHTML=o.productDescription;let d=r.insertCell(-1);d.setAttribute("class","colAmount"),d.innerHTML=formatNumber(s).bold()})(e)),hideNotification()}},o.send(a)}function agentReportCommissionSavePayment(){var e=!1,t="";COMMISSION_PAYMENT_NEW.accountbanksource=document.getElementById("selCommDetAccountBankSource").value,COMMISSION_PAYMENT_NEW.processeddate=document.getElementById("txtCommDetProcessedDate").value,Number(COMMISSION_PAYMENT_NEW.accountbanksource)<=0&&(e=!0,t+="Deve indicar o banco de origem do pagamento. <br>");var n=new Date(COMMISSION_PAYMENT_NEW.startdate),o=new Date(COMMISSION_PAYMENT_NEW.enddate),a=new Date(COMMISSION_PAYMENT_NEW.processeddate);if(n.getTime()>o.getTime()&&(e=!0,t+="A data inicial não deve ser maior que a data final. <br>"),o.getTime()>=(new Date).getTime()&&(e=!0,t+="A data final deve ser inferior a data actual. <br>"),o.getTime()>=a.getTime()&&(e=!0,t+="A data final deve ser inferior a data de processamento. <br>"),"0"==COMMISSION_PAYMENT_PRODUCTS&&(e=!0,t+="Não foram encontrados produtos / serviços com comissões por processar. <br>"),e)return alert(t),!1;var i="&commissionPaymentInfo="+JSON.stringify(COMMISSION_PAYMENT_NEW);i+="&productsInProcess="+COMMISSION_PAYMENT_PRODUCTS,showNotification();var s=new XMLHttpRequest,r="action=saveGmeAgentCommissionPayment"+i;i="_aqconections/agent_crud.php";s.open("POST",i,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var e=JSON.parse(this.responseText);1==e.status?(showNotification(e.msg,1),hideParts("divAgentRepComPaymentDetails")):showNotification(e.msg,1)}},s.send(r)}function agentPaymentProcessedOnLoad(){showNotification(""),checkUserStatusAfterExecute(function(){agentPaymentProcessedList(),setTriggerButtonByText("txtAgentPayProcInitialDate","btAgentPayProcViewAll"),setTriggerButtonByText("txtAgentPayProcEndDate","btAgentPayProcViewAll"),hideNotification()})}function agentPaymentProcessedList(e=-1){var t=document.getElementById("txtAgentPayProcInitialDate").value,n=document.getElementById("txtAgentPayProcEndDate").value;showNotification();var o=new XMLHttpRequest,a="action=getGmePaymentProcessed&userId="+e+"&initialDate="+t+"&endDate="+n;o.open("POST","_aqconections/agent_crud.php",!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var e=JSON.parse(this.responseText);e.length<=0&&showNotification("Não encontrado.",0),document.getElementById("lbResultOnList").innerHTML=e.length;let o=document.getElementById("tblAgentProcDetailsTable");o.innerHTML="";var t=0,n=0,a=0,i=0;e.forEach(e=>(function(e){t+=1;let s=JSON.parse(e),r=o.insertRow(-1);r.id="trCommissionReport"+s.id,r.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_AGENT_PAYMENT",r.id));let l=r.insertCell(-1);l.setAttribute("class","colRowNumber"),l.innerHTML=t,r.insertCell(-1).innerHTML=s.userid,r.insertCell(-1).innerHTML=s.agentName;let m=r.insertCell(-1);m.setAttribute("class","colProductId"),m.innerHTML=setLocalDate(s.startdate,10);let c=r.insertCell(-1);c.setAttribute("class","colProductId"),c.innerHTML=setLocalDate(s.enddate,10);let d=r.insertCell(-1);d.setAttribute("class","colAmount");let u=Number(s.amountestimated);n+=u,d.innerHTML=formatNumber(u);let N=r.insertCell(-1);N.setAttribute("class","colAmount");let M=Number(s.withholdingtaxamount);a+=M,N.innerHTML=formatNumber(M);let C=r.insertCell(-1);C.setAttribute("class","colAmount");let g=Number(s.amounteprocessed);i+=g,C.innerHTML=formatNumber(g),r.insertCell(-1).innerHTML=s.accountbank;let T=r.insertCell(-1);T.setAttribute("class","colProductId"),T.innerHTML=setLocalDate(s.processeddate,10);let E=r.insertCell(-1);var I=s.paymentstatus;E.innerHTML=getDocumentStatus(I),"A"==I&&(E.style.color="red");r.insertCell(-1).innerHTML=getFirtLastName(s.opratorName)+" ["+s.sourceidstatus+"]";let S=r.insertCell(-1);S.setAttribute("class","colProductId"),S.innerHTML=setLocalDate(s.statusdate,16);let b=r.insertCell(-1);b.setAttribute("class","noPrint");let A=document.createElement("button");A.setAttribute("class","labelDetail"),A.type="button",A.onclick=function(){setSelectedRowOnClick(r,"SELECTED_ROW_AGENT_PAYMENT"),agentReportCommissionPaymentDetail(s)},b.appendChild(A)})(e));let s=o.insertRow(-1);s.setAttribute("class","borderGray"),s.style.fontSize="large";let r=s.insertCell(-1);r.setAttribute("colspan","5"),r.style.textAlign="center",r.innerHTML="TOTAL".bold();let l=s.insertCell(-1);l.setAttribute("class","colAmount"),l.innerHTML=formatNumber(n).bold();let m=s.insertCell(-1);m.setAttribute("class","colAmount"),m.innerHTML=formatNumber(a).bold();let c=s.insertCell(-1);c.setAttribute("class","colAmount"),c.innerHTML=formatNumber(i).bold(),hideNotification()}},o.send(a)}function agentReportCommissionPaymentDetail(e){showParts("divAgentPayProcPaymentDetails");var t=e.paymentstatus;const n=document.getElementById("btCommDetCancelDocument");checkPermission("6104")&&"A"!=t?n.style.display="inline":hideParts("btCommDetCancelDocument"),hideParts("btCommDetFinish"),"A"!=t?hideParts("divCanceledDocument"):showParts("divCanceledDocument"),showParts("divCommDetDocumentNumber"),document.getElementById("lbCommDetDocumentNumber").innerHTML=e.id,document.getElementById("lbCommDetAgentName").innerHTML=e.agentName,document.getElementById("lbCommDetStartDate").innerHTML=setLocalDate(e.startdate,10),document.getElementById("lbCommDetEndDate").innerHTML=setLocalDate(e.enddate,10),document.getElementById("lbCommDetCommissionEstimated").innerHTML=formatNumber(e.amountestimated);var o=document.getElementById("numCommDetWithHoldingTaxAmount");o.value=Number(e.withholdingtaxamount).toFixed(2),o.disabled="true",document.getElementById("numCommDetCommissionToPay").value=Number(e.amounteprocessed).toFixed(2),document.getElementById("lbCommDetIban").innerHTML=e.accountbank,document.getElementById("txtCommDetProcessedDate").value=setLocalDate(e.processeddate,10);var a=document.getElementById("selCommDetAccountBankSource");a.value=e.accountbanksource,a.disabled="true",agentPaymentProcessedDetailDetails(e.id,e.userid),document.getElementById("btCommDetRealCancel").onclick=function(){agentPaymentProcessedCancel(e.id)}}function agentPaymentProcessedDetailDetails(e,t){var n=new XMLHttpRequest,o="action=getPaymentProcessedDetail&paymentAgentId="+e+"&userId="+t;n.open("POST","_aqconections/agent_crud.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(this.responseText);let n=document.getElementById("tblCommDetProductTable");n.innerHTML="";var t=0;e.forEach(e=>(function(e){t+=1;let o=JSON.parse(e),a=Number(o.sellerComission),i=Number(o.managerComission),s=Number(a+i);s;let r=n.insertRow(-1);r.setAttribute("class","borderGray");let l=r.insertCell(-1);l.setAttribute("class","colRowNumber"),l.innerHTML=t;let m=r.insertCell(-1);const c=o.invoicenumber;m.innerHTML=c,r.insertCell(-1).innerHTML=o.invoicedate,r.insertCell(-1).innerHTML=o.productDescription;let d=r.insertCell(-1);d.setAttribute("class","colAmount"),d.innerHTML=formatNumber(s).bold()})(e)),hideNotification()}},n.send(o)}function agentPaymentProcessedCancel(e){var t=SYSTEM_USER_STATUS.userId;showNotification();var n=new XMLHttpRequest,o="action=cancelGmeAgentCommissionPayment&agentPaymentId="+e+"&sourceId="+t;n.open("POST","_aqconections/agent_crud.php",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(this.responseText);1==e.status?(showNotification(e.msg,1),hideParts("divCommDetCancelDocument"),hideParts("divAgentPayProcPaymentDetails"),agentPaymentProcessedList()):showNotification(e.msg,1)}},n.send(o)}