class _payment{constructor(e,t=0,n=10,a="RG",i="2021",o=1,r="",s="",m=-1,l="",c="",d=0,u="",E="2021-01-01",N=0,T=0,p=0,y=0,I=0,S=0,h=0,A=1,P="",M="",_="",v=0,b=0,g=0,f=0,L=0,R=1,Y="",C=""){this.companyid=e,this.dependencyid=t,this.request=n,this.invoicetype=a,this.invoiceserie=i,this.invoicesequence=o,this.invoicenumber=r,this.description=s,this.sourceid=m,this.contractid=l,this.cil=c,this.customerid=d,this.originatingon=u,this.invoicedate=E,this.nInstallment=N,this.totalInvoice=T,this.diference=p,this.change=y,this.balance=I,this.paymentamount=S,this.ramaining=h,this.taxGroup=A,this.extraNote=P,this.WithholdingTaxType=M,this.WithholdingTaxDescription=_,this.WithholdingTaxAmount=v,this.coordinatorUser=b,this.managerUser=g,this.directorGeneralUser=f,this.administratorUser=L,this.partnershipUser=R,this.email=Y,this.phone=C}}class _paymentImport{constructor(e=0,t=0,n="",a="",i="",o="2021-01-01",r=0,s=0,m=1){this.companyid=e,this.dependencyid=t,this.customertid=n,this.companyname=a,this.invoiceNumber=i,this.invoicedate=o,this.totalinvoice=r,this.userId=s,this.status=m}}var PAYMENT_NEW=new _payment,PAYMENT_INSTALLMENTS=[],PAYMENT_PAYMENTS=[];function paymentOnLoad(e){try{showNotification(),checkUserStatusAfterExecute(function(){setDocumentType(""),setPaymentMechanism(""),setInstallmentStatus("");let e=document.getElementById("divButtonsBar");e.innerHTML="";var t=sessionStorage.getItem("invoiceInvoiceInvoiceNumber");if(null!=t&&""!=t){const n=document.createElement("button");n.setAttribute("class","mainButton labelNew-RedDard"),n.type="button",n.innerHTML="Pendente",n.style.display="inline",n.style.animation="blink-text 1.0s step-end infinite",n.onclick=function(){paymentSetNew(JSON.parse(t)),n.style.display="none"},sessionStorage.setItem("invoiceInvoiceInvoiceNumber",""),e.appendChild(n)}let n=document.createElement("button");n.setAttribute("class","mainButton labelNew-RedDard"),n.type="button",n.innerHTML="Novo recibo",n.style.marginLeft="5px",n.onclick=function(){showDivSearcher("divVDRecDocumentSearch","btDocProSearch")},e.appendChild(n);let a=document.createElement("button");a.setAttribute("class","mainButton labelPayment-RedDark"),a.type="button",a.innerHTML="Pagamento",a.style.marginLeft="5px",a.onclick=function(){showDivPayment("divVDFactPayment","VDREC")},e.appendChild(a);let i=document.createElement("button");i.setAttribute("class","mainButton labelValidate finishButton"),i.type="button",i.innerHTML="FINALIZAR RECIBO",i.style.marginLeft="5px",i.onclick=function(){showParts("divVDFactFinish")},e.appendChild(i),setElementInnerHtml("lbVDRecContractId","..."),setElementInnerHtml("lbVDRecCIL","..."),document.getElementById("lbVDRecCustomerName").innerHTML="Cliente",document.getElementById("lbVDRecCustomerTaxId").innerHTML="...",document.getElementById("lbVDRecInvoiceNumber").innerHTML="FT 00000/0",document.getElementById("lbVDRecInvoiceDate").innerHTML="00/00/2000",document.getElementById("lbVDRecInvoiceAmount").innerHTML="0,00",document.getElementById("lbVDRecInvoicePaymentAmount").innerHTML="0,00",document.getElementById("lbVDRecToPayAmount").innerHTML="0,00",document.getElementById("lbVDRecInstallements").innerHTML="0",document.getElementById("tblVDRecInstallmentInFault").innerHTML="",fillSelectPaymentMechanism("selRecPagPaymentMecanism"),document.getElementById("tblRecPagPaymentsTable").innerHTML="",invoiceBillingSettingGet(),hideNotification()})}catch(e){showNotification(e.message,0)}}function paymentSetNew(e,t=10){try{var n=invoiceDucumentSerie("RG",t);(PAYMENT_NEW=new _payment).companyid=e.companyid,PAYMENT_NEW.dependencyid=SYSTEM_USER_STATUS.workplaceId,PAYMENT_NEW.request=t,PAYMENT_NEW.invoicetype="RG",PAYMENT_NEW.invoiceserie=n,PAYMENT_NEW.invoicesequence=1,PAYMENT_NEW.invoicenumber="RG "+n+"/1",PAYMENT_NEW.sourceid=SYSTEM_USER_STATUS.userId,PAYMENT_NEW.contractid=e.contractid,PAYMENT_NEW.cil=e.cil,PAYMENT_NEW.customerid=e.customerid,PAYMENT_NEW.originatingon=e.invoicenumber,PAYMENT_NEW.invoicedate=e.transactiondate,PAYMENT_NEW.taxGroup=SYSTEM_USER_STATUS.taxGroup,PAYMENT_NEW.coordinatorUser=SYSTEM_USER_STATUS.coordinatorUser,PAYMENT_NEW.managerUser=SYSTEM_USER_STATUS.managerUser,PAYMENT_NEW.directorGeneralUser=SYSTEM_USER_STATUS.directorGeneralUser,PAYMENT_NEW.administratorUser=SYSTEM_USER_STATUS.administratorUser,PAYMENT_INSTALLMENTS=[],INVOICE_PAYMENTS=[],setElementInnerHtml("lbVDRecContractId",e.contractid),setElementInnerHtml("lbVDRecCIL",e.cil),setElementInnerHtml("lbVDRecCustomerName",e.newCustomerName),setElementInnerHtml("lbVDRecCliente",e.newCustomerName),setElementInnerHtml("lbVDRecCustomerTaxId",e.newTaxId),PAYMENT_NEW.email=e.email,PAYMENT_NEW.phone=e.phone,setElementInnerHtml("tblRecPagPaymentsTable","");const r=document.getElementById("lbVDRecInstallements"),s=document.getElementById("tblVDRecInstallmentInFault");r.innerHTML="0",s.innerHTML="";var a=new XMLHttpRequest,i="action=getPostSaleInstallmentInFault&companyId="+e.companyid+"&contractid="+e.contractid,o=URL_SA_POST_SALE_X;a.open("POST",o,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){try{var e=JSON.parse(a.responseText)}catch(e){showHttpResponseText(a)}var t=0,n=0,i=0,o=0;PAYMENT_NEW.nInstallment=e.length,r.innerHTML=e.length,e.forEach(e=>(function(e){let a=JSON.parse(e);PAYMENT_INSTALLMENTS[Number(t)]={id:a.id,originatingon:a.originatingon,invoicedate:a.invoicedate,installment:a.installment,installmentdate:a.installmentdate,paymentamount:a.paymentamount,realpaymentamount:a.realpaymentamount,paymentinfault:a.paymentinfault,installmentstatus:a.installmentstatus,statuschange:0};var r=setLocalDate(a.installmentdate),m=new Date;t+=1,n+=Number(a.paymentamount),i+=Number(a.paymentinfault),o+=Number(a.realpaymentamount);let l=s.insertRow(-1);l.setAttribute("class","borderGray"),"PT"!=a.installmentstatus&&(l.style.fontWeight="bold",r.getTime()<m.getTime()&&(l.style.color="red",a.installment=a.installment+" - Atrasada"));let c=l.insertCell(l.cells.length);c.setAttribute("class","colRowNumber"),c.innerHTML=t,c.style.width="10px",l.insertCell(l.cells.length).innerHTML=a.originatingon,l.insertCell(l.cells.length).innerHTML=setLocalDate(a.invoicedate,10),l.insertCell(l.cells.length).innerHTML=a.installment,l.insertCell(l.cells.length).innerHTML=r.toISOString().slice(0,10);let d=l.insertCell(l.cells.length);d.style.textAlign="center",d.style.paddingRight="10px",d.style.whiteSpace="nowrap",d.innerHTML=formatNumber(a.paymentamount);let u=l.insertCell(l.cells.length);u.style.textAlign="center",u.style.paddingRight="10px",u.style.whiteSpace="nowrap",u.innerHTML=formatNumber(a.paymentinfault),l.insertCell(l.cells.length).innerHTML=INSTALLMENT_STATUS[a.installmentstatus]})(e)),PAYMENT_NEW.totalInvoice=i,setElementInnerHtml("lbVDRecInvoiceAmount",formatNumber(n)),setElementInnerHtml("lbVDRecInvoicePaymentAmount",formatNumber(o)),setElementInnerHtml("lbVDRecToPayAmount",formatNumber(i)),setElementInnerHtml("lbVDRecAmountToPay",formatNumber(i)),paymentCalculatePayment("")}},a.send(i),customerGetCreditAccount(e.customerid)}catch(e){showNotification(e.message,0)}}function paymentCalculatePayment(e){var t=0,n=0,a=0,i=Number(PAYMENT_NEW.totalInvoice);INVOICE_PAYMENTS.forEach(e=>(function(e){t+=Number(e.amount),1!=e.mechanism?a+=Number(e.amount):n+=Number(e.amount)})(e));var o=t-i,r=0,s=0;o>0&&(a>i?(s=a-i,r=n):r=o>n?n:o),"NA"==PAYMENT_NEW.invoicetype&&(s=t),PAYMENT_NEW.diference=o,PAYMENT_NEW.change=r,PAYMENT_NEW.balance=s,PAYMENT_NEW.paymentamount=t,PAYMENT_NEW.ramaining=Number(i-t),Number(PAYMENT_NEW.ramaining)<0&&(PAYMENT_NEW.ramaining=0),document.getElementById("lbRecPagPaymentAmount").innerHTML=formatNumber(t),document.getElementById("lbVDRecAmountPayed").innerHTML=formatNumber(t),document.getElementById("lbRecPagDocumentAmount").innerHTML=formatNumber(i),document.getElementById("lbVDRecChange").innerHTML=formatNumber(r),document.getElementById("lbVDRecBalance").innerHTML=formatNumber(s),document.getElementById("lbRecPagChange").innerHTML=formatNumber(r),document.getElementById("lbRecPagBalance").innerHTML=formatNumber(s);var m=document.getElementById("lbRecPagDiference");m.innerHTML=formatNumber(o),Number(o)<0?m.style.color="red":m.style.color="blue",document.getElementById("lbVDRecDiference").innerHTML=formatNumber(o),paymentCanFinishDocument("")}function paymentCanFinishDocument(e){var t=!0,n="";const a=document.getElementById("lbVDCustomerMissing"),i=document.getElementById("lbVDEmptyDocument"),o=document.getElementById("lbVDTotalAmountIsZero"),r=document.getElementById("lbVDPaymentMissing"),s=document.getElementById("lbVDPaymentHigher");return a.style.display="none",i.style.display="none",o.style.display="none",r.style.display="none",s.style.display="none",PAYMENT_NEW.nInstallment<=0&&(t=!1,n+="Documento vazio. <br>",i.style.display="block"),PAYMENT_NEW.paymentamount<=0&&(t=!1,n+="Valor insuficiente. <br>","btFinish"==e&&(showParts("divVDFactPayment"),hideParts("divVDFactFinish")),r.style.display="block"),PAYMENT_NEW.balance>0&&(checkPermission("0206")?showNotification("Atenção: Está a gerar adiantamento (saldo em conta corrente)"):(t=!1,n+="Valor do pagamento superior a valor do documento. <br>",s.style.display="block")),PAYMENT_NEW.extraNote=reviewString(document.getElementById("txtVDRecFinalNote")),document.getElementById("lbVDRecMessage").innerHTML=n,"btFinish"==e&&(1==ST_SA_WAITING_SERVER&&(n+="Aguardando resposta do servidor. <br>"),""!=n&&showNotification(n,0)),t}function paymentFinishDocument(e){if(0!=paymentCanFinishDocument("btFinish")){showConfirm("Tem a certeza que deseja finalizar este recibo?",function(){PAYMENT_NEW.description=PAYMENT_NEW.paymentamount>=PAYMENT_NEW.totalInvoice?"Pagamento total":"Pagamento parcial";var e="&newPayment="+JSON.stringify(PAYMENT_NEW);e+="&invoicePayments={";var t=0;INVOICE_PAYMENTS.forEach(n=>(function(n){Number(n.amount)>0&&(0!=t&&(e+=","),e+='"'+t+'":'+JSON.stringify(n),t+=1)})(n)),e+="}";var n=Number(PAYMENT_NEW.paymentamount);e+="&paymentInstallments={",t=0,PAYMENT_INSTALLMENTS.forEach(a=>(function(a){n>0&&"PT"!=a.installmentstatus&&(n<Number(a.paymentinfault)?(a.realpaymentamount=n,a.installmentstatus="PP"):(a.realpaymentamount=a.paymentinfault,a.installmentstatus="PT"),a.statuschange=1,n-=Number(a.realpaymentamount)),0!=t&&(e+=","),e+='"'+t+'":'+JSON.stringify(a),t+=1})(a)),e+="}",showNotification(),ST_SA_WAITING_SERVER=1;var a=new XMLHttpRequest,i="action=savePaymentNew"+e;e=URL_SA_PAYMENT_X,a.open("POST",e,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){ST_SA_WAITING_SERVER=0;var e=JSON.parse(this.responseText);if(1==e.status){var t=document.getElementById("lbHearderCompanyName").innerHTML,n=document.getElementById("lbVDRecCustomerName").innerHTML,i=e.invoiceNumber,o=e.in,r=DOCUMENT_TYPE[o.slice(0,2)]+" nº"+o;showPrintOptions(function(){paymentPrintReceipt(i)},function(){paymentPrintA4(i)},function(){var e=document.getElementById("txtPriPrevCustomerEmail").value;paymentSendByEmail(i,t,r,n,e)},function(){var e=document.getElementById("btPriPrevSendWhatsApp").value;paymentSendByWhatsApp(i,r,n,e)},PAYMENT_NEW.email,PAYMENT_NEW.phone),setTimeout(function(){hideParts("divVDFactFinish"),paymentOnLoad("")},2e3)}else showNotification(e.msg,0)}},a.send(i)})}}function paymentAdvanceOnLoad(e){try{showNotification(),checkUserStatusAfterExecute(function(){setDocumentType(""),setPaymentMechanism(""),setInstallmentStatus(""),setElementInnerHtml("lbVDAdianContractId","..."),setElementInnerHtml("lbVDAdianCIL","..."),setElementInnerHtml("lbVDAdianCustomerName","Cliente"),setElementInnerHtml("lbVDAdianCustomerTaxId","..."),fillSelectPaymentMechanism("selRecPagPaymentMecanism"),document.getElementById("tblRecPagPaymentsTable").innerHTML="",hideNotification()})}catch(e){showNotification(e.message,0)}}function paymentAdvanceSetNew(e,t,n,a,i,o="",r=""){try{var s=invoiceDucumentSerie("NA");(PAYMENT_NEW=new _payment).companyid=SYSTEM_USER_STATUS.companyId,PAYMENT_NEW.dependencyid=SYSTEM_USER_STATUS.workplaceId,PAYMENT_NEW.request=10,PAYMENT_NEW.invoicetype="NA",PAYMENT_NEW.invoiceserie=s,PAYMENT_NEW.invoicesequence=1,PAYMENT_NEW.invoicenumber="NA "+s+"/1",PAYMENT_NEW.sourceid=SYSTEM_USER_STATUS.userId,PAYMENT_NEW.contractid=e,PAYMENT_NEW.cil=t,PAYMENT_NEW.customerid=n,PAYMENT_NEW.originatingon="",PAYMENT_NEW.invoicedate=new Date,PAYMENT_NEW.totalInvoice=0,PAYMENT_NEW.taxGroup=SYSTEM_USER_STATUS.taxGroup,PAYMENT_NEW.coordinatorUser=SYSTEM_USER_STATUS.coordinatorUser,PAYMENT_NEW.managerUser=SYSTEM_USER_STATUS.managerUser,PAYMENT_NEW.directorGeneralUser=SYSTEM_USER_STATUS.directorGeneralUser,PAYMENT_NEW.administratorUser=SYSTEM_USER_STATUS.administratorUser,PAYMENT_INSTALLMENTS=[],INVOICE_PAYMENTS=[],setElementInnerHtml("lbVDAdianContractId",e),setElementInnerHtml("lbVDAdianCIL",t),setElementInnerHtml("lbVDAdianCustomerName",a),setElementInnerHtml("lbVDAdianCustomerTaxId",i),setElementInnerHtml("lbVDRecCliente",a),PAYMENT_NEW.email=o,PAYMENT_NEW.phone=r,document.getElementById("tblRecPagPaymentsTable").innerHTML=""}catch(e){showNotification(e.message,0)}}function paymentAdvanceCanFinishDocument(e){var t=!0,n="";return Number(PAYMENT_NEW.customerid)<=0&&(t=!1,n+="Deve indicar o cliente. <br>"),INVOICE_PAYMENTS.length<=0&&(t=!1,n+="Valor insuficiente. <br>","btFinish"==e&&(showParts("divVDFactPayment"),hideParts("divVDFactFinish"))),PAYMENT_NEW.extraNote=reviewString(document.getElementById("txtVDRecFinalNote")),document.getElementById("lbVDRecMessage").innerHTML=n,"btFinish"==e&&(1==ST_SA_WAITING_SERVER&&(t=!1,n+="Aguardando resposta do servidor. <br>"),t||alert(n)),t}function paymentAdvanceFinishDocument(e){if(0!=paymentAdvanceCanFinishDocument("btFinish")){showConfirm("Tem a certeza que deseja finalizar este recibo?",function(){PAYMENT_NEW.description="Adiantamento";var e="&newPayment="+JSON.stringify(PAYMENT_NEW);e+="&invoicePayments={";var t=0;INVOICE_PAYMENTS.forEach(n=>(function(n){Number(n.amount)>0&&(0!=t&&(e+=","),e+='"'+t+'":'+JSON.stringify(n),t+=1)})(n)),e+="}",Number(PAYMENT_NEW.paymentamount),e+="&paymentInstallments={",e+="}",showNotification(),ST_SA_WAITING_SERVER=1;var n=new XMLHttpRequest,a="action=savePaymentNew"+e;e=URL_SA_PAYMENT_X,n.open("POST",e,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){ST_SA_WAITING_SERVER=0;var e=JSON.parse(this.responseText);if(1==e.status){var t=document.getElementById("lbHearderCompanyName").innerHTML,a=document.getElementById("lbVDAdianCustomerName").innerHTML,i=e.invoiceNumber,o=e.in,r=DOCUMENT_TYPE[o.slice(0,2)]+" nº"+o;showPrintOptions(function(){paymentPrintReceipt(i)},function(){paymentPrintA4(i)},function(){var e=document.getElementById("txtPriPrevCustomerEmail").value;paymentSendByEmail(i,t,r,a,e)},function(){var e=document.getElementById("btPriPrevSendWhatsApp").value;paymentSendByWhatsApp(i,r,a,e)},PAYMENT_NEW.email,PAYMENT_NEW.phone),setTimeout(function(){hideParts("divVDFactFinish"),paymentAdvanceOnLoad("")},2e3)}else hideNotification()}},n.send(a)})}}var PAYMENT_IMPORT_LINES=[];function salePaymentImportLoteOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){PAYMENT_IMPORT_LINES=[],"GME"==e?showParts("divSaleInvImpLoteNUS"):hideParts("divSaleInvImpLoteNUS"),hideNotification()})}function salePaymentImportLoteAddPayment(e=0){showNotification();let t=document.getElementById("tblSaleInvImpLoteMainTable");var n=Number(t.rows.length)+1,a=new _paymentImport;0!=e?a=e:a.invoicedate=setLocalDate(new Date,10),a.status=1,PAYMENT_IMPORT_LINES[Number(n-1)]=a;let i=t.insertRow(-1);i.setAttribute("class","borderGray"),i.setAttribute("id","rowSaleInvImpLote"+n);let o=i.insertCell(-1);o.style.width="10px",o.setAttribute("class","colRowNumber"),o.innerHTML=n;let r=i.insertCell(-1);r.style.width="100px";let s=document.createElement("input");s.setAttribute("class","textUpperUcase"),s.id="txtSaleInvImpLoteCustomerId"+n,s.type="text",s.maxlength="95",s.value=a.customertid,s.onchange=function(){salePaymentImportLoteOnChange(n,this,"customertid")},r.appendChild(s);let m=i.insertCell(-1);m.style.width="150px";let l=document.createElement("input");l.setAttribute("class","textUpperUcase"),l.id="txtSaleInvImpLoteCompanyName"+n,l.type="text",l.maxlength="95",l.value=a.companyname,l.onchange=function(){salePaymentImportLoteOnChange(n,this,"companyname")},m.appendChild(l);let c=i.insertCell(-1);c.style.width="50px";let d=document.createElement("input");d.setAttribute("class","textUpperUcase"),d.id="txtSaleInvImpLoteInvoiceNumber"+n,d.type="text",d.maxlength="95",d.value=a.invoiceNumber,d.onchange=function(){salePaymentImportLoteOnChange(n,this,"invoiceNumber")},c.appendChild(d);let u=i.insertCell(-1);u.style.width="70px";let E=document.createElement("input");E.id="txtSaleInvImpLoteInvDate"+n,E.type="date",E.value=a.invoicedate,E.onchange=function(){salePaymentImportLoteOnChange(n,this,"invoicedate")},u.appendChild(E);let N=i.insertCell(-1);N.style.width="150px";let T=document.createElement("input");T.setAttribute("class","textUpperUcase"),T.id="txtSaleInvImpLoteTotalInvoice"+n,T.type="number",T.min="0",T.value=a.totalinvoice,T.onchange=function(){salePaymentImportLoteOnChange(n,this,"totalinvoice")},N.appendChild(T);let p=i.insertCell(-1);var y=document.createElement("button");y.setAttribute("class","labelRemove"),y.type="button",y.onclick=function(){PAYMENT_IMPORT_LINES[Number(n-1)].status=0,i.innerHTML=""},p.appendChild(y),p.style.textAlign="center",p.style.width="10px",hideNotification()}function salePaymentImportLoteOnChange(e,t,n,a=!1){var i=t.value;a||(i=reviewString(t).toString().toUpperCase(),t.value=i),PAYMENT_IMPORT_LINES[Number(e)-1][n]=i}function salePaymentImportLoteCleanTable(){PAYMENT_IMPORT_LINES=[],cleanElement("tblSaleInvImpLoteMainTable")}function salePaymentImportLoteAddInvoiceFromCSV(){document.getElementById("txtSaleInvImpLoteCSV").value.split("/-.").forEach(e=>(function(e){var t=new _paymentImport,n=e.split(";");t.customertid=n[0].trim().toUpperCase(),t.companyname=n[1].toUpperCase(),t.invoiceNumber=n[2].toUpperCase(),t.invoicedate=setLocalDate(n[3],10),t.totalinvoice=n[4],salePaymentImportLoteAddPayment(t)})(e))}function salePaymentImportLoteSave(e){if(salePaymentImporteLoteCheckMandatoryField())return!1;if(salePaymentImportLoteCheckDucplicateInfo("invoiceNumber","Nº do recibo"))return!1;if(1==ST_SA_WAITING_SERVER)return alert("Aguardando resposta do servidor. <br>"),!1;var t=SYSTEM_USER_STATUS.companyId,n=SYSTEM_USER_STATUS.workplaceId;if("GME"==e){if(t=reviewString(document.getElementById("txtSaleInvImpLoteNUS")),isNaN(t)||""==t)return alert("Deve indicar o código NUS da empresa"),!1;if(n=reviewString(document.getElementById("txtSaleInvImpLoteDependency")),isNaN(n)||""==n)return alert("Deve indicar a filial de destino."),!1}var a=document.getElementById("divSaleInvImpLoteResulte");a.innerHTML="",showNotification("Esta operação pode demorar alguns minutos.");for(var i=0;i<PAYMENT_IMPORT_LINES.length;i++){var o=i+1,r=_paymentImport;(r=PAYMENT_IMPORT_LINES[i]).companyid=t,r.dependencyid=n,r.userId=SYSTEM_USER_STATUS.userId,1==r.status&&s(r,o)}function s(e,t){ST_SA_WAITING_SERVER=1;var n=new XMLHttpRequest,i="action=savePaymentImportLote&invoiceInfo="+JSON.stringify(e),o=URL_SA_PAYMENT_X;n.open("POST",o,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;try{var i=JSON.parse(n.responseText)}catch(e){return showHttpResponseText(n),!1}let o=document.createElement("span");o.innerHTML="Linha "+t+", Cliente "+e.customertid+", nome "+e.companyname+", Factura "+e.invoiceNumber+". Mensagem: "+i.msg,a.appendChild(o),1!=i.status?(document.getElementById("rowSaleInvImpLote"+t).style.color="red",o.style.color="red"):(document.getElementById("rowSaleInvImpLote"+t).style.color="gray",e.status=0),hideNotification()}},n.send(i)}}function salePaymentImporteLoteCheckMandatoryField(){if(PAYMENT_IMPORT_LINES.length<=0)return alert("Não foram adicionadas linhas."),!1;for(var e=!1,t="",n=0;n<PAYMENT_IMPORT_LINES.length;n++){var a,i="";if(1==(a=PAYMENT_IMPORT_LINES[n]).status){""==a.customertid&&(i+="Deve indicar o cliente. "),""==a.invoiceNumber&&(i+="Deve indicar o número da factura. ");var o=new Date(a.invoicedate);validateDate(o)||(i+="Data do recibo fora do formato. "),isNaN(a.totalinvoice)||""==a.totalinvoice?i+="O valor do recibo deve ser numérico. ":Number(a.totalinvoice)<=0&&(i+="O valor do recibo deve ser superior a zero. "),""!=i&&(e=!0,t+=i="Linha "+Number(n+1)+": "+i+" <br>")}}return e&&alert(t),e}function salePaymentImportLoteCheckDucplicateInfo(e,t){if(PAYMENT_IMPORT_LINES.length<=0)return alert("Não foram adicionadas linhas."),!1;for(var n=!1,a="",i=[],o=0;o<PAYMENT_IMPORT_LINES.length;o++){var r=PAYMENT_IMPORT_LINES[o];if(1==r.status&&!i.includes(r[e])){i[o]=r[e];for(var s=0;s<PAYMENT_IMPORT_LINES.length;s++)if(o!=s){var m=PAYMENT_IMPORT_LINES[s];1==m.status&&r[e]==m[e]&&(a+="Duplicado "+t+" "+r[e]+" Linhas "+Number(o+1)+" / "+Number(s+1)+" <br>",n=!0)}}}return n&&alert(a),n}function paymentReviewBalance(){showNotification(),ST_SA_WAITING_SERVER=1;var e=new XMLHttpRequest,t=URL_SA_PAYMENT_X;e.open("POST",t,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){ST_SA_WAITING_SERVER=0;var t=JSON.parse(this.responseText);1==t.status?showNotification(t.msg,1):showNotification(t.msg,0)}},e.send("action=reviewBalanceInCurrentAccount")}