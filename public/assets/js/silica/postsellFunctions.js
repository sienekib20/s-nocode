var POST_SALE_VIEW_DETAIL_DOCUMENTS_TARGET=[];function postSaleOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setDocumentType(""),setPaymentMechanism(""),fillSelectDependencyFull("selVDPFactDependency",-1,1),checkPermission("0203")&&setElementValue("selVDPFactDocumentType",3),setTriggerButtonByText("txtVDPFactDocumentNumber","btVDPFactDocumentNumber"),setTriggerButtonByText("txtVDPFactEmissionDate","btVDPFactEmissionDate"),setSessionResultSearch("numVDPFactResults"),hideNotification()})}function postsellGetDocuments(e=-1,t=-1,n=-1,i=-1,o=-1){var a={};if(a.companyId=SYSTEM_USER_STATUS.companyId,a.dependencyId=Number(document.getElementById("selVDPFactDependency").value),a.dependencyId<=0&&Number(SYSTEM_USER_STATUS.billingprofile)<BILLING_PROFILE_PARTNER_INDEX)return showNotification("Seleccionar uma filial.",0),!1;a.docNumber=e,a.docDate=t,a.docStatus=getElementValue("selVDPFactDocumentStatus"),a.customerId=n,a.operatorId=i,a.productId=o,a.limit=document.getElementById("numVDPFactResults").value,isNaN(a.limit)&&(a.limit=50),a.docType=Number(document.getElementById("selVDPFactDocumentType").value),-1!=a.docNumber&&(a.docNumber=document.getElementById("txtVDPFactDocumentNumber").value),-1!=a.docDate&&(a.docDate=document.getElementById("txtVDPFactEmissionDate").value),showNotification();var l=new XMLHttpRequest,s="action=getPostsellDocuments&filterInfo="+JSON.stringify(a),r=URL_SA_POST_SALE_X;l.open("POST",r,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter();var t=e.length,n=document.getElementById("numResultPageNumber"),i=document.getElementById("numResultItems");function o(){var o=Number(n.value),l=Number(i.value),s=(o-1)*l,r=s+l;r>t&&(r=t),setElementInnerHtml("lbResultOnList",r+" / "+t);let c=document.getElementById("tblVDPFactMainTable");c.innerHTML="";for(var u=s,m=s;m<r;m++){var d=e[m];u+=1;let t=JSON.parse(d);const n=t.invoicenumber,i=t.printnumber,o=t.customerid;let l=c.insertRow(-1);l.setAttribute("class","borderGray");let s=l.insertCell(-1);l.id="trSalePostSale"+n,s.setAttribute("class","colRowNumber"+setSelectedRowBackground("SELECTED_ROW_SALE_POST_SALE",l.id)),s.innerHTML=u;let r=l.insertCell(-1);r.style.minWidth="180px",r.innerHTML=t.customername+" ("+t.customerid+")";let b=l.insertCell(-1);b.setAttribute("class","colProductId"),b.innerHTML=t.contractid;let D=l.insertCell(-1);D.style.whiteSpace="nowrap",D.innerHTML=n+postSaleSignals(t,a.docType);let E=l.insertCell(-1);var S=5==a.docType||6==a.docType?t.paymentstatus:t.invoicestatus;E.style.textAlign="center",E.innerHTML=getDocumentStatus(S),"A"==S&&(E.style.color="red");let g=l.insertCell(-1);g.setAttribute("class","colProductId");var p="paymentstatusdate",y="sourceidstatus";if(a.docType<5)p="invoiceStatusDate",y="Sourceidstatus";g.innerHTML=setLocalDate(t[p],16);let v=l.insertCell(-1);v.setAttribute("class","colProductId"),v.innerHTML=getFirtLastName(t.operatorName)+" ("+t[y]+")";let f=l.insertCell(-1);if(f.setAttribute("class","noPrint"),a.docType>1&&a.docType<5&&"A"!=S){let e=document.createElement("button");if(e.type="button",4==a.docType){if(checkPermission("0201")){var T=new Date;setLocalDate(t.shelflife).getTime()>=T.getTime()&&(e.innerHTML="Facturar",e.setAttribute("class","labelSale"),e.onclick=function(){setSelectedRowOnClick(l,"SELECTED_ROW_SALE_POST_SALE"),sessionStorage.setItem("invoiceWorkingDocumentInvoiceNumber",n),sessionStorage.setItem("invoiceWorkingDocumentPrintNumber",i),sessionStorage.setItem("invoiceWorkingDocumentCustomerId",o),window.location.assign("SaleInvoice.php?invoicetype=1")},f.appendChild(e))}}else checkPermission("0205")&&Number(t.WithholdingTaxAmount)+Number(t.paymentamount)<Number(t.totalInvoice)&&(e.innerHTML="Recibo",e.setAttribute("class","labelPayment"),e.onclick=function(){setSelectedRowOnClick(l,"SELECTED_ROW_SALE_POST_SALE"),t.transactiondate=t.invoicedate,sessionStorage.setItem("invoiceInvoiceInvoiceNumber",JSON.stringify(t)),window.location.assign("SalePayment.php")},f.appendChild(e))}let L=document.createElement("button");L.type="button",L.setAttribute("class","labelDetail"),L.onclick=function(){setSelectedRowOnClick(l,"SELECTED_ROW_SALE_POST_SALE"),postSaleViewDetail(i)},f.appendChild(L);let N=document.createElement("button");N.setAttribute("class","labelPrint"),N.type="button",N.onclick=function(){var e=document.getElementById("lbHearderCompanyName").innerHTML,o=t.newCustomerName,l=DOCUMENT_TYPE[n.slice(0,2)]+" nº"+n,s=t.newEmail,r=t.newTelephone;a.docType>=5?showPrintOptions(function(){paymentPrintReceipt(i)},function(){paymentPrintA4(i)},function(){var t=document.getElementById("txtPriPrevCustomerEmail").value;paymentSendByEmail(i,e,l,o,t)},function(){var e=document.getElementById("btPriPrevSendWhatsApp").value;paymentSendByWhatsApp(i,l,o,e)},s,r):showPrintOptions(function(){invoicePrintReceipt(i,2)},function(){invoicePrintA4(i,2)},function(){var t=document.getElementById("txtPriPrevCustomerEmail").value;invoiceSendByEmail(i,e,l,o,t)},function(){var e=document.getElementById("btPriPrevSendWhatsApp").value;invoiceSendByWhatsApp(i,l,o,e)},s,r)},f.appendChild(N)}hideNotification()}n.value=1,setResultTotalPages(n.id,i.id,t),n.onchange=function(){o()},i.onchange=function(){setResultTotalPages(n.id,i.id,t),o()},o()}},l.send(s)}function postSaleSignals(e,t){var n="";return Number(t)<=3&&(""!=e.originatingon&&(n+="(Do)"),Number(e.WithholdingTaxAmount)>0&&(n+="(RF)"),""!=e.paymentDocument&&(n+="(R)"),Number(e.WithholdingTaxAmount)+Number(e.paymentamount)<Number(e.totalInvoice)&&(n+="(AP)"),""!=e.movimentDocument&&(n+="(GR)"),""!=n&&(n='<br><label style="font-size: 10px;"><b>'+n+"</b></label>")),n}function postSaleOrderListOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setDocumentType(""),setSessionResultSearch("numVDOrdListResults"),postsaleOrderList(),hideNotification()})}function postsaleOrderList(e=-1,t=-1,n=-1,i=-1,o=-1){var a=SYSTEM_USER_STATUS.companyId,l=Number(SYSTEM_USER_STATUS.billingprofile)>=BILLING_PROFILE_PARTNER_INDEX?-1:SYSTEM_USER_STATUS.workplaceId;-1!=e&&(e=document.getElementById("txtVDOrdListDocumentNumber").value),-1!=t&&(t=document.getElementById("txtVDOrdListEmissionDate").value),showNotification();var s=new XMLHttpRequest,r="action=getPostSaleOrderList&companyId="+a+"&dependencyId="+l+"&docNumber="+e+"&docDate="+t+"&productId="+n+"&customerId="+i+"&operatorId="+o,c=URL_SA_POST_SALE_X;s.open("POST",c,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter();var t=e.length,n=document.getElementById("numResultPageNumber"),i=document.getElementById("numResultItems");function o(){var o=Number(n.value),a=Number(i.value),l=(o-1)*a,s=l+a;s>t&&(s=t),setElementInnerHtml("lbResultOnList",s+" / "+t);let r=document.getElementById("tblVDOrdListMainTable");r.innerHTML="";for(var c=l,u=l;u<s;u++){var m=e[u];c+=1;let t=JSON.parse(m);const n=t.invoicenumber,i=t.printnumber,o=t.customerid;let a=r.insertRow(-1);a.id="trSaleOrderList"+n,a.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_SALE_ORDER_LIST",a.id));let l=a.insertCell(-1);l.setAttribute("class","colRowNumber"),l.innerHTML=c;let s=a.insertCell(-1);s.style.minWidth="200px",s.innerHTML=t.customername+" ("+t.customerid+")";let b=a.insertCell(-1);b.style.whiteSpace="nowrap",b.innerHTML=n;let D=a.insertCell(-1);D.setAttribute("class","colAmount"),D.innerHTML=formatNumber(t.totalInvoice);let E=a.insertCell(-1);E.style.minWidth="70px",E.setAttribute("class","colProductId"),E.innerHTML=setLocalDate(t.expeditiondate,16);var d=t.billingNumber,S=t.invoicestatus,p="",y=!1;if("A"!=S)if(""==d){var T=Number(t.delayDays);S="Faltam ",T<0?(p="rgb(255,143,143)",S="Atrasado "+Math.abs(T)+" dias"):0==T?(p="rgb(143,143,255)",S="HOJE".bold()):T<=3?(p="rgb(255,222,117)",S+=T+" dias"):S+=T+" dias",y=!0}else l.style.fontWeight="bold",p="rgb(143,255,143)",S=d;let g=a.insertCell(-1);g.setAttribute("class","colProductId"),g.innerHTML=getDocumentStatus(S),g.style.backgroundColor=p;let v=a.insertCell(-1);v.setAttribute("class","colProductId"),v.innerHTML=setLocalDate(t.invoiceStatusDate,16);let f=a.insertCell(-1);f.setAttribute("class","colProductId"),f.innerHTML=getFirtLastName(t.operatorName)+" ("+t.Sourceidstatus+")";let L=a.insertCell(-1);L.setAttribute("class","noPrint");let N=document.createElement("button");N.innerHTML="Facturar",N.type="button",N.setAttribute("class","labelSale"),N.onclick=function(){setSelectedRowOnClick(a,"SELECTED_ROW_SALE_ORDER_LIST"),sessionStorage.setItem("invoiceWorkingDocumentInvoiceNumber",n),sessionStorage.setItem("invoiceWorkingDocumentPrintNumber",i),sessionStorage.setItem("invoiceWorkingDocumentCustomerId",o),window.location.assign("SaleInvoice.php?invoicetype=1")},y&&L.appendChild(N),L.style.textAlign="center";let I=document.createElement("button");I.type="button",I.setAttribute("class","labelEdit"),I.onclick=function(){setSelectedRowOnClick(a,"SELECTED_ROW_SALE_ORDER_LIST"),sessionStorage.setItem("invoiceWorkingDocumentInvoiceNumber",n),sessionStorage.setItem("invoiceWorkingDocumentPrintNumber",i),sessionStorage.setItem("invoiceWorkingDocumentCustomerId",o),window.location.assign("SaleInvoice.php?invoicetype=5")},y&&checkPermission("0201")&&L.appendChild(I);let h=document.createElement("button");h.type="button",h.setAttribute("class","labelDetail"),h.onclick=function(){postSaleViewDetail(i),setSelectedRowOnClick(a,"SELECTED_ROW_SALE_ORDER_LIST")},L.appendChild(h);let P=document.createElement("button");P.setAttribute("class","labelPrint"),P.type="button",P.onclick=function(){var e=document.getElementById("lbHearderCompanyName").innerHTML,o=t.customername,a=DOCUMENT_TYPE[n.slice(0,2)]+" nº"+n;showPrintOptions(function(){invoicePrintReceipt(i,2)},function(){invoicePrintA4(i,2)},function(){var t=document.getElementById("txtPriPrevCustomerEmail").value;invoiceSendByEmail(i,e,a,o,t)},function(){var e=document.getElementById("btPriPrevSendWhatsApp").value;invoiceSendByWhatsApp(i,a,o,e)},t.newEmail,t.newTelephone)},L.appendChild(P)}hideNotification()}n.value=1,setResultTotalPages(n.id,i.id,t),n.onchange=function(){o()},i.onchange=function(){setResultTotalPages(n.id,i.id,t),o()},o(),setTimeout(function(){postsaleOrderList()},3e5)}},s.send(r)}function postSaleDocumentListOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setDocumentType(""),fillSelectDependencyFull("selSalDocListDependency",-1,1),setTriggerButtonByText("txtSalDocListInitialDate","btSalDocListViewAll"),setTriggerButtonByText("txtSalDocListEndDate","btSalDocListViewAll"),hideNotification()})}function postSaleDocumentListList(){var e={};if(e.companyId=SYSTEM_USER_STATUS.companyId,e.dependencyId=Number(document.getElementById("selSalDocListDependency").value),e.dependencyId<=0&&Number(SYSTEM_USER_STATUS.billingprofile)<BILLING_PROFILE_PARTNER_INDEX)return showNotification("Seleccionar uma filial.",0),!1;e.docType=Number(document.getElementById("selSalDocListDocumentType").value),e.documentStatus=getElementValue("selSalDocListDocumentStatus"),e.initialDate=document.getElementById("txtSalDocListInitialDate").value,e.endDate=document.getElementById("txtSalDocListEndDate").value,showNotification();var t=new XMLHttpRequest,n="action=getPostSaleDocumentList&filterInfo="+JSON.stringify(e),i=URL_SA_POST_SALE_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){try{var n=JSON.parse(this.responseText)}catch(e){showHttpResponseText(t)}n.length<=0?showNotification("Não encontrado.",0):hideDivFilter();var i=n.length,o=document.getElementById("numResultPageNumber"),a=document.getElementById("numResultItems");function l(){var t=Number(o.value),l=Number(a.value),s=(t-1)*l,r=s+l;r>i&&(r=i),setElementInnerHtml("lbResultOnList",r+" / "+i);let c=document.getElementById("tblSalDocListMainTable");c.innerHTML="";for(var u=s,m=0,d=0,S=s;S<r;S++){var p=n[S];u+=1;let t=JSON.parse(p);const i=t.invoicenumber;t.customerid;var y=5==e.docType||6==e.docType?t.paymentstatus:t.invoicestatus;let o=c.insertRow(-1);o.setAttribute("class","borderGray");let a=o.insertCell(-1);a.setAttribute("class","colRowNumber"),a.innerHTML=u;let l=o.insertCell(-1);l.style.minWidth="180px",l.innerHTML=t.customername+" ("+t.customerid+")";let s=o.insertCell(-1);s.style.whiteSpace="nowrap",s.innerHTML=i+postSaleSignals(t,e.docType);let r=o.insertCell(-1);r.setAttribute("class","colAmount");var T=Number(t.totalInvoice),b="black";"A"==y?(d+=T,b="red"):m+=T,r.innerHTML=formatNumber(T);let D=o.insertCell(-1);D.style.textAlign="center",D.style.color=b,D.innerHTML=getDocumentStatus(y);let E=o.insertCell(-1);E.setAttribute("class","colProductId"),E.innerHTML=5==e.docType||6==e.docType?setLocalDate(t.paymentstatusdate,16):setLocalDate(t.invoiceStatusDate,16);let g=o.insertCell(-1);g.setAttribute("class","colProductId"),g.innerHTML=getFirtLastName(t.operatorName)+" ("+t.Sourceidstatus+")"}let D=c.insertRow(-1);D.setAttribute("class","borderGray"),D.style.fontSize="large";let E=D.insertCell(-1);E.setAttribute("colspan","3"),E.style.textAlign="center",E.innerHTML="TOTAL (Estado normal)".bold();let g=D.insertCell(-1);g.setAttribute("class","colAmount"),g.innerHTML=formatNumber(m).bold();let v=c.insertRow(-1);v.setAttribute("class","borderGray"),v.style.fontSize="large";let f=v.insertCell(-1);f.setAttribute("colspan","3"),f.style.textAlign="center",f.innerHTML="TOTAL (Estado Anulado)".bold();let L=v.insertCell(-1);L.setAttribute("class","colAmount"),L.innerHTML=formatNumber(d).bold(),hideNotification()}o.value=1,setResultTotalPages(o.id,a.id,i),o.onchange=function(){l()},a.onchange=function(){setResultTotalPages(o.id,a.id,i),l()},l()}},t.send(n)}function postSaleViewDetail(e){try{showNotification();const o=document.getElementById("btSaleDetCancelDocument");o.style.display="none",cleanElement("tblSaleDetMainTable"),cleanElement("tblSaleDetPayments"),cleanElement("tblSaleDetPaymentCondition"),cleanElement("tblSaleDetDocumentTargets");var t=new XMLHttpRequest,n="action=postSaleGetDocumentDitail&printNumber="+e,i=URL_SA_POST_SALE_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var n=JSON.parse(t.responseText),i=n.invoicetype,a="RG"==i||"NA"==i?n.transactiondate:n.invoicedate,l="RG"==i||"NA"==i?n.paymentstatus:n.invoicestatus,s="RG"==i||"NA"==i?n.paymentstatusdate:n.invoiceStatusDate,r="RG"==i||"NA"==i?n.reason:n.invoicestatusreason,c="RG"==i||"NA"==i?n.originatingon:n.reference;document.getElementById("lbSaleDetDocumentType").innerHTML=DOCUMENT_TYPE[i]+":",document.getElementById("lbSaleDetDocumentNumber").innerHTML=n.invoicenumber,document.getElementById("lbSaleDetEntryDate").innerHTML=setLocalDate(a,10),document.getElementById("lbSaleDetEntryUser").innerHTML=getFirtLastName(n.operatorName)+" ("+n.sourceid+")",document.getElementById("lbSaleDetInvoiceStatus").innerHTML=getDocumentStatus(l),document.getElementById("lbSaleDetInvoiceStatusDate").innerHTML=setLocalDate(s,16),document.getElementById("lbSaleDetInvoiceStatusReason").innerHTML=r,document.getElementById("lbSaleDetInvoiceStatusUser").innerHTML=getFirtLastName(n.operatorStatusName)+" ("+n.Sourceidstatus+")",document.getElementById("lbSaleDetOriginationOn").innerHTML=c,document.getElementById("lbSaleDetCustomer").innerHTML=n.customername+" ("+n.customerid+")",document.getElementById("lbSaleDetCustomerTaxId").innerHTML=n.customertaxid;const d=document.getElementById("divSaleDetLines"),S=document.getElementById("divSaleDetRecibo");"RG"!=i&&"NA"!=i?(d.style.display="block",S.style.display="none",postSaleViewDetailLines(n.invoicenumber,l)):(d.style.display="none",S.style.display="block",document.getElementById("lbSaleDetPayDescription").innerHTML=n.description,document.getElementById("lbSaleDetPayDocument").innerHTML=c,document.getElementById("lbSaleDetTNonLiquid").innerHTML=formatNumber(n.totalInvoice),document.getElementById("lbSaleDetTPayed").innerHTML=formatNumber(n.totalInvoice),document.getElementById("lbSaleDetTRamain").innerHTML=formatNumber(n.ramaining));const p=document.getElementById("divSaleDetTotals"),y=document.getElementById("divSaleDetWithholdingTax");if(document.getElementById("lbSaleDetTWarehouse").innerHTML=formatNumber(n.subtotalUnitPrice),document.getElementById("lbSaleDetTOperationalCost").innerHTML=formatNumber(n.subtotalIndirectCost),document.getElementById("lbSaleDetTCommercialCost").innerHTML=formatNumber(n.subtotalCommercialCost),document.getElementById("lbSaleDetTProfit").innerHTML=formatNumber(n.subtotalEstimateProfit),document.getElementById("lbSaleDetTComissions").innerHTML=formatNumber(n.subtotalColaborateComission),document.getElementById("lbSaleDetTFunds").innerHTML=formatNumber(n.subtotalFund),document.getElementById("lbSaleDetTDescount").innerHTML=formatNumber(n.subtotalDescount),document.getElementById("lbSaleDetTIva").innerHTML=formatNumber(n.subtotalIva),document.getElementById("SaleDetTotalInvoice").innerHTML=formatNumber(n.totalInvoice),"RG"!=i&&"NA"!=i){var u=Number(n.WithholdingTaxAmount);document.getElementById("lbSaleDetWithholdingTax").innerHTML=n.WithholdingTaxType,document.getElementById("lbSaleDetWithholdingTaxAmount").innerHTML=formatNumber(u),p.style.display="inline",y.style.display=u>0?"inline":"none"}else p.style.display="none",y.style.display="none";postSaleViewDetailPayments(n.invoicenumber),postSaleViewDetailPaymentsConditions(n.invoicenumber),postSaleViewDetailDocumentsTarget(n.invoicenumber);var m="0230";"PP"==i||"OR"==i?m="0231":"NE"==i?m="0232":"RG"!=i&&"NA"!=i||(m="0233"),"A"!=l?(hideParts("divCanceledDocument"),checkPermission(m)&&(o.style.display="inline")):showParts("divCanceledDocument"),document.getElementById("btSaleDetPrint").onclick=function(){"RG"==i||"NA"==i?showPrintOptions(function(){paymentPrintReceipt(e)},function(){paymentPrintA4(e)},function(){},function(){},"e","",!0):showPrintOptions(function(){invoicePrintReceipt(e,2)},function(){invoicePrintA4(e,2)},function(){},function(){},"","",!0)},document.getElementById("btSaleDetRealCancel").onclick=function(){"RG"==i||"NA"==i?postSaleCancelPayment(n.invoicenumber):"PP"==i||"OR"==i||"NE"==i?postSaleCancelWorkingdocument(n.invoicenumber):"FR"!=i&&"VD"!=i&&"FT"!=i||(n.userId=SYSTEM_USER_STATUS.userId,n.reason=reviewString(document.getElementById("txtSaleDetCancelDocumentReason")),postSaleCancelInvoice(n))},showParts("divVDPFactDocumentDetails"),hideNotification()}},t.send(n)}catch(e){showNotification(e.message,0)}}function postSaleViewDetailLines(e,t){showNotification();var n=new XMLHttpRequest,i="action=postSaleDetailLines&invoiceNumber="+e+"&invoiceStatus="+t,o=URL_SA_POST_SALE_X;n.open("POST",o,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(n.responseText);let i=document.getElementById("tblSaleDetMainTable");i.innerHTML="";var t=0;e.forEach(e=>(function(e){t+=1;let n=JSON.parse(e),o=i.insertRow(-1);o.setAttribute("class","borderGray");let a=o.insertCell(-1);a.setAttribute("class","colRowNumber"),a.innerHTML=t,o.insertCell(-1).innerHTML=n.productId,o.insertCell(-1).innerHTML=n.productDescription,o.insertCell(-1).innerHTML=n.unitOfMeasure,o.insertCell(-1).innerHTML=formatNumber(n.quantity);let l=o.insertCell(-1);l.setAttribute("class","colAmount"),l.innerHTML=formatNumber(n.priceWithComission),o.insertCell(-1).innerHTML=formatNumber(n.settlementAmount),o.insertCell(-1).innerHTML=formatNumber(n.taxPercentage);let s=o.insertCell(-1);s.setAttribute("class","colAmount"),s.innerHTML=formatNumber(n.subtotalLine)})(e))}},n.send(i)}function postSaleViewDetailPayments(e){showNotification();var t=new XMLHttpRequest,n="action=postSaleDetailPayments&invoiceNumber="+e,i=URL_SA_POST_SALE_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(t.responseText);const n=document.getElementById("divSaleDetPayments");e.length<=0?n.style.display="none":n.style.display="inline";let i=document.getElementById("tblSaleDetPayments");i.innerHTML="";e.forEach(e=>(function(e){1;let t=JSON.parse(e);var n=PAYMENT_MECHANISM[Number(t.PaymentMechanism)];let o=i.insertRow(-1),a=o.insertCell(-1);var l=n.short+". "+t.targetBankName+". "+n.shortplus+" "+t.reference+". "+setLocalDate(t.PaymentDate,10);a.innerHTML=l;let s=o.insertCell(-1);s.setAttribute("class","colAmount"),s.innerHTML=formatNumber(t.PaymentAmount)})(e))}},t.send(n)}function postSaleViewDetailPaymentsConditions(e){showNotification();var t=new XMLHttpRequest,n="action=postSaleDetailPaymentsConditions&invoiceNumber="+e,i=URL_SA_POST_SALE_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(t.responseText);const n=document.getElementById("divSaleDetPaymentConditions");e.length<=0?n.style.display="none":n.style.display="inline";let i=document.getElementById("tblSaleDetPaymentCondition");i.innerHTML="";e.forEach(e=>(function(e){1;let t=JSON.parse(e),n=i.insertRow(-1);n.insertCell(-1).innerHTML=t.installment,n.insertCell(-1).innerHTML=setLocalDate(t.installmentdate,10);let o=n.insertCell(-1);o.setAttribute("class","colAmount"),o.innerHTML=formatNumber(t.paymentamount)})(e))}},t.send(n)}function postSaleViewDetailDocumentsTarget(e){showNotification(),POST_SALE_VIEW_DETAIL_DOCUMENTS_TARGET=[];var t=new XMLHttpRequest,n="action=postSaleDetailDocumentsTarget&invoiceNumber="+e,i=URL_SA_POST_SALE_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(t.responseText);const i=document.getElementById("divSaleDetDocumentTargets");e.length<=0?i.style.display="none":i.style.display="inline";let o=document.getElementById("tblSaleDetDocumentTargets");o.innerHTML="";var n=0;e.forEach(e=>(function(e){n+=1;let t=JSON.parse(e);POST_SALE_VIEW_DETAIL_DOCUMENTS_TARGET[Number(n-1)]=t;let i=o.insertRow(-1);i.insertCell(-1).innerHTML=t.invoicenumber;let a=i.insertCell(-1);a.setAttribute("class","colAmount"),a.innerHTML=formatNumber(t.totalInvoice);let l=i.insertCell(-1);"A"==t.invoicestatus&&(i.style.color="red");l.innerHTML=getDocumentStatus(t.invoicestatus),i.insertCell(-1).innerHTML=setLocalDate(t.invoicedate,10)})(e))}},t.send(n)}function postSaleCancelPayment(e,t=!1){var n=document.getElementById("txtSaleDetCancelDocumentReason"),i=reviewString(n).toUpperCase(),o=document.getElementById("lbSaleDetOriginationOn").innerHTML;if(""==i)return alert("Deve indicar o motivo da anulação."),!1;function a(){showNotification();var t=SYSTEM_USER_STATUS.userId,a=new XMLHttpRequest,l="action=postSaleViewDetailCancelPayment&invoiceNumber="+e+"&originationOn="+o+"&reason="+i+"&userId="+t,s=URL_SA_POST_SALE_X;a.open("POST",s,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){try{var e=JSON.parse(a.responseText)}catch(e){return showHttpResponseText(a),!1}1==e.status?(showNotification(e.msg,1),n.value="",hideParts("divSaleDetCancelDocument"),hideParts("divVDPFactDocumentDetails")):showNotification("Não foi possível anular")}},a.send(l)}t?a():showConfirm("Tem mesmo a certeza que deseja anular este recibo?",a)}function postSaleCancelWorkingdocument(e){var t=document.getElementById("txtSaleDetCancelDocumentReason"),n=reviewString(t).toUpperCase(),i=document.getElementById("lbSaleDetOriginationOn").innerHTML;if(""==n)return alert("Deve indicar o motivo da anulação."),!1;showConfirm("Tem mesmo a certeza que deseja anular este recibo?",function(){showNotification();var o=SYSTEM_USER_STATUS.userId,a=new XMLHttpRequest,l="action=postSaleViewDetailCancelWorkingDocument&invoiceNumber="+e+"&originationOn="+i+"&reason="+n+"&userId="+o,s=URL_SA_POST_SALE_X;a.open("POST",s,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(a.responseText);1==e.status?(showNotification(e.msg,1),t.value="",hideParts("divSaleDetCancelDocument"),hideParts("divVDPFactDocumentDetails")):showNotification("Não foi possível anular")}},a.send(l)})}function postSaleCancelInvoice(e){if(""==e.reason)return alert("Deve indicar o motivo da anulação."),!1;showConfirm("Tem mesmo a certeza que deseja anular este recibo?",function(){showNotification();var t=new XMLHttpRequest,n="action=postSaleViewDetailCancelInvoice&invoiceInfo="+JSON.stringify(e),i=URL_SA_POST_SALE_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(t.responseText);1==e.status?(showNotification(e.msg,1),POST_SALE_VIEW_DETAIL_DOCUMENTS_TARGET.forEach(e=>(function(e){txtReason.value="Documento de origem foi anulado. ";var t=e.invoicenumber,n=e.invoicetype;"RG"==n?postSaleCancelPayment(t,!0):((n="GR")||(n="GT"))&&movimentCancelMoviment(t,txtReason.value,!0),txtReason.value=""})(e)),hideParts("divSaleDetCancelDocument"),hideParts("divVDPFactDocumentDetails")):showNotification("Não foi possível anular.")}},t.send(n)})}