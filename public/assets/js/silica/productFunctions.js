class _product{constructor(e="Novo",t="",o="P",n="OUTRA",r="",d="",i="",a="",c="UN",l="",u="",s="",m="",p="",P=0,g=0,S=0,y=0,E=0,C=1,h=1,v=1,f=-1,T=3,I=17,N="",R=0,A=0,b=0){this.productid=e,this.productnumbercode=t,this.producttype=o,this.productcategory=n,this.productfamily=r,this.productbrand=d,this.productmodel=i,this.productrelativesize=a,this.productunit=c,this.productdescription=l,this.productnote=u,this.productkeyword1=s,this.productkeyword2=m,this.productkeyword3=p,this.productweight=P,this.productnetweight=g,this.productlenght=S,this.productwidth=y,this.productheight=E,this.productsection=C,this.productstock=h,this.productminimostock=v,this.supplierid=f,this.devolutiondays=T,this.productivacategory=I,this.photo=N,this.warehouseprice=R,this.estimatedprofit=A,this.iva=b}}class _productPrice{constructor(e,t=0,o=0,n=0,r=0,d=0,i=0,a=0,c=0,l=0,u=0,s=0,m=0,p=0,P=1){this.productid=e,this.warehouseprice=t,this.indirectcost=o,this.commercialcost=n,this.estimatedprofit=r,this.unitprice=d,this.sellercomission=i,this.managercomission=a,this.fundinvestment=c,this.fundreserve=l,this.fundsocialaction=u,this.descount=s,this.iva=m,this.pvp=p,this.status=P}}var PRODUCT_PRICE_LINES=[],PRODUCT_PRICE_PERCENT_SUGGEST={},PRODUCT_EXPIRATION_DATE_LINE=[],PRODUCT_REGISTER_LINES=[];function productPriceOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){PRODUCT_PRICE_LINES=[],fillSelectProductSection("selProdPrecoProductSection",-1),fillSelectProductCategory("selProdPrecoProductCategory",-1),productPricePercentSuggestGet(""),hideNotification()})}function productPricePercentSuggestGet(e){setSpanHideFieldSet("btProdPrecoSpanPercentSuggest","fldsProPrecoPercentSuggest");var t=SYSTEM_USER_STATUS.companyId,o=new XMLHttpRequest,n="action=getProductPricePercentSuggest&companyId="+t,r=URL_SA_PRODUCT_SALE_X;o.open("POST",r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);PRODUCT_PRICE_PERCENT_SUGGEST=e;var t=document.getElementById("numProdPrecoPercentIndirectCost");t.value=Number(e.indirectcost).toFixed(2),t.onchange=function(){productPricePercentSuggestChange(t,"indirectcost")};var o=document.getElementById("numProdPrecoPercentCommercialCost");o.value=Number(e.commercialcost).toFixed(2),o.onchange=function(){productPricePercentSuggestChange(o,"commercialcost")};var n=document.getElementById("numProdPrecoPercentProfit");n.value=Number(e.estimatedprofit).toFixed(2),n.onchange=function(){productPricePercentSuggestChange(n,"estimatedprofit")};var r=document.getElementById("numProdPrecoPercentSellerComission");r.value=Number(e.sellercomission).toFixed(2),r.onchange=function(){productPricePercentSuggestChange(r,"sellercomission")};var d=document.getElementById("numProdPrecoPercentManagerComission");d.value=Number(e.managercomission).toFixed(2),d.onchange=function(){productPricePercentSuggestChange(d,"managercomission")};var i=document.getElementById("numProdPrecoPercentInvestmentFund");i.value=Number(e.fundinvestment).toFixed(2),i.onchange=function(){productPricePercentSuggestChange(i,"fundinvestment")};var a=document.getElementById("numProdPrecoPercentReserveFund");a.value=Number(e.fundreserve).toFixed(2),a.onchange=function(){productPricePercentSuggestChange(a,"fundreserve")};var c=document.getElementById("numProdPrecoPercentSocialActionFund");c.value=Number(e.fundsocialaction).toFixed(2),c.onchange=function(){productPricePercentSuggestChange(c,"fundsocialaction")}}},o.send(n),document.getElementById("lbProdPrecoIVARegime").innerHTML="- IVA em "+regimeIva(SYSTEM_USER_STATUS.taxGroup)+"."}function productPricePercentSuggestChange(e,t){var o=Number(e.value);Number(o)>Number(e.max)?(o=Number(e.max),e.value=o.toFixed(2)):Number(o)<0&&(o=0,e.value=o.toFixed(2)),PRODUCT_PRICE_PERCENT_SUGGEST[t]=o}function productPricePercentSuggestSave(e){var t=SYSTEM_USER_STATUS.companyId,o="&percentSuggest="+JSON.stringify(PRODUCT_PRICE_PERCENT_SUGGEST);showNotification();var n=new XMLHttpRequest,r="action=saveProductPriceSuggest&companyId="+t+o;o=URL_SA_PRODUCT_SALE_X,n.open("POST",o,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(1==this.responseText.status?showNotification("Guardado com sucesso.",1):hideNotification())},n.send(r)}function productPriceAddProductBySectionCategory(e){var t=SYSTEM_USER_STATUS.companyId,o=document.getElementById("selProdPrecoProductSection").value,n=document.getElementById("selProdPrecoProductCategory").value;showNotification();var r=new XMLHttpRequest,d="action=getProductBySectionByCategory&companyId="+t+"&sectionId="+o+"&productCategory="+n,i=URL_SA_PRODUCT_SALE_X;r.open("POST",i,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){let t=JSON.parse(e);document.getElementById("txtProdPricoProduct").value=t.id,productPriceAddProduct("")})(e)),hideNotification()}},r.send(d)}function productPriceAddProduct(e){var t=SYSTEM_USER_STATUS.companyId;const o=document.getElementById("txtProdPricoProduct");var n=reviewString(o);if(""==n)return showNotification("Por favor, indicar um código de barra válido",0),o.value="",o.focus(),!1;if(productPriceCheckItemOnLines(n))return showNotification("Produto já adicionado",0),o.value="",o.focus(),!1;showNotification();var r=SYSTEM_USER_STATUS.companyId,d=new XMLHttpRequest,i="action=getProductFullDescription&companyId="+t+"&productId="+n+"&isNote=0&workplaceId="+r,a=URL_SA_PRODUCT_SALE_X;d.open("POST",a,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=this.responseText;let i=document.getElementById("tblProdPrecoMainTable");var t=Number(i.rows.length)+1;if(""==e)return o.focus(),showNotification("Produto / serviço não encontrado",0),!1;var n=JSON.parse(this.responseText),r=n.productdescription,d=new _productPrice;d.productid=n.id,d.warehouseprice=Number(n.warehouseprice),d.indirectcost=Number(n.indirectcost),d.commercialcost=Number(n.commercialcost),d.estimatedprofit=Number(n.estimatedprofit),d.sellercomission=Number(n.sellercomission),d.managercomission=Number(n.managercomission),d.fundinvestment=Number(n.fundinvestment),d.fundreserve=Number(n.fundreserve),d.fundsocialaction=Number(n.fundsocialaction),d.descount=Number(n.descount),d.iva=Number(n.iva),d.pvp=Number(n.pvp),d.status=1,PRODUCT_PRICE_LINES[Number(t-1)]=d;let a=i.insertRow(-1);a.setAttribute("class","borderGray"),a.setAttribute("id","trVDFactInvLine"+t);let c=a.insertCell(-1);c.setAttribute("class","colRowNumber"),c.innerHTML=t;let l=a.insertCell(-1);l.setAttribute("class","colProductId"),l.innerHTML=d.productid;let u=a.insertCell(-1);u.style.minWidth="150px",u.innerHTML=r;const s=t;let m=a.insertCell(-1),p=document.createElement("input");p.type="number",p.id="numProdPrecoWarehousePrice"+s,p.min=0,p.step="any",p.value=Number(d.warehouseprice).toFixed(2),p.onchange=function(){productCalculatePVP(s,p.id,"warehouseprice")},m.appendChild(p),m.style.minWidth="120px";let P=a.insertCell(-1);P.setAttribute("id","cellProdPrecoSubtotalCost"+s),P.style.textAlign="center",P.style.width="60px";let g=a.insertCell(-1),S=document.createElement("input");S.type="number",S.id="numProdPrecoDescount"+s,S.min=0,S.max=100,S.step="any",S.style.width="50px",S.value=Number(d.descount).toFixed(2),S.onchange=function(){productCalculatePVP(s,S.id,"descount")},g.style.textAlign="center",g.appendChild(S),g.style.width="60px";let y=a.insertCell(-1);y.setAttribute("id","cellProdPrecoEstimateProfif"+s),y.style.textAlign="center",y.innerHTML=formatNumber(d.estimatedprofit),y.style.width="60px";let E=a.insertCell(-1);E.setAttribute("id","cellProdPrecoComissions"+s),E.style.textAlign="center",E.style.width="60px";let C=a.insertCell(-1);C.setAttribute("id","cellProdPrecoFunds"+s),C.style.textAlign="center",C.style.width="60px";let h=a.insertCell(-1),v=document.createElement("input");v.type="number",v.id="numProdPrecoIva"+s,v.min=0,v.max=100,v.step="any",v.style.width="50px",v.value=Number(d.iva).toFixed(2),v.onchange=function(){productCalculatePVP(s,v.id,"iva")},h.style.textAlign="center",h.style.width="60px",h.appendChild(v);let f=a.insertCell(-1);f.setAttribute("id","cellProdPrecoPVP"+s),f.style.fontSize="large",f.style.paddingLeft="5px",f.style.paddingRight="5px",f.style.textAlign="right",f.style.whiteSpace="nowrap",f.style.minWidth="80px",f.innerHTML=formatNumber(d.pvp).toString().bold(),productCalculatePVP(s,-1,d.pvp,d.pvp),hideNotification()}},d.send(i)}function productPriceCheckItemOnLines(e){var t=!1;return PRODUCT_PRICE_LINES.forEach(o=>(function(o){if(o.productid==e)return t=!0,!0})(o)),t}function productCalculatePVP(e,t,o,n=0,r=0){if(-1!=t){var d=document.getElementById(t);n=d.value,isNaN(n)&&(n=0),Number(n)<0&&(n=0),"iva"!=o&&"descount"!=o||(Number(n)>100&&(n=100),"iva"==o&&Number(n>0)&&Number(SYSTEM_USER_STATUS.taxGroup)<=1&&showNotification("Não é recomendado IVA diferente de '0' (zero).",0)),d.value=n}var i=_productPrice;if((i=PRODUCT_PRICE_LINES[Number(e)-1])[o]=Number(n),1==r)return!1;var a=Number(i.warehouseprice),c=Number(i.indirectcost)/100+Number(i.commercialcost)/100,l=Number(a+a*c),u=Number(i.estimatedprofit)/100,s=Number(i.sellercomission)/100+Number(i.managercomission)/100,m=Number(i.fundinvestment)/100+Number(i.fundreserve)/100+Number(i.fundsocialaction)/100,p=l+u*l+s*a+m*a,P=p*(Number(i.descount)/100),g=p-P+(p-P)*(Number(i.iva)/100);i.unitprice=l,i.pvp=g,document.getElementById("cellProdPrecoSubtotalCost"+e).innerHTML=formatNumber(100*c),document.getElementById("cellProdPrecoEstimateProfif"+e).innerHTML=formatNumber(i.estimatedprofit),document.getElementById("cellProdPrecoComissions"+e).innerHTML=formatNumber(100*s),document.getElementById("cellProdPrecoFunds"+e).innerHTML=formatNumber(100*m),document.getElementById("cellProdPrecoPVP"+e).innerHTML=formatNumber(i.pvp).toString().bold()}function productPriceApplyTaxsComissions(e){if(PRODUCT_PRICE_LINES.length<=0)return showNotification("Precisa adicionar produto / serviços",0),!1;for(var t=0;t<PRODUCT_PRICE_LINES.length;t++){let e=t+1;productCalculatePVP(e,-1,"indirectcost",PRODUCT_PRICE_PERCENT_SUGGEST.indirectcost,1),productCalculatePVP(e,-1,"commercialcost",PRODUCT_PRICE_PERCENT_SUGGEST.commercialcost,1),productCalculatePVP(e,-1,"estimatedprofit",PRODUCT_PRICE_PERCENT_SUGGEST.estimatedprofit,1),productCalculatePVP(e,-1,"sellercomission",PRODUCT_PRICE_PERCENT_SUGGEST.sellercomission,1),productCalculatePVP(e,-1,"managercomission",PRODUCT_PRICE_PERCENT_SUGGEST.managercomission,1),productCalculatePVP(e,-1,"fundinvestment",PRODUCT_PRICE_PERCENT_SUGGEST.fundinvestment,1),productCalculatePVP(e,-1,"fundreserve",PRODUCT_PRICE_PERCENT_SUGGEST.fundreserve,1),productCalculatePVP(e,-1,"fundsocialaction",PRODUCT_PRICE_PERCENT_SUGGEST.fundsocialaction,0)}}function productPriceSave(e){if(PRODUCT_PRICE_LINES.length<=0)showNotification("Lista vazia.",0);else{if(1==ST_SA_WAITING_SERVER)return alert("Aguardando resposta do servidor. <br>"),!1;showNotification();var t="&productPriceLine={",o=0,n=0;PRODUCT_PRICE_LINES.forEach(e=>(function(e){0!=e.status&&(0!=o&&(t+=","),t+='"'+o+'":'+JSON.stringify(e),o+=1,n=e.pvp)})(e)),t+="}",ST_SA_WAITING_SERVER=1;var r=new XMLHttpRequest,d="action=saveProductPrice"+t;t=URL_SA_PRODUCT_SALE_X;r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;var t=JSON.parse(r.responseText);1==t.status?(showNotification(t.msg,1),productPriceCleanTable(""),"PRODCAD"==e&&(hideParts("divProdCadProductPrice"),document.getElementById("numProdCadPVP").value=formatNumber(n))):showNotification(t.msg,0)}},r.send(d)}}function productPriceCleanTable(e){PRODUCT_PRICE_LINES=[],document.getElementById("tblProdPrecoMainTable").innerHTML=""}function productProductOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){fillSelectProductCategory("selProdCadProductCategory"),fillSelectProductIvaCategory("selProdCadProductIvaCategory"),fillSelectProductSection("selProdCadProductSection",1,0),fillSelectSupplier("selProdCadPreferedSupplier",-1),setSpanHideFieldSet("btProdCadSpanKeyword","fldsProdCadKeyword"),setSpanHideFieldSet("btProdCadSpanSizeAndWeight","fldsProdCadSizeAndWeight"),productProdutOpen(-1);const e=document.getElementById("btProdCadDelete");checkPermission("0303")?e.style.display="inline":e.style.display="none",setAutoCompleteToFiel("txtProdCadBarCode",5,1),setAutoCompleteToFiel("txtProdCadFamily",6),setAutoCompleteToFiel("txtProdCadBrand",7),setAutoCompleteToFiel("txtProdCadModel",8),setAutoCompleteToFiel("txtProdCadRelativeSize",9),setAutoCompleteToFiel("txtProdCadProducUnit",10),setAutoCompleteToFiel("txtProdCadDescription",11,1),setAutoCompleteToFiel("txtProdCadNote",12,1),setAutoCompleteToFiel("txtProdCadKeyword1",13),setAutoCompleteToFiel("txtProdCadKeyword2",14),setAutoCompleteToFiel("txtProdCadKeyword3",15),maskInputByPlaceHold("txtProdCadBarCode");const t=document.getElementById("btProdCadSetPrice");checkPermission("0302")||(t.disabled="true",t.style.backgroundColor="lightgray"),productPricePercentSuggestGet(""),hideParts("fldsProdPrecoAddProduct"),productSetUploadPhoto(),hideNotification()})}var PRODUCT_SELF_DESCRIPTION=!0;function productProdutOpen(e,t="P"){var o=document.getElementById("txtProdCadProdutoId"),n=document.getElementById("txtProdCadBarCode"),r=(document.getElementById("selProdCadProductType"),document.getElementById("selProdCadProductCategory")),d=document.getElementById("txtProdCadFamily");d.oninput=function(){productSelfDescription()};var i=document.getElementById("txtProdCadBrand");i.oninput=function(){productSelfDescription()};var a=document.getElementById("txtProdCadModel");a.oninput=function(){productSelfDescription()};var c=document.getElementById("txtProdCadRelativeSize");c.oninput=function(){productSelfDescription()};var l=document.getElementById("txtProdCadProducUnit"),u=document.getElementById("txtProdCadDescription"),s=document.getElementById("txtProdCadNote"),m=document.getElementById("txtProdCadKeyword1"),p=document.getElementById("txtProdCadKeyword2"),P=document.getElementById("txtProdCadKeyword3"),g=document.getElementById("numProdCadProductWeight"),S=document.getElementById("numProdCadProductNetWeight"),y=document.getElementById("numProdCadLenght"),E=document.getElementById("numProdCadWidth"),C=document.getElementById("numProdCadheigth"),h=document.getElementById("selProdCadProductSection"),v=document.getElementById("rangeProdCadProductStock"),f=document.getElementById("numProdCadMinStock"),T=document.getElementById("selProdCadPreferedSupplier"),I=document.getElementById("numProdCadDevolutionDays"),N=document.getElementById("lbProdCadNewPhoto"),R=document.getElementById("imgProdCadPhoto"),A=document.getElementById("selProdCadProductIvaCategory"),b=document.getElementById("numProdCadPVP");if(document.getElementById("btProdCadSetPrice").onclick=function(){productPriceCleanTable(""),document.getElementById("txtProdPricoProduct").value=e,productPriceAddProduct(""),showParts("divProdCadProductPrice")},d.focus(),-1==e)PRODUCT_SELF_DESCRIPTION=!0,o.value="S"==t?"Novo serviço":"Novo produto",n.value="",productOnProductTypeChange(t),r.value="OUTRA",d.value="",i.value="",a.value="",c.value="",l.value="UN",u.value="",s.value="",m.value="",p.value="",P.value="",g.value=0,S.value=0,y.value=0,E.value=0,C.value=0,h.value=1,f.value=1,T.value=-1,I.value=3,A.value="17",b.value="0,00",N.innerHTML="",R.src="",dispatchOnInputChange();else{PRODUCT_SELF_DESCRIPTION=!1;var w=SYSTEM_USER_STATUS.companyId,_=SYSTEM_USER_STATUS.companyId,x=new XMLHttpRequest,L="action=getProductFullDescription&companyId="+w+"&productId="+e+"&isNote=0&workplaceId="+_,B=URL_SA_PRODUCT_SALE_X;x.open("POST",B,!0),x.setRequestHeader("Content-type","application/x-www-form-urlencoded"),x.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);if(1==e.periodicservice)return alert("Este é um serviço de cobrança periódica, não pode ser editado nesta janela."),!1;o.value=e.id,n.value=e.productnumbercode,productOnProductTypeChange(e.producttype),r.value=e.productcategory,d.value=e.productfamily,i.value=e.productbrand,a.value=e.productmodel,c.value=e.productrelativesize,l.value=e.productunit,u.value=e.productdescription,s.value=e.productnote,m.value=e.productkeyword1,p.value=e.productkeyword2,P.value=e.productkeyword3,g.value=e.productweight,S.value=e.productnetweight,y.value=e.productlenght,E.value=e.productwidth,C.value=e.productheight,h.value=e.productsection,v.value=e.productstock,f.value=e.productminimostock,T.value=e.supplierid,I.value=e.devolutiondays,A.value=e.productivacategory,b.value=formatNumber(e.pvp);var t=e.photo,w=t.lastIndexOf("/")+1;N.innerHTML=t.substring(w),R.src=t,u.focus(),dispatchOnInputChange()}},x.send(L)}}function productSelfDescription(){if(PRODUCT_SELF_DESCRIPTION){var e=reviewString(document.getElementById("txtProdCadFamily")),t=reviewString(document.getElementById("txtProdCadBrand")),o=reviewString(document.getElementById("txtProdCadModel")),n=reviewString(document.getElementById("txtProdCadRelativeSize")),r=e;""!=t&&(""!=r&&(r+=", "),r+=t),""!=o&&(""!=r&&(r+=", "),r+=o),""!=n&&(""!=r&&(r+=", "),r+=n),document.getElementById("txtProdCadDescription").value=r}}function productSave(e){var t=SYSTEM_USER_STATUS.companyId,o=new _product;o.productid=document.getElementById("txtProdCadProdutoId").value,o.productnumbercode=reviewString(document.getElementById("txtProdCadBarCode")).toUpperCase().replace(/[_]/g,""),o.producttype=document.getElementById("selProdCadProductType").value,o.productcategory=document.getElementById("selProdCadProductCategory").value,o.productfamily=reviewString(document.getElementById("txtProdCadFamily")).toString().toUpperCase(),o.productbrand=reviewString(document.getElementById("txtProdCadBrand")).toString().toUpperCase(),o.productmodel=reviewString(document.getElementById("txtProdCadModel")).toString().toUpperCase(),o.productrelativesize=reviewString(document.getElementById("txtProdCadRelativeSize")).toString().toUpperCase(),o.productunit=reviewString(document.getElementById("txtProdCadProducUnit")).toString().toUpperCase(),o.productdescription=reviewString(document.getElementById("txtProdCadDescription")).toString().toUpperCase(),o.productnote=reviewString(document.getElementById("txtProdCadNote")),o.productkeyword1=reviewString(document.getElementById("txtProdCadKeyword1")).toString().toUpperCase(),o.productkeyword2=reviewString(document.getElementById("txtProdCadKeyword2")).toString().toUpperCase(),o.productkeyword3=reviewString(document.getElementById("txtProdCadKeyword3")).toString().toUpperCase(),o.productweight=document.getElementById("numProdCadProductWeight").value,o.productnetweight=document.getElementById("numProdCadProductNetWeight").value,o.productlenght=document.getElementById("numProdCadLenght").value,o.productwidth=document.getElementById("numProdCadWidth").value,o.productheight=document.getElementById("numProdCadheigth").value,o.productsection=document.getElementById("selProdCadProductSection").value,o.productstock=document.getElementById("rangeProdCadProductStock").value,o.productminimostock=document.getElementById("numProdCadMinStock").value,o.supplierid=document.getElementById("selProdCadPreferedSupplier").value,o.devolutiondays=document.getElementById("numProdCadDevolutionDays").value,o.productivacategory=document.getElementById("selProdCadProductIvaCategory").value,o.photo=document.getElementById("lbProdCadNewPhoto").innerHTML;var n=!1,r="";if(""==o.productcategory&&(n=!0,r="Deve indicar a categoria do produto/serviço. <br>"),""==o.productdescription&&(n=!0,r="Deve indicar a descrição do produto/serviço. <br>"),""==o.productunit&&(n=!0,r+="Deve indicar a unidade de medida do produto/serviço. <br>"),1==ST_SA_WAITING_SERVER&&(n=!0,r+="Aguardando resposta do servidor. <br>"),0!=n)return alert(r),!1;showNotification(),ST_SA_WAITING_SERVER=1;var d=new XMLHttpRequest,i="action=saveProduct&companyId="+t+"&productInfo="+JSON.stringify(o),a=URL_SA_PRODUCT_SALE_X;d.open("POST",a,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;var t=JSON.parse(d.responseText);1==t.status?(showNotification(t.msg,1),productAutocompleteList("txtProdProcSearchProduct"),setAutoCompleteToFiel("txtProdCadBarCode",5,1),setAutoCompleteToFiel("txtProdCadFamily",6),setAutoCompleteToFiel("txtProdCadBrand",7),setAutoCompleteToFiel("txtProdCadModel",8),setAutoCompleteToFiel("txtProdCadRelativeSize",9),setAutoCompleteToFiel("txtProdCadProducUnit",10),setAutoCompleteToFiel("txtProdCadDescription",11,1),setAutoCompleteToFiel("txtProdCadNote",12,1),setAutoCompleteToFiel("txtProdCadKeyword1",13),setAutoCompleteToFiel("txtProdCadKeyword2",14),setAutoCompleteToFiel("txtProdCadKeyword3",15),productProdutOpen(-1),hideParts("divProdLisProdutoNovo"),"PROESTENTR"==e?(hideParts("divProdEstEntrProductRegister"),document.getElementById("txtProdEstEntrProduct").value=t.productId,entranceAddProduct()):"PRODESTSAI"==e?(hideParts("divProdEstSaiProductRegister"),document.getElementById("txtProdEstSaiProduct").value=t.productId,movimentAddProduct(0)):"PRODSTCKMANAJU"==e?(hideParts("divProdStckManAjuProductRegister"),document.getElementById("txtProdStckManAjuProduct").value=t.productId,productStockManualAjustAddProduct("")):"VD"==e&&(hideParts("divVDFactProductRegister"),document.getElementById("txtVDFactProduct").value=t.productId,invoiceAddProduct("tblVDFactMainTable"))):showNotification(t.msg,0)}},d.send(i),document.getElementById("divProdLisProdutoNovo").style.display="none"}function productDelete(e){var t=document.getElementById("txtProdCadProdutoId").value;if(isNaN(t))return!1;showConfirm("Tem a certeza que deseja apagar este produto / serviço?",function(){showNotification();var e=new XMLHttpRequest,o="action=deleteProduct&productId="+t,n=URL_SA_PRODUCT_SALE_X;e.open("POST",n,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(e.responseText);1==t.status?(showNotification(t.msg,1),productAutocompleteList("txtProdProcSearchProduct"),setAutoCompleteToFiel("txtProdCadBarCode",5,1),setAutoCompleteToFiel("txtProdCadFamily",6),setAutoCompleteToFiel("txtProdCadBrand",7),setAutoCompleteToFiel("txtProdCadModel",8),setAutoCompleteToFiel("txtProdCadRelativeSize",9),setAutoCompleteToFiel("txtProdCadProducUnit",10),setAutoCompleteToFiel("txtProdCadDescription",11,1),setAutoCompleteToFiel("txtProdCadNote",12,1),setAutoCompleteToFiel("txtProdCadKeyword1",13),setAutoCompleteToFiel("txtProdCadKeyword2",14),setAutoCompleteToFiel("txtProdCadKeyword3",15),productProdutOpen(-1),hideParts("divProdLisProdutoNovo")):showNotification(t.msg,0)}},e.send(o)})}function productSectionOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){fillSelectSystemUserBillingUser("selProdSecManagerNational",4,-1),fillSelectSystemUserBillingUser("selProdSecDirector",5,-1),setProductChargeType(""),fillSelectProductChargeType("selProdSecChargeType"),fillSelectProductChargeSequence("selProdSecChargeSequence"),fillSelectProductInstallmentIndicator("selProdSecInstallmentIndicator"),productSectionList(""),setAutoCompleteToFiel("txtProdSecSection",16,1),productSetUploadPhoto(),hideNotification()})}function productSectionList(e){var t=SYSTEM_USER_STATUS.companyId,o=new XMLHttpRequest,n="action=getProductSection&companyId="+t+"&chargeType=-1",r=URL_SA_PRODUCT_SALE_X;o.open("POST",r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter(),document.getElementById("lbResultOnList").innerHTML=e.length;let n=document.getElementById("tblProdSecSectionList");n.innerHTML="";var o=0;e.forEach(e=>(function(e){o+=1;let r=JSON.parse(e),d=n.insertRow(-1);d.id="trProductSection"+r.id,d.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_PRODUCT_SECTION",d.id));let i=d.insertCell(-1);i.setAttribute("class","colRowNumber"),i.innerHTML=o;let a=d.insertCell(-1);if(a.style.textAlign="center",""!=r.photo){let e=document.createElement("img");e.setAttribute("class","imgOnSearch"),e.src=r.photo,a.appendChild(e)}let c=d.insertCell(-1);c.setAttribute("class","colProductId"),c.innerHTML=r.id,d.insertCell(-1).innerHTML=r.section+" ("+PRODUCT_CHARGE_TYPES[r.chargetype].bold()+")";let l=d.insertCell(-1);l.setAttribute("class","noPrint");var u=document.createElement("button");u.setAttribute("class","labelEdit"),u.type="button",u.name=r.id,1!=u.name&&(u.onclick=function(){showDivFilter(),productEditProductSection(t,u.name),setSelectedRowOnClick(d,"SELECTED_ROW_PRODUCT_SECTION")},l.appendChild(u));var s=document.createElement("button");s.setAttribute("class","labelDelete"),s.type="button",s.name=r.id,1!=s.name&&checkPermission("0303")&&(s.onclick=function(){productDeleteProductSection(s.name)},l.appendChild(s))})(e)),hideNotification()}},o.send(n)}function productSaveProductSection(e){var t=!1,o="",n=SYSTEM_USER_STATUS.companyId,r=document.getElementById("txtProdSecId").value,d=reviewString(document.getElementById("txtProdSecSection")).toUpperCase().substring(0,30),i=document.getElementById("selProdSecChargeType").value,a=document.getElementById("selProdSecChargeSequence").value,c=document.getElementById("selProdSecInstallmentIndicator").value,l=document.getElementById("selProdSecManagerNational").value,u=document.getElementById("selProdSecDirector").value,s=document.getElementById("lbProdCadNewPhoto").innerHTML;if(""==d&&(t=!0,o+="Deve indicar o nome da secção. <br>"),Number(i)<=1?(Number(a)>1||Number(c)>1)&&(t=!0,o+="Quando o tipo de cobrança é 'Padrão', então, a sequência e o indicador também devem ser 'Padrão'. <br>"):(Number(a)<=1||Number(c)<=1)&&(t=!0,o+="Quando o tipo de cobrança não é 'Padrão', então, a sequência e o indicador não devem ser 'Padrão'. <br>"),1==ST_SA_WAITING_SERVER&&(t=!0,o+="Aguardando resposta do servidor. <br>"),t)return alert(o),!1;showNotification(),ST_SA_WAITING_SERVER=1;var m=new XMLHttpRequest,p="action=saveProductSection&companyId="+n+"&sectionId="+r+"&section="+d+"&managerNationalUser="+l+"&directorUser="+u+"&photo="+s+"&chargetype="+i+"&chargesequence="+a+"&installmentindicator="+c,P=URL_SA_PRODUCT_SALE_X;m.open("POST",P,!0),m.setRequestHeader("Content-type","application/x-www-form-urlencoded"),m.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;var e=JSON.parse(m.responseText);1==e.status?(showNotification(e.msg,1),productSectionList(""),setAutoCompleteToFiel("txtProdSecSection",16,1),productNewProductSection("")):showNotification(e.msg,0)}},m.send(p)}function productNewProductSection(e){showDivFilter(),document.getElementById("txtProdSecId").value="Nova secção",document.getElementById("txtProdSecSection").value="",document.getElementById("selProdSecChargeType").value=1,document.getElementById("selProdSecChargeSequence").value=1,document.getElementById("selProdSecInstallmentIndicator").value=1,document.getElementById("selProdSecManagerNational").value=-1,document.getElementById("selProdSecDirector").value=-1,document.getElementById("lbProdCadNewPhoto").innerHTML="",document.getElementById("imgProdCadPhoto").src="",document.getElementById("txtProdSecSection").focus,dispatchOnInputChange()}function productEditProductSection(e,t){var o=new XMLHttpRequest,n="action=editProductSection&companyId="+e+"&sectionId="+t,r=URL_SA_PRODUCT_SALE_X;o.open("POST",r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){var t=JSON.parse(e);document.getElementById("txtProdSecId").value=t.id,document.getElementById("txtProdSecSection").value=t.section,document.getElementById("selProdSecChargeType").value=t.chargetype,document.getElementById("selProdSecChargeSequence").value=t.chargesequence,document.getElementById("selProdSecInstallmentIndicator").value=t.installmentindicator,document.getElementById("selProdSecManagerNational").value=t.managernationaluser,document.getElementById("selProdSecDirector").value=t.directoruser,document.getElementById("txtProdSecSection").focus;var o=t.photo,n=o.lastIndexOf("/")+1;document.getElementById("lbProdCadNewPhoto").innerHTML=o.substring(n),document.getElementById("imgProdCadPhoto").src=o,dispatchOnInputChange()})(e))}},o.send(n)}function productDeleteProductSection(e){showConfirm("Tem a certeza que deseja eliminar esta secção?",function(){showNotification();var t=new XMLHttpRequest,o="action=deleteProductSection&sectionId="+e,n=URL_SA_PRODUCT_SALE_X;t.open("POST",n,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(t.responseText);1==e.status?(showNotification(e.msg,1),productSectionList(""),setAutoCompleteToFiel("txtProdSecSection",16,1),productNewProductSection("")):showNotification(e.msg,0)}},t.send(o)})}function productIvaCategoryOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){productIvaCategoryList(""),productIvaCategoryNew(""),setAutoCompleteToFiel("txtProdCatDesignation",17,1),productSetUploadPhoto(),hideNotification()})}function productIvaCategoryList(e){showNotification();var t=SYSTEM_USER_STATUS.companyId,o=new XMLHttpRequest,n="action=getProductIvaCategory&companyId="+t,r=URL_SA_PRODUCT_SALE_X;o.open("POST",r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter(),document.getElementById("lbResultOnList").innerHTML=e.length;let n=document.getElementById("tblProdCatCategoryList");n.innerHTML="";var o=0;e.forEach(e=>(function(e){o+=1;let r=JSON.parse(e),d=n.insertRow(-1);d.setAttribute("class","borderGray");let i=d.insertCell(-1);i.setAttribute("class","colRowNumber"),i.innerHTML=o;let a=d.insertCell(-1);if(a.style.textAlign="center",""!=r.photo){let e=document.createElement("img");e.setAttribute("class","imgOnSearch"),e.src=r.photo,a.appendChild(e)}let c=d.insertCell(-1);c.setAttribute("class","colProductId"),c.innerHTML=r.id,d.insertCell(-1).innerHTML=r.category;let l=d.insertCell(-1);l.style.textAlign="center";var u="S"!=r.producttype?"Produto":"Serviço";l.innerHTML=u;let s=d.insertCell(-1);s.style.textAlign="center",s.innerHTML=formatNumber(r.productiva);let m=d.insertCell(-1);var p=document.createElement("button");p.setAttribute("class","labelEdit"),p.type="button",p.name=r.id,Number(p.name)>18&&(p.onclick=function(){showDivFilter(),productEditProductIvaCategory(t,p.name)},m.appendChild(p));m.style.textAlign="center",m.style.width="60px";let P=d.insertCell(-1);var g=document.createElement("button");g.setAttribute("class","labelDelete"),g.type="button",g.name=r.id,Number(g.name)>18&&(g.onclick=function(){productDeleteCategory(t,g.name)},P.appendChild(g));P.style.textAlign="center",P.style.width="60px"})(e)),hideNotification()}},o.send(n)}function productIvaCategoryNew(e){showDivFilter(),document.getElementById("txtProdCatCategoryId").value="Nova categoria",document.getElementById("txtProdCatDesignation").value="",document.getElementById("selProdCatProductType").value="P",document.getElementById("numProdCatProductIvaSugest").value=1==SYSTEM_USER_STATUS.taxGroup?0:14,document.getElementById("lbProdCadNewPhoto").innerHTML="",document.getElementById("imgProdCadPhoto").src="",document.getElementById("txtProdCatDesignation").focus()}function productSaveProductIvaCategory(e){var t=SYSTEM_USER_STATUS.companyId,o=document.getElementById("txtProdCatCategoryId").value,n=reviewString(document.getElementById("txtProdCatDesignation")).toUpperCase().substring(0,100),r=reviewString(document.getElementById("selProdCatProductType")),d=reviewString(document.getElementById("numProdCatProductIvaSugest")),i=document.getElementById("lbProdCadNewPhoto").innerHTML;if(""==n)return alert("Deve indicar o nome da categoria.",0),!1;showNotification();var a=new XMLHttpRequest,c="action=saveProductIvaCategory&companyId="+t+"&categoryId="+o+"&category="+n+"&producttype="+r+"&productIva="+d+"&photo="+i,l=URL_SA_PRODUCT_SALE_X;a.open("POST",l,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(a.responseText);1==e.status?(showNotification(e.msg,1),productIvaCategoryNew(""),setAutoCompleteToFiel("txtProdCatDesignation",17,1),productIvaCategoryList("")):showNotification(e.msg,1)}},a.send(c)}function productEditProductIvaCategory(e,t){var o=new XMLHttpRequest,n="action=editProductIvaCategory&companyId="+e+"&categoryId="+t,r=URL_SA_PRODUCT_SALE_X;o.open("POST",r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){var t=JSON.parse(e);document.getElementById("txtProdCatCategoryId").value=t.id,document.getElementById("txtProdCatDesignation").value=t.category,document.getElementById("selProdCatProductType").value=t.producttype,document.getElementById("numProdCatProductIvaSugest").value=t.productiva;var o=t.photo,n=o.lastIndexOf("/")+1;document.getElementById("lbProdCadNewPhoto").innerHTML=o.substring(n),document.getElementById("imgProdCadPhoto").src=o})(e))}},o.send(n)}function productDeleteCategory(e,t){if(isNaN(t))return!1;showConfirm("Tem a certeza que deseja apagar esta categoria de produto / serviço?",function(){showNotification();var o=new XMLHttpRequest,n="action=productIvaCategoryDelete&companyId="+e+"&categoryId="+t,r=URL_SA_PRODUCT_SALE_X;o.open("POST",r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(o.responseText);1==e.status?(showNotification(e.msg,1),productIvaCategoryNew(""),setAutoCompleteToFiel("txtProdCatDesignation",17,1),productIvaCategoryList("")):showNotification(e.msg,1)}},o.send(n)})}function productStockOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){fillSelectDependencyFull("selProdEstDependency",-1,1),setAutoCompleteToFiel("txtProdEstDesignation",18,1),productStockNew(""),hideNotification()})}function productStockDependencyOnChange(){cleanElement("tblProdEstMainTable"),productStockList("")}function productStockList(e){showNotification();var t=SYSTEM_USER_STATUS.companyId,o=document.getElementById("selProdEstDependency").value;if(-1==o)return!1;var n=new XMLHttpRequest,r="action=getProductStock&companyId="+t+"&productStockId=-1&dependecyId="+o,d=URL_SA_PRODUCT_SALE_X;n.open("POST",d,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter(),document.getElementById("lbResultOnList").innerHTML=e.length;let n=document.getElementById("tblProdEstMainTable");n.innerHTML="";var o=0;e.forEach(e=>(function(e){o+=1;let r=JSON.parse(e),d=n.insertRow(-1);d.id="trProductStock"+r.id,d.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_PRODUCT_STOCK",d.id));let i=d.insertCell(-1);i.setAttribute("class","colRowNumber"),i.innerHTML=o;let a=d.insertCell(-1);a.setAttribute("class","colProductId"),a.innerHTML=r.id;let c=d.insertCell(-1);c.innerHTML=r.desigination,1==r.billingstock&&(d.style.fontWeight="bold",c.innerHTML+=" (*)");d.insertCell(-1).innerHTML=r.municipality+" - "+r.dependency;let l=d.insertCell(-1);l.setAttribute("class","noPrint");let u=document.createElement("button");u.setAttribute("class","labelEdit"),u.type="button",u.name=r.id,u.onclick=function(){showDivFilter(),productStockEdit(t,u.name),setSelectedRowOnClick(d,"SELECTED_ROW_PRODUCT_STOCK")},l.appendChild(u),l.style.textAlign="center"})(e)),hideNotification()}},n.send(r)}function productStockEdit(e,t){var o=new XMLHttpRequest,n="action=getProductStock&companyId="+e+"&productStockId="+t+"&dependecyId=-1",r=URL_SA_PRODUCT_SALE_X;o.open("POST",r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){var t=JSON.parse(e);document.getElementById("txtProdEstEstoqueId").value=t.id,document.getElementById("txtProdEstDesignation").value=t.desigination,document.getElementById("rangeProdEstBillingStock").value=t.billingstock,document.getElementById("selProdEstDependency").value=t.dependencyid,document.getElementById("txtProdEstDesignation").focus()})(e))}},o.send(n)}function productStockSave(e){var t=!1,o="",n=SYSTEM_USER_STATUS.companyId,r=document.getElementById("txtProdEstEstoqueId").value,d=reviewString(document.getElementById("txtProdEstDesignation")).toUpperCase(),i=document.getElementById("rangeProdEstBillingStock").value,a=document.getElementById("selProdEstDependency").value;if(-1==a&&(t=!0,o+="Deve seleccionar uma filial. <br>"),""==d&&(t=!0,o+="Nome do armazém em branco. <br>"),1==ST_SA_WAITING_SERVER&&(t=!0,o+="Aguardando resposta do servidor. <br>"),t)return alert(o),!1;showNotification(),ST_SA_WAITING_SERVER=1;var c=new XMLHttpRequest,l="action=saveProductStock&companyId="+n+"&stockId="+r+"&designation="+d+"&billingStock="+i+"&dependency="+a,u=URL_SA_PRODUCT_SALE_X;c.open("POST",u,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;var e=JSON.parse(c.responseText);1==e.status?(showNotification(e.msg,1),productStockList(""),productStockNew("")):showNotification(e.msg,0)}},c.send(l)}function productStockNew(e){showDivFilter(),document.getElementById("txtProdEstEstoqueId").value="Novo estoque",document.getElementById("txtProdEstDesignation").value="",document.getElementById("rangeProdEstBillingStock").value=0,document.getElementById("txtProdEstDesignation").focus()}function productStockActualOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){Number(SYSTEM_USER_STATUS.billingprofile)>=BILLING_PROFILE_PARTNER_INDEX&&(document.getElementById("selProdEstActReportType").disabled=""),fillSelectProductStock("selProdEstActStock",-1,1),fillSelectProductSection("selProdEstActSection",-1,0),fillSelectProductIvaCategory("selProdEstActCategory",-1),fillSelectProductFamilyBrandModel("selProdEstActFamily","productfamily",-1),fillSelectProductFamilyBrandModel("selProdEstActBrand","productbrand",-1),hideNotification()})}function productStockActualList(e){var t=SYSTEM_USER_STATUS.companyId,o=document.getElementById("selProdEstActReportType").value,n=document.getElementById("selProdEstActStock").value,r=document.getElementById("selProdEstActSection").value,d=document.getElementById("selProdEstActCategory").value,i=document.getElementById("selProdEstActFamily").value,a=document.getElementById("selProdEstActBrand").value;showNotification();var c=new XMLHttpRequest,l="action=getProductStockActual&companyId="+t+"&stockId="+n+"&sectionId="+r+"&categoryId="+d+"&family="+i+"&brand="+a+"&stockable=1",u=URL_SA_PRODUCT_SALE_X;c.open("POST",u,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter();var t=e.length,n=document.getElementById("numResultPageNumber"),r=document.getElementById("numResultItems");function d(){var d=Number(n.value),i=Number(r.value),a=(d-1)*i,c=a+i;c>t&&(c=t),setElementInnerHtml("lbResultOnList",c+" / "+t);let l=document.getElementById("tblProdEstActMainTable");l.innerHTML="";for(var u=a,s=a;s<c;s++){var m=e[s];u+=1;let t=JSON.parse(m),n=l.insertRow(-1);n.setAttribute("class","borderGray");let r=n.insertCell(-1);r.setAttribute("class","colRowNumber"),r.innerHTML=u;let d=n.insertCell(-1);d.setAttribute("class","colProductId"),d.innerHTML=t.id,n.insertCell(-1).innerHTML=t.productdescription;let i=n.insertCell(-1);i.setAttribute("class","colProductId"),i.innerHTML=t.productnumbercode;let a=n.insertCell(-1);a.setAttribute("class","colProductId"),a.innerHTML=t.section;let c=n.insertCell(-1);c.setAttribute("class","colProductId"),c.innerHTML=t.category;let E=n.insertCell(-1);E.style.textAlign="center";var p=Number(t.stock),P=Number(t.productminimostock);E.style.color=p<=0?"red":p<=P?"orange":"black",E.innerHTML=formatNumber(p).bold();let C=n.insertCell(-1),h=n.insertCell(-1);if(2==o){var g=Number(t.warehouseprice),S=(g+g*((Number(t.indirectcost)+Number(t.commercialcost))/100))*Number(t.estimatedprofit)/100*p;tProfit+=S;var y=Number(t.pvp)*p;tPvp+=y,C.innerHTML=formatNumber(y),C.setAttribute("class","colProductId"),h.innerHTML=formatNumber(S),h.setAttribute("class","colProductId")}else C.setAttribute("class","colProductId"),C.innerHTML=setLocalDate(t.lastIn,10),h.setAttribute("class","colProductId"),h.innerHTML=setLocalDate(t.lastOut,10)}if(2==o){let e=l.insertRow(-1);e.setAttribute("class","borderGray");let t=e.insertCell(-1);t.setAttribute("colspan","7"),t.style.textAlign="center",t.innerHTML="TOTAL".bold();let o=e.insertCell(-1);o.style.textAlign="right",o.style.paddingRight="5px",o.style.whiteSpace="nowrap",o.innerHTML=formatNumber(tPvp).bold();let n=e.insertCell(-1);n.style.textAlign="right",n.style.paddingRight="5px",n.style.whiteSpace="nowrap",n.innerHTML=formatNumber(tProfit).bold()}hideNotification()}n.value=1,setResultTotalPages(n.id,r.id,t),n.onchange=function(){d()},r.onchange=function(){setResultTotalPages(n.id,r.id,t),d()},d()}},c.send(l)}function productStockActualReportTypeOnChange(){var e=document.getElementById("selProdEstActReportType").value,t=document.getElementById("tdProdEstActLastEntrance"),o=document.getElementById("tdProdEstActLastMoviment");2==e?(t.innerHTML="Vendas esperadas",o.innerHTML="Lucro estimado"):(t.innerHTML="Última Entrada",o.innerHTML="Última Saída"),cleanElement("tblProdEstActMainTable")}function productListOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){fillSelectProductSection("selProdLisProductSection",-1),fillSelectProductCategory("selProdLisProductCategory",-1),fillSelectProductFamilyBrandModel("selProdLisFamily","productfamily",-1),fillSelectProductFamilyBrandModel("selProdLisBrand","productbrand",-1),hideNotification()})}function productListGetList(e){var t=SYSTEM_USER_STATUS.companyId,o=document.getElementById("selProdLisProductSection").value,n=document.getElementById("selProdLisProductCategory").value,r=document.getElementById("selProdLisFamily").value,d=document.getElementById("selProdLisBrand").value,i=document.getElementById("selProdLisStock").value;showNotification();var a=new XMLHttpRequest,c="action=getProductList&companyId="+t+"&sectionId="+o+"&productCategory="+n+"&family="+r+"&brand="+d+"&stock="+i,l=URL_SA_PRODUCT_SALE_X;a.open("POST",l,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter();var t=e.length,o=document.getElementById("numResultPageNumber"),n=document.getElementById("numResultItems");function r(){var r=Number(o.value),d=Number(n.value),i=(r-1)*d,a=i+d;a>t&&(a=t),setElementInnerHtml("lbResultOnList",a+" / "+t);let c=document.getElementById("tblProdLisMainTable");c.innerHTML="";for(var l=i,u=i;u<a;u++){var s=e[u];l+=1;let t=JSON.parse(s);var m=Number(t.warehouseprice),p=Number(t.indirectcost)/100+Number(t.commercialcost)/100,P=Number(m+m*p);p=Number(p*m);var g=Number(t.estimatedprofit*P)/100,S=(Number(t.sellercomission)/100+Number(t.managercomission)/100)*m,y=(Number(t.fundinvestment)/100+Number(t.fundreserve)/100+Number(t.fundsocialaction)/100)*m,E=(m+p+g+S+y)*(Number(t.iva)/100),C=P+g+S+y+E;let o=c.insertRow(-1);o.id="trProductList"+t.id,o.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_PRODUCT_LIST",o.id));let n=o.insertCell(-1);n.setAttribute("class","colRowNumber"),n.innerHTML=l;let r=o.insertCell(-1);r.setAttribute("class","colProductId"),r.innerHTML=t.id,o.insertCell(-1).innerHTML=t.productdescription;let d=o.insertCell(-1);d.setAttribute("class","colProductId"),d.innerHTML=t.strproductsection;let i=o.insertCell(-1);i.setAttribute("class","colProductId"),i.innerHTML=t.productcategory;let a=o.insertCell(-1);a.style.textAlign="right",a.style.paddingRight="5px",a.style.whiteSpace="nowrap",a.innerHTML=formatNumber(m);let h=o.insertCell(-1);h.style.textAlign="right",h.style.paddingRight="5px",h.style.whiteSpace="nowrap",h.innerHTML=formatNumber(p);let v=o.insertCell(-1);v.style.textAlign="right",v.style.paddingRight="5px",v.style.whiteSpace="nowrap",v.innerHTML=formatNumber(S);let f=o.insertCell(-1);f.style.textAlign="right",f.style.paddingRight="5px",f.style.whiteSpace="nowrap",f.innerHTML=formatNumber(y);let T=o.insertCell(-1);T.style.textAlign="right",T.style.paddingRight="5px",T.style.whiteSpace="nowrap",T.innerHTML=formatNumber(g);let I=o.insertCell(-1);I.style.textAlign="right",I.style.paddingRight="5px",I.style.whiteSpace="nowrap",I.innerHTML=formatNumber(E);let N=o.insertCell(-1);N.style.textAlign="right",N.style.paddingRight="5px",N.style.whiteSpace="nowrap",N.innerHTML=formatNumber(C).bold();let R=o.insertCell(-1);R.setAttribute("class","noPrint");let A=document.createElement("button");A.setAttribute("class","labelEdit"),A.type="button",A.name=t.id,A.onclick=function(){productListEdit(A.name),setSelectedRowOnClick(o,"SELECTED_ROW_PRODUCT_LIST")},R.appendChild(A),R.style.textAlign="center",R.style.width="60px"}hideNotification()}o.value=1,setResultTotalPages(o.id,n.id,t),o.onchange=function(){r()},n.onchange=function(){setResultTotalPages(o.id,n.id,t),r()},r()}},a.send(c)}function productListEdit(e){showParts("divProdLisProdutoNovo"),productProdutOpen(e)}function productSetUploadPhoto(e=1024e3,t="PRODUCT"){var o={1:"JPEG",2:"JPG",3:"PNG"};o=JSON.stringify(o);var n=document.getElementById("divProdCadUploadPhoto");n.ondragover=n.ondragenter=function(e){e.stopPropagation(),e.preventDefault()},n.ondrop=function(n){n.stopPropagation(),n.preventDefault();for(var r=n.dataTransfer.files,d=0;d<r.length;d++)sendFile(r[d],o,e,t,"pProdCadUploadMsg","lbProdCadOldPhoto","lbProdCadNewPhoto","imgProdCadPhoto")}}function productStockReportOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){fillSelectProductStock("selProdEstRelStock",-1,-1),fillSelectProductSection("selProdEstRelProductSection",-1),fillSelectProductIvaCategory("selProdEstRelProductIvaCategory",-1),fillSelectProductFamilyBrandModel("selProdEstRelFamily","productfamily",-1),fillSelectProductFamilyBrandModel("selProdEstRelBrand","productbrand",-1),setTriggerButtonByText("txtProdEstRelInitialDate","btProdEstRelViewAll"),setTriggerButtonByText("txtProdEstRelEndDate","btProdEstRelViewAll"),hideNotification()})}function productStockReportListGetList(e){var t=SYSTEM_USER_STATUS.companyId,o=document.getElementById("selProdEstRelStock").value,n=document.getElementById("txtProdEstRelInitialDate").value,r=document.getElementById("txtProdEstRelEndDate").value,d=document.getElementById("selProdEstRelProductSection").value,i=document.getElementById("selProdEstRelProductIvaCategory").value,a=document.getElementById("selProdEstRelFamily").value,c=document.getElementById("selProdEstRelBrand").value;if(isNaN(o)||Number(o)<=0)return showNotification("Deve seleccionar um armazém.",0),!1;showNotification();var l=new XMLHttpRequest,u="action=getProductStockReport&companyId="+t+"&initalDate="+n+"&endDate="+r+"&stockId="+o+"&sectionId="+d+"&categoryId="+i+"&family="+a+"&brand="+c,s=URL_SA_PRODUCT_SALE_X;l.open("POST",s,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter();var t=e.length,o=document.getElementById("numResultPageNumber"),n=document.getElementById("numResultItems");function r(){var r=Number(o.value),d=Number(n.value),i=(r-1)*d,a=i+d;a>t&&(a=t),setElementInnerHtml("lbResultOnList",a+" / "+t);let c=document.getElementById("tblProdEstRelMainTable");c.innerHTML="";for(var l=i,u=i;u<a;u++){var s=e[u];l+=1;let t=JSON.parse(s),o=c.insertRow(-1);o.setAttribute("class","borderGray");let n=o.insertCell(-1);n.setAttribute("class","colRowNumber"),n.innerHTML=l;let r=o.insertCell(-1);r.setAttribute("class","colProductId"),r.innerHTML=t.id,o.insertCell(-1).innerHTML=t.productdescription;let d=o.insertCell(-1);d.style.textAlign="center",d.innerHTML=formatNumber(t.billing),0==t.billing&&(d.style.color="gray");let i=o.insertCell(-1);i.style.textAlign="center",i.innerHTML=formatNumber(t.entrance),0==t.entrance&&(i.style.color="gray");let a=o.insertCell(-1);a.style.textAlign="center",a.innerHTML=formatNumber(t.delivery).italics(),0==t.delivery&&(a.style.color="gray");let m=o.insertCell(-1);m.style.textAlign="center",m.innerHTML=formatNumber(t.internalMoviment).italics(),0==t.internalMoviment&&(m.style.color="gray");let p=o.insertCell(-1);p.style.textAlign="center",p.innerHTML=formatNumber(t.internConsuption).italics(),0==t.internConsuption&&(p.style.color="gray");let P=o.insertCell(-1);P.style.textAlign="center",P.innerHTML=formatNumber(t.down).italics(),0==t.down&&(P.style.color="gray");let g=o.insertCell(-1);g.style.textAlign="center",g.innerHTML=formatNumber(t.supplierReturn).italics(),0==t.supplierReturn&&(g.style.color="gray")}hideNotification()}o.value=1,setResultTotalPages(o.id,n.id,t),o.onchange=function(){r()},n.onchange=function(){setResultTotalPages(o.id,n.id,t),r()},r()}},l.send(u)}function productOnProductTypeChange(e){document.getElementById("selProdCadProductType").value=e;const t=document.getElementById("divProdCadFamily"),o=document.getElementById("divProdCadBrand"),n=document.getElementById("divProdCadModel"),r=document.getElementById("divProdCadRelativeSize"),d=document.getElementById("divProdCadUnitMeasure"),i=document.getElementById("txtProdCadProducUnit"),a=document.getElementById("fldsProdCadSizeAndWeight"),c=document.getElementById("lbProdCadSpanSizeAndWeight"),l=document.getElementById("divProdCadStock"),u=document.getElementById("rangeProdCadProductStock"),s=document.getElementById("divProdCadMinimoStock");"S"==e?(t.style.display="none",o.style.display="none",n.style.display="none",r.style.display="none",d.style.display="none",i.value="UN",a.style.display="none",c.style.display="none",l.style.display="none",u.value=0,s.style.display="none"):(t.style.display="inline",o.style.display="inline",n.style.display="inline",r.style.display="inline",d.style.display="inline",c.style.display="block",l.style.display="inline",s.style.display="inline")}function productExpirationOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){fillSelectProductSection("selProdExpProductSection",-1),fillSelectProductCategory("selProdExpProductCategory",-1),fillSelectProductFamilyBrandModel("selProdExpFamily","productfamily",-1),fillSelectProductFamilyBrandModel("selProdExpBrand","productbrand",-1),hideNotification()})}function productExpirationGetList(e=-1){var t=SYSTEM_USER_STATUS.companyId,o=document.getElementById("selProdExpProductSection").value,n=document.getElementById("selProdExpProductCategory").value,r=document.getElementById("selProdExpFamily").value,d=document.getElementById("selProdExpBrand").value,i=document.getElementById("txtProdExpExpirationDate").value;PRODUCT_EXPIRATION_DATE_LINE=[],showNotification();var a=new XMLHttpRequest,c="action=getProductExpirationList&companyId="+t+"&productId="+e+"&sectionId="+o+"&productCategory="+n+"&family="+r+"&brand="+d+"&expirationDate="+i,l=URL_SA_PRODUCT_SALE_X;a.open("POST",l,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter();var t=e.length,o=document.getElementById("numResultPageNumber"),n=document.getElementById("numResultItems");function r(){var r=Number(o.value),d=Number(n.value),i=(r-1)*d,a=i+d;a>t&&(a=t),setElementInnerHtml("lbResultOnList",a+" / "+t);let c=document.getElementById("tblProdExpMainTable");c.innerHTML="";for(var l=i,u=i;u<a;u++){var s=e[u];l+=1;let t=JSON.parse(s),o=c.insertRow(-1);o.setAttribute("class","borderGray");let n=o.insertCell(-1);n.setAttribute("class","colRowNumber"),n.innerHTML=l;let r=o.insertCell(-1);r.setAttribute("class","colProductId"),r.innerHTML=t.id,o.insertCell(-1).innerHTML=t.productdescription;let d=o.insertCell(-1);d.setAttribute("class","colProductId"),d.innerHTML=t.strproductsection;let i=o.insertCell(-1);i.setAttribute("class","colProductId"),i.innerHTML=t.productcategory;var m=setLocalDate(t.expirationdate),p="black";if(validateDate(m)){var P=new Date;P.setDate(P.getDate()+1),m.getTime()<=P.getTime()?p="red":(P.setDate(P.getDate()+6),m.getTime()<=P.getTime()?p="orange":(P.setDate(P.getDate()+23),m.getTime()<=P.getTime()&&(p="blue")))}let a=o.insertCell(-1),g=document.createElement("input");g.type="date",g.value=t.expirationdate,g.style.color=p,g.name=l,g.onchange=function(){productExpirationDateChange(g.name,this.value)},a.appendChild(g),a.style.width="60px",PRODUCT_EXPIRATION_DATE_LINE[Number(l)-1]=t}hideNotification()}o.value=1,setResultTotalPages(o.id,n.id,t),o.onchange=function(){r()},n.onchange=function(){setResultTotalPages(o.id,n.id,t),r()},r()}},a.send(c)}function productExpirationDateChange(e,t){PRODUCT_EXPIRATION_DATE_LINE[Number(e)-1].expirationdate=t}function productExpirationSave(e){if(PRODUCT_EXPIRATION_DATE_LINE.length<=0)return showNotification("Lista vazia.",0),!1;if(1==ST_SA_WAITING_SERVER)return alert("Aguardando resposta do servidor. <br>"),!1;var t="&expirationLines={",o=0;PRODUCT_EXPIRATION_DATE_LINE.forEach(e=>(function(e){0!=e.status&&(0!=o&&(t+=","),t+='"'+o+'":'+JSON.stringify(e),o+=1)})(e)),t+="}",showNotification(),ST_SA_WAITING_SERVER=1;var n=new XMLHttpRequest,r="action=saveProductExpirationDates"+t;t=URL_SA_PRODUCT_SALE_X,n.open("POST",t,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){ST_SA_WAITING_SERVER=0;var e=JSON.parse(this.responseText);1==e.status?(showNotification(e.msg,1),setTimeout(function(){productExpirationGetList()},2e3)):showNotification(e.msg,0)}},n.send(r)}function productStockManualAjustOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){ENTRANCE_OF_GOODS_LINE=[],fillSelectProductStock("selProdStckManAjuStockSource",-1,1),fillSelectProductSection("selProdStckManAjuProductSection",-1),fillSelectProductCategory("selProdStckManAjuProductCategory",-1),setTriggerButtonByText("txtProdStckManAjuProduct","btProdStckManAjuAddProduct"),hideNotification()})}function productStockManualAjustStockOnChange(){ENTRANCE_OF_GOODS_LINE=[],cleanElement("tblProdStckManAjuMainTable")}function productStockManualAjustAddProduct(e){var t=SYSTEM_USER_STATUS.companyId,o=document.getElementById("selProdStckManAjuStockSource").value;const n=document.getElementById("txtProdStckManAjuProduct");if(Number(o)<=0)return showNotification("Deve seleccionar o armazém.",0),!1;var r=reviewString(n);if(""==r)return showNotification("Por favor, indicar um código de barra válido",0),n.value="",n.focus(),!1;if(productStockManualAjustCheckItemOnLines(r))return showNotification("Produto já adicionado",0),n.value="",n.focus(),!1;showNotification();var d=SYSTEM_USER_STATUS.companyId,i=new XMLHttpRequest,a="action=getProductFullDescription&companyId="+t+"&productId="+r+"&isNote=0&stockId="+o+"&workplaceId="+d,c=URL_SA_PRODUCT_SALE_X;i.open("POST",c,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=this.responseText;let i=document.getElementById("tblProdStckManAjuMainTable");var t=Number(i.rows.length)+1;if(""==e)return n.focus(),showNotification("Produto / serviço não encontrado",0),!1;var o=JSON.parse(this.responseText);if("P"!=o.producttype)return showNotification("Só pode adicionar produtos.",0),!1;var r=o.productdescription,d=new _entranceOfGoodsLine;d.productID=o.id,d.productDescription=r,d.productUnit=o.productunit,d.productSection=o.productsection,d.productStock=o.productstock,d.quant=0,d.stockActualMA=o.productstockactual,d.nextStockMA=o.productstockactual,ENTRANCE_OF_GOODS_LINE[Number(t-1)]=d;let a=i.insertRow(-1);a.setAttribute("class","borderGray"),a.setAttribute("id","trProdStckManAjuLine"+t);let c=a.insertCell(-1);c.setAttribute("class","colRowNumber"),c.innerHTML=t;let l=a.insertCell(-1);l.setAttribute("class","colProductId"),l.innerHTML=d.productID;let u=a.insertCell(-1);u.style.minWidth="150px",u.innerHTML=r;const s=t;let m=a.insertCell(-1);m.style.textAlign="center",m.style.width="60px",m.innerHTML=formatNumber(d.stockActualMA);let p=a.insertCell(-1),P=document.createElement("input");P.type="number",P.id="numProdStckManAjuNext"+s,P.step="any",P.value=Number(d.nextStockMA).toFixed(2),P.onchange=function(){productStockManualAjustNextChange(s,this)},p.appendChild(P),p.style.minWidth="120px",hideNotification()}},i.send(a)}function productStockManualAjustCheckItemOnLines(e){var t=!1;return ENTRANCE_OF_GOODS_LINE.forEach(o=>(function(o){if(o.productid==e)return t=!0,!0})(o)),t}function productStockManualAjustAddProductBySectionCategory(e){var t=SYSTEM_USER_STATUS.companyId,o=document.getElementById("selProdStckManAjuProductSection").value,n=document.getElementById("selProdStckManAjuProductCategory").value,r=document.getElementById("selProdStckManAjuStockSource").value;if(Number(r)<=0)return showNotification("Deve seleccionar o armazém.",0),!1;showNotification();var d=new XMLHttpRequest,i="action=getProductBySectionByCategory&companyId="+t+"&sectionId="+o+"&productCategory="+n,a=URL_SA_PRODUCT_SALE_X;d.open("POST",a,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){let t=JSON.parse(e);document.getElementById("txtProdStckManAjuProduct").value=t.id,productStockManualAjustAddProduct("")})(e)),hideNotification()}},d.send(i)}function productStockManualAjustNextChange(e,t){var o=_entranceOfGoodsLine;(o=ENTRANCE_OF_GOODS_LINE[Number(e)-1]).nextStockMA=t.value,o.diferenceMA=Number(o.nextStockMA)-Number(o.stockActualMA),o.quant=o.diferenceMA}function productStockManualAjustSave(e){var t=!1,o="",n=document.getElementById("selProdStckManAjuStockSource").value;if(Number(n)<=0&&(t=!0,o+="Deve seleccionar um armazém. <br>"),ENTRANCE_OF_GOODS_LINE.length<=0&&(t=!0,o+="Lista vazia. <br>"),1==ST_SA_WAITING_SERVER&&(t=!0,o+="Aguardando resposta do servidor. <br>"),t)return alert(o),!1;showConfirm("Tem a certeza que deseja guardar este ajuste de estoque?",function(){var e=new _entranceOfGoods;e.companyId=SYSTEM_USER_STATUS.companyId,e.dependencyid=SYSTEM_USER_STATUS.workplaceId,e.userId=SYSTEM_USER_STATUS.userId,e.invoiceType="GE",e.invoiceSerie=invoiceDucumentSerie("GE"),e.invoiceNumber="GE 2021/1",e.totalItems=0,e.movimentsource=3,e.supplier=-1,e.stocksource=-1,e.reference="",e.movimentDate=new Date,e.stockTarget=n;var t="&&newEntranceOfGoods="+JSON.stringify(e);t+="&&entranceLines={";var o=0;ENTRANCE_OF_GOODS_LINE.forEach(e=>(function(e){0!=e.status&&0!=e.quant&&(0!=o&&(t+=","),t+='"'+o+'":'+JSON.stringify(e),o+=1)})(e)),t+="}",showNotification(),ST_SA_WAITING_SERVER=1;var r=new XMLHttpRequest,d="action=saveEntranceNew"+t;t=URL_SA_ENTRANCE_OF_GOODS_X,r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;var e=JSON.parse(r.responseText);if(1==e.status){var t=document.getElementById("lbHearderCompanyName").innerHTML,o=e.invoiceNumber,n=e.in,d=DOCUMENT_TYPE[n.slice(0,2)]+" nº"+n;showPrintOptions(function(){entrancePrintReceipt(o)},function(){entrancePrintA4(o)},function(){var e=document.getElementById("txtPriPrevCustomerEmail").value;entranceSendByEmail(o,t,d,"",e)},function(){var e=document.getElementById("btPriPrevSendWhatsApp").value;entranceSendByWhatsApp(o,d,"",e)},"",""),setTimeout(function(){productStockManualAjustStockOnChange(),hideNotification()},2e3)}else showNotification("Talvés alguma coisa não correu bem...",0)}},r.send(d)})}function productStockManualAjustNewProduct(){productProdutOpen(-1),showParts("divProdStckManAjuProductRegister")}function productRegisterLoteOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){PRODUCT_REGISTER_LINES=[],"GME"==e?showParts("divProdRegLoteNUS"):hideParts("divProdRegLoteNUS"),hideNotification()})}function productRegisterLoteAddProductFromCSV(){document.getElementById("txtProdRegLoteCSV").value.split("/-.").forEach(e=>(function(e){var t=new _product,o=e.split(";");t.producttype=o[0].toUpperCase(),t.productcategory=o[1].toUpperCase(),t.productfamily=o[2].toUpperCase(),t.productbrand=o[3].toUpperCase(),t.productmodel=o[4].toUpperCase(),t.productunit=o[5].toUpperCase(),t.productdescription=o[6].toUpperCase(),t.productnumbercode=o[7].toUpperCase(),t.productsection=o[8],t.productstock=o[9],t.productivacategory=o[10],t.warehouseprice=o[11],t.estimatedprofit=o[12],t.iva=o[13],productRegisterLoteAddProduct(t)})(e))}function productRegisterLoteAddProduct(e=0){showNotification();let t=document.getElementById("tblProdRegLoteMainTable");var o=Number(t.rows.length)+1,n=new _product;0!=e&&(n=e),n.status=1,PRODUCT_REGISTER_LINES[Number(o-1)]=n;let r=t.insertRow(-1);r.setAttribute("class","borderGray");let d=r.insertCell(-1);d.setAttribute("class","colRowNumber"),d.innerHTML=o;let i=r.insertCell(-1),a=document.createElement("select"),c=document.createElement("option");c.value="P",c.innerHTML="Producto";let l=document.createElement("option");l.value="S",l.innerHTML="Serviço",a.appendChild(c),a.appendChild(l),a.value=n.producttype,a.onchange=function(){productRegisterLoteOnChange(o,this,"producttype")},i.appendChild(a),i.style.width="100px";let u=r.insertCell(-1);u.style.width="150px";let s=document.createElement("select");s.id="selProdRegLoteCategory"+o,s.onchange=function(){productRegisterLoteOnChange(o,this,"productcategory")},u.appendChild(s),fillSelectProductCategory(s.id,1,n.productcategory);let m=r.insertCell(-1);m.style.width="150px";let p=document.createElement("input");p.setAttribute("class","textUpperUcase"),p.id="txtProdRegLoteFamily"+o,p.type="text",p.placeholder="ex. Telemóvel",p.maxlength="195",p.value=n.productfamily,p.onchange=function(){productRegisterLoteOnChange(o,this,"productfamily")},m.appendChild(p),setAutoCompleteToFiel(p.id,6);let P=r.insertCell(-1);P.style.width="150px";let g=document.createElement("input");g.id="txtProdRegLoteBrand"+o,g.setAttribute("class","textUpperUcase"),g.type="text",g.placeholder="ex. Samsung",g.maxlength="45",g.value=n.productbrand,g.onchange=function(){productRegisterLoteOnChange(o,this,"productbrand")},P.appendChild(g),setAutoCompleteToFiel(g.id,7);let S=r.insertCell(-1);S.style.width="150px";let y=document.createElement("input");y.id="txtProdRegLoteModel"+o,y.setAttribute("class","textUpperUcase"),y.type="text",y.placeholder="ex. Galaxy S20",y.maxlength="45",y.value=n.productmodel,y.onchange=function(){productRegisterLoteOnChange(o,this,"productmodel")},S.appendChild(y),setAutoCompleteToFiel(y.id,8);let E=r.insertCell(-1);E.style.width="50px";let C=document.createElement("input");C.id="txtProdRegLoteUnit"+o,C.setAttribute("class","textUpperUcase"),C.type="text",C.value=n.productunit,C.placeholder=" ex. UN",C.maxlength="8",C.onchange=function(){productRegisterLoteOnChange(o,this,"productunit")},E.appendChild(C);let h=r.insertCell(-1);h.style.width="250px";let v=document.createElement("input");v.id="txtProdRegLoteDescription"+o,v.setAttribute("class","textUpperUcase"),v.type="text",v.placeholder=" ex. Telemóvel Samsung Galaxy S20 5pol",v.maxlength="195",v.value=n.productdescription,v.onchange=function(){productRegisterLoteOnChange(o,this,"productdescription")},h.appendChild(v);let f=r.insertCell(-1);f.style.width="150px";let T=document.createElement("input");T.id="txtProdRegLoteBarCode"+o,T.setAttribute("class","textUpperUcase"),T.type="text",T.maxlength="45",T.value=n.productnumbercode,T.onchange=function(){productRegisterLoteOnChange(o,this,"productnumbercode")},f.appendChild(T);let I=r.insertCell(-1);I.style.width="150px";let N=document.createElement("select");N.id="selProdRegLoteSection"+o,N.onchange=function(){productRegisterLoteOnChange(o,this,"productsection")},I.appendChild(N),fillSelectProductSection(N.id,-1);let R=r.insertCell(-1);R.style.width="50px";let A=document.createElement("input");A.type="range",A.min=0,A.max=1,A.value=n.productstock,A.onchange=function(){productRegisterLoteOnChange(o,this,"productstock")},R.appendChild(A);let b=r.insertCell(-1);b.style.width="150px";let w=document.createElement("select");w.id="selProdRegLoteIva Category"+o,w.onchange=function(){productRegisterLoteOnChange(o,this,"productivacategory")},b.appendChild(w),fillSelectProductIvaCategory(w.id,1,n.productivacategory);let _=r.insertCell(-1),x=document.createElement("input");x.type="number",x.id="numProdRegLoteWarehousePrice"+o,x.min=0,x.step="any",x.value=n.warehouseprice,x.onchange=function(){productRegisterLoteOnChange(o,this,"warehouseprice",!0)},_.appendChild(x),_.style.minWidth="120px";let L=r.insertCell(-1),B=document.createElement("input");B.type="number",B.id="numProdRegLoteProfit"+o,B.min=0,B.step="any",B.value=n.estimatedprofit,B.onchange=function(){productRegisterLoteOnChange(o,this,"estimatedprofit",!0)},L.appendChild(B),L.style.width="60px";let O=r.insertCell(-1),U=document.createElement("input");U.type="number",U.id="numProdRegLoteIva"+o,U.min=0,U.max=100,U.step="any",U.style.width="50px",U.value=n.iva,U.onchange=function(){productRegisterLoteOnChange(o,this,"iva",!0)},O.style.width="60px",O.appendChild(U);let M=r.insertCell(-1);var D=document.createElement("button");D.setAttribute("class","labelRemove"),D.type="button",D.onclick=function(){r.innerHTML="",PRODUCT_REGISTER_LINES[Number(o-1)].status=0},M.appendChild(D),M.style.textAlign="center",M.style.width="10px",hideNotification()}function productRegisterLoteCleanTable(){PRODUCT_REGISTER_LINES=[],cleanElement("tblProdRegLoteMainTable")}function productRegisterLoteOnChange(e,t,o,n=!1){var r=t.value;n?(isNaN(r)&&(r=0),r<0&&(r=0),"iva"==o&&r>100&&(r=100),t.value=r):r=reviewString(t).toString().toUpperCase(),PRODUCT_REGISTER_LINES[Number(e)-1][o]=r}function productRegisterLoteSave(e){var t="&&productLines={",o=0;PRODUCT_REGISTER_LINES.forEach(e=>(function(e){0!=e.status&&(0!=o&&(t+=","),t+='"'+o+'":'+JSON.stringify(e),o+=1)})(e)),t+="}";var n=SYSTEM_USER_STATUS.companyId;if("GME"==e&&(n=reviewString(document.getElementById("txtProdRegLoteNUS")),isNaN(n)||""==n))return alert("Deve indicar o código NUS da empresa"),!1;if(o<=0)return alert("Deve adicionar pelo menos um produto."),!1;if(1==ST_SA_WAITING_SERVER)return alert("Aguardando resposta do servidor. <br>"),!1;showNotification(),ST_SA_WAITING_SERVER=1;var r=new XMLHttpRequest,d="action=saveProductLote&companyId="+n+t;t=URL_SA_PRODUCT_SALE_X,r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){ST_SA_WAITING_SERVER=0;var e=JSON.parse(this.responseText);1==e.status?(showNotification(e.msg,1),productRegisterLoteCleanTable()):showNotification(e.msg,0)}},r.send(d)}