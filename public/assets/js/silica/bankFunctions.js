function bankAccountBankOnLoad(e){showNotification(), checkUserStatusAfterExecute(function(){fillSelectNationalBank("selBanConNationalBank", - 1), maskInputByPlaceHold("txtBanConAccountNumber"), maskInputByPlaceHold("txtBanConIban"), bankAccountBankNew(""), bankAccountBankList(""), hideNotification()})}function bankAccountBankNew(e){showDivFilter(), document.getElementById("txtBanConAccountId").value = "Nova conta"; var t = document.getElementById("selBanConNationalBank"); t.value = - 1, t.disabled = "", document.getElementById("txtBanConAgency").value = "", document.getElementById("txtBanConAccountNumber").value = "", document.getElementById("txtBanConIban").value = "", document.getElementById("txtBanConSwift").value = "", document.getElementById("selBanConAvailiableOnInvoice").value = 1, document.getElementById("txtBanConAccountNumber").focus(), dispatchOnInputChange()}function bankAccountBankList(e){showNotification(); var t = new XMLHttpRequest, n = "action=getBankAccountList&companyId=" + SYSTEM_USER_STATUS.companyId + "&accountId=-1", a = URL_SA_BANK_X; t.open("POST", a, !0), t.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), t.onreadystatechange = function(){if (4 == this.readyState && 200 == this.status){try{var e = JSON.parse(this.responseText)} catch (e){return showHttpResponseText(t), !1}e.length <= 0?showNotification("Não encontrado.", 0):hideDivFilter(); var n = e.length, a = document.getElementById("numResultPageNumber"), o = document.getElementById("numResultItems"); function i(){var t = Number(a.value), i = Number(o.value), c = (t - 1) * i, l = c + i; l > n && (l = n), setElementInnerHtml("lbResultOnList", l + " / " + n); let s = document.getElementById("tblBanConMainTable"); s.innerHTML = ""; for (var u = c, r = c; r < l; r++){var d = e[r]; u += 1; let t = JSON.parse(d), n = s.insertRow( - 1); n.setAttribute("class", "borderGray"); let a = n.insertCell(n.cells.length); a.setAttribute("class", "colRowNumber"), a.innerHTML = u; let o = n.insertCell(n.cells.length); o.setAttribute("class", "colProductId"), o.innerHTML = t.id, n.insertCell(n.cells.length).innerHTML = t.bankname, n.insertCell(n.cells.length).innerHTML = t.accountnumber, n.insertCell(n.cells.length).innerHTML = t.iban; let i = n.insertCell(n.cells.length); i.setAttribute("class", "colSimNao"); var m = "Sim"; 1 != t.availiableoninvoice && (m = "Não"), i.innerHTML = m; let c = n.insertCell(n.cells.length); c.setAttribute("class", "noPrint"); let l = document.createElement("button"); l.type = "button", l.setAttribute("class", "labelEdit"); const T = t.id; l.onclick = function(){showDivFilter(), bankEditAccountBank(T)}, c.appendChild(l); let B = document.createElement("button"); B.setAttribute("class", "labelDelete"), B.type = "button", B.onclick = function(){bankDeleteAccountBank(T)}, c.appendChild(B)}}a.value = 1, setResultTotalPages(a.id, o.id, n), a.onchange = function(){i()}, o.onchange = function(){setResultTotalPages(a.id, o.id, n), i()}, hideNotification()}i()}, t.send(n)}function bankSaveAccountBank(e){var t = !1, n = "", a = SYSTEM_USER_STATUS.companyId, o = document.getElementById("txtBanConAccountId").value, i = document.getElementById("selBanConNationalBank").value, c = reviewString(document.getElementById("txtBanConAgency")), l = reviewString(document.getElementById("txtBanConAccountNumber")).replace(/[^A-Z0-9\s\-]/g, ""), s = reviewString(document.getElementById("txtBanConIban")).replace(/[^0-9\AO\s]/g, ""), u = reviewString(document.getElementById("txtBanConSwift")), r = document.getElementById("selBanConAvailiableOnInvoice").value; if (Number(i) <= 0 && (t = !0, n += "Deve indicar o banco. <br>"), "" == l && "" == s && (t = !0, n += "Deve indicar o número da conta ou o IBAN. <br>"), s.length > 0 && 31 != s.length && (t = !0, n += "IBAN fora do formato. <br>"), 1 == ST_SA_WAITING_SERVER && (t = !0, n += "Aguardando resposta do servidor. <br>"), t)return alert(n), !1; showNotification(), ST_SA_WAITING_SERVER = 1; var d = "&companyId=" + a + "&accountId=" + o + "&agency=" + c + "&nationalBankId=" + i + "&accountNumber=" + l + "&iban=" + s + "&swift=" + u + "&&availiable=" + r, m = new XMLHttpRequest, T = "action=saveBankAccountBank" + d; d = URL_SA_BANK_X; m.open("POST", d, !0), m.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), m.onreadystatechange = function(){if (4 == this.readyState && 200 == this.status){ST_SA_WAITING_SERVER = 0; var e = JSON.parse(m.responseText); 1 == e.status?(showNotification(e.msg, 1), bankAccountBankList(""), bankAccountBankNew("")):showNotification(e.msg, 0)}}, m.send(T)}function bankEditAccountBank(e){var t = new XMLHttpRequest, n = "action=getBankAccountList&companyId=" + SYSTEM_USER_STATUS.companyId + "&accountId=" + e, a = URL_SA_BANK_X; t.open("POST", a, !0), t.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), t.onreadystatechange = function(){if (4 == this.readyState && 200 == this.status){JSON.parse(this.responseText).forEach(e => (function(e){var t = JSON.parse(e); document.getElementById("txtBanConAccountId").value = t.id; var n = document.getElementById("selBanConNationalBank"); n.value = t.nationalbankid, n.disabled = "true", document.getElementById("txtBanConAgency").value = t.agency, document.getElementById("txtBanConAccountNumber").value = t.accountnumber, document.getElementById("txtBanConIban").value = t.iban, document.getElementById("txtBanConSwift").value = t.swift, document.getElementById("selBanConAvailiableOnInvoice").value = t.availiableoninvoice, dispatchOnInputChange()})(e))}}, t.send(n)}function bankDeleteAccountBank(e){if (isNaN(e))return!1; showConfirm("Tem a certeza que deseja apagar esta conta bancária?", function(){showNotification(); var t = new XMLHttpRequest, n = "action=deleteBankAccount&&accountId=" + e, a = URL_SA_BANK_X; t.open("POST", a, !0), t.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), t.onreadystatechange = function(){if (4 == this.readyState && 200 == this.status){var e = JSON.parse(t.responseText); 1 == e.status?(showNotification(e.msg, 1), bankAccountBankList("")):showNotification(e.msg, 0)}}, t.send(n)})}function bankTpaTerminalOnLoad(e){showNotification(), checkUserStatusAfterExecute(function(){fillSelectAccountBank("selBanTerAccountBank", - 1), setAutoCompleteToFiel("txtBanTerDesignation", 4, 1), bankTpaTerminalNew(""), bankTpaTerminalList(""), hideNotification()})}function bankTpaTerminalNew(e){showDivFilter(), document.getElementById("txtBanTerTpaId").value = "Novo TPA"; var t = document.getElementById("selBanTerAccountBank"); t.value = - 1, t.disabled = "", document.getElementById("txtBanTerDesignation").value = "", document.getElementById("numBanTerHoldingTax").value = 0, document.getElementById("txtBanTerDesignation").focus(), dispatchOnInputChange()}function bankTpaTerminalList(e){showNotification(); var t = new XMLHttpRequest, n = "action=getBankTpaTerminalList&companyId=" + SYSTEM_USER_STATUS.companyId + "&tpaId=-1", a = URL_SA_BANK_X; t.open("POST", a, !0), t.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), t.onreadystatechange = function(){if (4 == this.readyState && 200 == this.status){var e = JSON.parse(this.responseText); e.length <= 0?showNotification("Não encontrado.", 0):hideDivFilter(); var t = e.length, n = document.getElementById("numResultPageNumber"), a = document.getElementById("numResultItems"); function o(){var o = Number(n.value), i = Number(a.value), c = (o - 1) * i, l = c + i; l > t && (l = t), setElementInnerHtml("lbResultOnList", l + " / " + t); let s = document.getElementById("tblBanTerMainTable"); s.innerHTML = ""; for (var u = c, r = c; r < l; r++){var d = e[r]; u += 1; let t = JSON.parse(d), n = s.insertRow( - 1); n.setAttribute("class", "borderGray"); let a = n.insertCell( - 1); a.setAttribute("class", "colRowNumber"), a.innerHTML = u; let o = n.insertCell( - 1); o.setAttribute("class", "colProductId"), o.innerHTML = t.id, n.insertCell( - 1).innerHTML = t.designation, n.insertCell( - 1).innerHTML = t.accountbank; let i = n.insertCell( - 1); i.setAttribute("class", "colSimNao"), i.innerHTML = formatNumber(t.holdingtax); let c = n.insertCell( - 1); c.setAttribute("class", "noPrint"); let l = document.createElement("button"); l.setAttribute("class", "labelEdit"), l.type = "button"; const m = t.id; l.onclick = function(){showDivFilter(), bankTpaTerminalEdit(m)}, c.appendChild(l); let T = document.createElement("button"); T.setAttribute("class", "labelDelete"), T.type = "button", T.onclick = function(){bankTpaTerminalDelete(m)}, c.appendChild(T)}hideNotification()}n.value = 1, setResultTotalPages(n.id, a.id, t), n.onchange = function(){o()}, a.onchange = function(){setResultTotalPages(n.id, a.id, t), o()}, o()}}, t.send(n)}function bankTpaTerminalSave(e){var t = !1, n = "", a = document.getElementById("txtBanTerTpaId").value, o = document.getElementById("selBanTerAccountBank").value, i = reviewString(document.getElementById("txtBanTerDesignation")), c = document.getElementById("numBanTerHoldingTax").value; if (Number(o) <= 0 && (t = !0, n += "Deve incidar a conta bancária associada ao TPA."), "" == i && (t = !0, n += "Deve incidar a designação do TPA."), 1 == ST_SA_WAITING_SERVER && (t = !0, n += "Aguardando resposta do servidor. <br>"), alert(i), t)return alert(n), !1; showNotification(), ST_SA_WAITING_SERVER = 1; var l = new XMLHttpRequest, s = "action=saveBankTpaTerminal&companyId=" + SYSTEM_USER_STATUS.companyId + "&tpaId=" + a + "&accountBankId=" + o + "&designation=" + i + "&holdingTax=" + c, u = URL_SA_BANK_X; l.open("POST", u, !0), l.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), l.onreadystatechange = function(){if (4 == this.readyState && 200 == this.status){ST_SA_WAITING_SERVER = 0; var e = JSON.parse(l.responseText); 1 == e.status?(showNotification(e.msg, 1), bankTpaTerminalList(""), bankTpaTerminalNew("")):showNotification(e.msg, 0)}}, l.send(s)}function bankTpaTerminalEdit(e){var t = new XMLHttpRequest, n = "action=getBankTpaTerminalList&companyId=" + SYSTEM_USER_STATUS.companyId + "&tpaId=" + e, a = URL_SA_BANK_X; t.open("POST", a, !0), t.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), t.onreadystatechange = function(){if (4 == this.readyState && 200 == this.status){JSON.parse(this.responseText).forEach(e => (function(e){var t = JSON.parse(e); document.getElementById("txtBanTerTpaId").value = t.id; var n = document.getElementById("selBanTerAccountBank"); n.value = t.accountbankid, n.disabled = "true", document.getElementById("txtBanTerDesignation").value = t.designation, document.getElementById("numBanTerHoldingTax").value = t.holdingtax, dispatchOnInputChange()})(e))}}, t.send(n)}function bankTpaTerminalDelete(e){if (isNaN(e))return!1; showConfirm("Tem a certeza que deseja apagar este TPA?", function(){var t = new XMLHttpRequest, n = "action=deleteBankTpaTerminal&&tpaId=" + e, a = URL_SA_BANK_X; t.open("POST", a, !0), t.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), t.onreadystatechange = function(){var e = JSON.parse(t.responseText); 4 == this.readyState && 200 == this.status && (1 == e.status?(showNotification(e.msg, 1), bankTpaTerminalList(""), bankTpaTerminalNew("")):showNotification(e.msg, 0))}, t.send(n)})}