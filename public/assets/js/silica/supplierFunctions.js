class _supplier{constructor(e,t,n,i="",l="",r=1,o=-1,a=-1,s="",c="",u="",d="",p="",m="",S="",g="",y="",h="",v="",I="",C="",E=""){this.companyid=e,this.sourceid=t,this.supplierId=n,this.suppliertaxid=i,this.companyname=l,this.billingcountry=r,this.billingprovince=o,this.billingmunicipality=a,this.billingcity=s,this.billingdistrict=c,this.billingcomuna=u,this.billingneiborhood=d,this.billingstreetname=p,this.billingbuildingnumber=m,this.billingpostalcode=S,this.telephone1=g,this.telephone2=y,this.telephone3=h,this.email=v,this.website=I,this.contactperson=C,this.contactpersoncharge=E}}function supplierOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){var e=SYSTEM_USER_STATUS.companyId;fillSelectCountry("selForCadCountry"),fillSelectProvince("selForCadProvince",-1),fillSelectMunicipality("selForCadMunic",-1,-1);var t=document.getElementById("selForCadProvince");t.onclick=function(){fillSelectMunicipality("selForCadMunic",t.value,-1)},selectCountryChange("selForCadCountry","selForCadProvince","selForCadMunic","lbForCadCity"),supplerSetAutoComplete(e,"txtForCadSupplierName"),supplierGetInfo(-1),hideNotification()})}function supplierGetInfo(e=-1){var t=SYSTEM_USER_STATUS.companyId;const n=document.getElementById("txtForCadSupplierID"),i=document.getElementById("txtForCadSupplierName"),l=document.getElementById("txtForCadNIF"),r=document.getElementById("selForCadCountry"),o=document.getElementById("selForCadProvince"),a=document.getElementById("selForCadMunic"),s=document.getElementById("txtForCadCity"),c=document.getElementById("txtForCadDistrict"),u=document.getElementById("txtForCadComuna"),d=document.getElementById("txtForCadNeiborhood"),p=document.getElementById("txtForCadStreet"),m=document.getElementById("txtForCadBuidNumber"),S=document.getElementById("txtForCadPostal"),g=document.getElementById("txtForCadTelef1"),y=document.getElementById("txtForCadTelef2"),h=document.getElementById("txtForCadTelef3"),v=document.getElementById("txtForCadEmail"),I=document.getElementById("txtForCadWebsite"),C=document.getElementById("txtForCadContactPerson"),E=document.getElementById("txtForCadContactPersonCharge");if(-1==e)n.value="Novo fornecedor",i.value="",l.value="",r.value=1,o.value=-1,a.value=-1,s.value="",c.value="",u.value="",d.value="",p.value="",m.value="",S.value="",g.value="",y.value="",h.value="",v.value="",I.value="",C.value="",E.value="";else{var f=new XMLHttpRequest,T="action=getSupplierList&companyId="+t+"&supplierId="+e,b=URL_SA_SUPPLIER_X;f.open("POST",b,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(f.responseText).forEach(e=>(function(e){let t=JSON.parse(e);n.value=t.id,i.value=t.companyname,l.value=t.suppliertaxid,r.value=t.billingcountry,o.value=t.billingprovince,fillSelectMunicipality("selForCadMunic",t.billingprovince,-1,t.billingmunicipality),s.value=t.billingcity,c.value=t.billingdistrict,u.value=t.billingcomuna,d.value=t.billingneiborhood,p.value=t.billingstreetname,m.value=t.billingbuildingnumber,S.value=t.billingpostalcode,g.value=t.telephone1,y.value=t.telephone2,h.value=t.telephone3,v.value=t.email,I.value=t.website,C.value=t.contactperson,E.value=t.contactpersoncharge,dispatchOnInputChange()})(e))}},f.send(T)}i.focus()}function supplerSetAutoComplete(e,t){try{const r=document.getElementById(t);if(!validateUserControl(r))return!1;var n=new XMLHttpRequest,i="action=getSupplierAutocompleteList&companyId="+e,l=URL_SA_SUPPLIER_X;n.open("POST",l,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=this.responseText.split("-/-");autocomplete(r,e)}},n.send(i)}catch(e){showNotification(e.message,0)}}function supplierSearchOnLoad(e){checkUserStatusAfterExecute(function(){supplerSetAutoComplete(SYSTEM_USER_STATUS.companyId,"txtForProSearchSupplier"),setTriggerButtonByText("txtForProSearchSupplier","btForProSearchSupplier"),setSessionResultSearch("txtForProSearchSupplier"),setSessionResultSearch("numForProSearchLimit")})}function supplierSearchSupplier(e,t){try{var n=SYSTEM_USER_STATUS.companyId,i=document.getElementById("numForProSearchLimit").value,l=reviewString(document.getElementById("txtForProSearchSupplier"));if(isNaN(i)&&(i=5),1==ST_SA_SEARCHING_SERVER)return!1;setElementInnerHtml("lbSuppSeaResult","Procurando..."),ST_SA_SEARCHING_SERVER=1;var r=new XMLHttpRequest,o="action=getSupplierListSearch&searchLimit="+i+"&searchTag="+l+"&companyId="+n,a=URL_SA_SUPPLIER_X;r.open("POST",a,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){ST_SA_SEARCHING_SERVER=0;var n=JSON.parse(this.responseText);n.length<=0&&showNotification("Não encontrado",0);var l=n.length;n.length==i&&(l+=" ou mais"),setElementInnerHtml("lbSuppSeaResult","Encontrados: "+l);let r=document.getElementById("tblForProMainTable");r.innerHTML="";var o=0;n.forEach(n=>(function(n){o+=1;let i=JSON.parse(n),l=r.insertRow(-1);l.id="trSuppSearRow"+o,l.setAttribute("class","borderGray");let a=l.insertCell(l.cells.length);a.setAttribute("class","colRowNumber"),a.innerHTML=o,a.style.width="10px";let s=l.insertCell(l.cells.length);s.setAttribute("class","colProductId"),s.innerHTML=i.id,l.insertCell(l.cells.length).innerHTML=i.companyname,l.insertCell(l.cells.length).innerHTML=i.suppliertaxid;let c=l.insertCell(l.cells.length),u=document.createElement("div");u.id="btSuppSearView"+o,u.name=i.id,u.onclick=function(){"FORCAD"==t?supplierGetInfo(u.name):"FORHIS"==t?supplierHistoricGetInfo(u.name):"PRODESTSAILIS"==t?movimentListGet(-1,-1,-1,u.name):"PRODESTENTRLIS"==t&&entranceListGet(-1,-1,u.name),hideParts(e),r.innerHTML=""},c.appendChild(u),c.style.textAlign="center",c.style.height="30px",setTriggerButtonByRowDobleClick(l.id,u.id)})(n))}},r.send(o)}catch(e){showNotification(e.message,0)}}function supplierSaveSupplier(e){var t=SYSTEM_USER_STATUS.companyId,n=new _supplier;n.companyid=t,n.sourceid=SYSTEM_USER_STATUS.userId,n.supplierId=document.getElementById("txtForCadSupplierID").value,n.suppliertaxid=document.getElementById("txtForCadNIF").value,n.companyname=reviewString(document.getElementById("txtForCadSupplierName")).toUpperCase(),n.billingcountry=document.getElementById("selForCadCountry").value,n.billingprovince=document.getElementById("selForCadProvince").value,n.billingmunicipality=document.getElementById("selForCadMunic").value,n.billingcity=reviewString(document.getElementById("txtForCadCity")),n.billingdistrict=reviewString(document.getElementById("txtForCadDistrict")),n.billingcomuna=reviewString(document.getElementById("txtForCadComuna")),n.billingneiborhood=reviewString(document.getElementById("txtForCadNeiborhood")),n.billingstreetname=reviewString(document.getElementById("txtForCadStreet")),n.billingbuildingnumber=reviewString(document.getElementById("txtForCadBuidNumber")),n.billingpostalcode=reviewString(document.getElementById("txtForCadPostal")),n.telephone1=reviewString(document.getElementById("txtForCadTelef1")),n.telephone2=reviewString(document.getElementById("txtForCadTelef2")),n.telephone3=reviewString(document.getElementById("txtForCadTelef3")),n.email=reviewEmail(document.getElementById("txtForCadEmail").value),n.website=reviewString(document.getElementById("txtForCadWebsite")),n.contactperson=reviewString(document.getElementById("txtForCadContactPerson")),n.contactpersoncharge=reviewString(document.getElementById("txtForCadContactPersonCharge"));var i=!1,l="";if(""==n.companyname&&(i=!0,l+="Deve indicar o nome do fornecedor. <br>"),""==n.suppliertaxid?(i=!0,l+="Deve indicar o NIF do fornecedor. <br>"):validateTaxId(n.suppliertaxid)||(i=!0,l+="NIF fora do formato. <br>"),""==n.billingcity&&(i=!0,l+="Deve indicar a cidade. <br>"),""!=n.email&&(validateEmail(n.email)||(i=!0,l+="Email fora do formato. <br>")),1==ST_SA_WAITING_SERVER&&(i=!0,l+="Aguardando resposta do servidor. <br>"),1==i)return alert(l),!1;showNotification(),ST_SA_WAITING_SERVER=1;var r=new XMLHttpRequest,o="action=saveSupplierInfo&supplierInfo="+JSON.stringify(n),a=URL_SA_SUPPLIER_X;r.open("POST",a,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;var n=JSON.parse(r.responseText);1==n.status?(supplerSetAutoComplete(t,"txtForCadSupplierName"),supplierGetInfo(-1),showNotification(n.msg,1),"PROESTENTR"==e?(fillSelectSupplier("selProdEstEntrSupplier",-1),hideParts("divProdEstEntrSupplierRegister")):"TREBILLTPAY"==e?(fillSelectSupplier("selTreBillTPSupplier",-1),fillSelectSupplier("selTreBillTPDetSupplier",-1),hideParts("divTreBillTPSupplierRegister")):"TRECASOUT"==e&&hideParts("divTreCasOutSupplierRegister")):showNotification(n.msg,0),hideNotification()}},r.send(o)}function supplierListOnLoad(e){try{showNotification(),checkUserStatusAfterExecute(function(){selectCountryChange("selFORLISCountry","selFORLISProvince","selFORLISMunicipality",""),fillSelectCountry("selFORLISCountry",-1);const e=document.getElementById("selFORLISProvince");e.onchange=function(){fillSelectMunicipality("selFORLISMunicipality",e.value,-1,-1)},fillSelectProvince("selFORLISProvince",-1),supplierListDetails(""),hideNotification()})}catch(e){showNotification(e.message,0)}}function supplierListDetails(e){try{var t=SYSTEM_USER_STATUS.companyId,n=document.getElementById("selFORLISCountry").value,i=document.getElementById("selFORLISProvince").value,l=document.getElementById("selFORLISMunicipality").value;showNotification();var r=new XMLHttpRequest,o="action=getSupplierListDetails&companyId="+t+"&countryId="+n+"&provinceId="+i+"&municipalityId="+l,a=URL_SA_SUPPLIER_X;r.open("POST",a,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e={},t={},n=JSON.parse(this.responseText);n.length<=0?showNotification("Não encontrado.",0):hideDivFilter(),document.getElementById("lbResultOnList").innerHTML=n.length;let r=document.getElementById("tblFORLISDetailsTable");r.innerHTML="";var i=0,l=0;n.forEach(n=>(function(n){let o=JSON.parse(n);var a=getFirtLastName(o.operatorName)+" ("+o.sourceid+")",s=o.province,c=o.municipality;l+=1,addAmountResume(e,s,1),addAmountResume(t,c,1),i+=1;let u=r.insertRow(-1);u.setAttribute("class","borderGray");let d=u.insertCell(u.cells.length);d.setAttribute("class","colRowNumber"),d.innerHTML=i,u.insertCell(u.cells.length).innerHTML=a,u.insertCell(u.cells.length).innerHTML=s,u.insertCell(u.cells.length).innerHTML=c;let p=u.insertCell(u.cells.length);p.style.textAlign="center",p.innerHTML=o.id,u.insertCell(u.cells.length).innerHTML=o.companyname,u.insertCell(u.cells.length).innerHTML=o.suppliertaxid;let m=u.insertCell(u.cells.length);m.style.textAlign="center",m.innerHTML=setLocalDate(o.entrydate,10)})(n));let s=r.insertRow(-1);s.setAttribute("class","borderGray"),s.style.fontSize="large";let c=s.insertCell(-1);c.setAttribute("colspan","7"),c.style.textAlign="center",c.innerHTML="TOTAL".bold();let u=s.insertCell(-1);u.setAttribute("class","colAmount"),u.innerHTML=formatNumber(l).bold();var o=document.getElementById("tblCLILISResumeTable");for(var a in o.innerHTML="",i=0,e)i+=1,resume(o,i,"Província",e,a,"Cadastrados");for(var a in i=0,t)i+=1,resume(o,i,"Município",t,a,"Cadastrados");hideNotification()}},r.send(o)}catch(e){showNotification(e.message,0)}}function supplierHistoricGetInfo(e,t){setDocumentType("");const n=document.getElementById("txtForHisSupplierId"),i=document.getElementById("txtForHistSupplierName"),l=document.getElementById("txtForHisSupplierTaxId");var r=new XMLHttpRequest,o="action=getSupplierList&companyId="+e+"&supplierId="+t,a=URL_SA_SUPPLIER_X;r.open("POST",a,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(r.responseText).forEach(t=>(function(t){var r=JSON.parse(t);n.value=r.id,i.value=r.companyname,l.value=r.suppliertaxid,supplierHistoricGetHistoric(e,r.id)})(t))}},r.send(o)}function supplierHistoricGetHistoric(e,t){var n=new XMLHttpRequest,i="action=getSupplierHistoric&companyId="+e+"&supplierId="+t,l=URL_SA_SUPPLIER_X;n.open("POST",l,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);let i=document.getElementById("tblForHisMainTable");i.innerHTML="";var t="",n=0;e.forEach(e=>(function(e){n+=1;let l=JSON.parse(e);if(t!=l.invoicetype){t=l.invoicetype;let e=i.insertRow(-1);e.style.fontSize="large",e.setAttribute("class","borderGray");let r=e.insertCell(e.cells.length);r.setAttribute("class","colRowNumber"),r.innerHTML=n;let o=e.insertCell(e.cells.length);o.innerHTML=DOCUMENT_TYPE[l.invoicetype],o.setAttribute("colspan","3"),n+=1}let r=i.insertRow(-1);r.setAttribute("class","borderGray");let o=r.insertCell(r.cells.length);o.setAttribute("class","colRowNumber"),o.innerHTML=n,r.insertCell(r.cells.length).innerHTML=l.invoicenumber;let a=r.insertCell(r.cells.length);a.style.textAlign="center",a.innerHTML=setLocalDate(l.invoicedate,10),r.insertCell(r.cells.length).innerHTML=l.invoicestatus+" / "+getFirtLastName(l.operatorName)})(e))}},n.send(i)}