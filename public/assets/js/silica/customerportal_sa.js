function customerPortalListOnLoad(){try{showNotification(),checkUserStatusAfterExecute(function(){fillSelectDependencyFull("selCustPorLisDependency",-1,1),fillSelectCustomerType("selCustPorLisCustomerType",-1),fillSelectMunicipality("selCustPorLisMunicipality",SYSTEM_USER_STATUS.provinceId,-1,-1),fillSelectNeiborhood("selCustPorLisNeiborhood",2,-1),setTriggerButtonByText("txtCustPorLisInitialDate","btCustPorLisViewAll"),setTriggerButtonByText("txtCustPorLisEndDate","btCustPorLisViewAll"),document.getElementById("chbCustPorLisShowDate").onclick=function(){setEnableDisableByCheckBox(this.id,"txtCustPorLisInitialDate","txtCustPorLisEndDate")},checkPermission("3401")?showParts("btCustPorLisActivationCode",!0):hideParts("btCustPorLisActivationCode"),customerPortalList(),hideNotification()})}catch(t){showNotification(t.message,0)}}function customerPortalShowActivationCode(t){showParts("divCustomerPortalActivationCode"),setElementInnerHtml("txtCustPorActCodCustomerID",t.customerid),setElementInnerHtml("txtCustPorActCodCustomerName",t.companyname),setElementInnerHtml("selCustPorActCodCustomerType",CUSTOMER_TYPE[Number(t.customertype)]),setElementInnerHtml("txtCustPorActCodCustomerNIF",t.customertaxid),setElementValue("txtCustPorActCodTelef1",t.telephone1),setElementValue("txtCustPorActCodEmail",t.email);var e=SYSTEM_USER_STATUS.companyId.toString()+leadingZero(t.customerid,6).toString();setElementInnerHtml("txtCustPorActCodAccessName",e),setElementInnerHtml("txtCustPorActCodActivationCode","")}function customerPortalGenerateActivationCode(){var t=!1,e="",o={};if(o.companyid=SYSTEM_USER_STATUS.companyId,o.customerid=getElementInnerHtml("txtCustPorActCodCustomerID"),o.customername=getElementInnerHtml("txtCustPorActCodCustomerName"),o.accessname=getElementInnerHtml("txtCustPorActCodAccessName"),o.phone=reviewString(document.getElementById("txtCustPorActCodTelef1")).replace(/[^0-9]/g,""),o.email=reviewEmail(getElementValue("txtCustPorActCodEmail")),o.userId=SYSTEM_USER_STATUS.userId,""==o.phone&&(t=!0,e+="Deve indicar o número de telefone. <br>"),""!=o.email&&(validateEmail(o.email)||(t=!0,e+="E-mail fora do formato. <br>")),1==ST_SA_WAITING_SERVER&&(t=!0,e+="Aguardando resposta do servidor. <br>"),t)return alert(e),!1;showNotification(),ST_SA_WAITING_SERVER=1;var n=new XMLHttpRequest,s="action=getCustomerPortalActivationCode&customerInfo="+JSON.stringify(o),r=URL_SA_CUSTOMER_PORTAL_X;n.open("POST",r,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){ST_SA_WAITING_SERVER=0;try{var t=JSON.parse(n.responseText)}catch(t){showHttpResponseText(n)}1==t.status?(showNotification(t.msg,1),setElementInnerHtml("txtCustPorActCodActivationCode",t.activationcode)):showNotification(t.msg,0)}},n.send(s)}function customerPortalStatu(t){return 1==t?"Aguarda activação":2==t?"Activado pelo cliente":void 0}function customerPortalList(t=-1){try{if(1==ST_SA_LISTING_SERVER)return showNotification("Procurando...",1),!1;var e={};if(e.companyId=SYSTEM_USER_STATUS.companyId,e.dependencyId=getElementValue("selCustPorLisDependency"),e.dependencyId<=0&&Number(SYSTEM_USER_STATUS.billingprofile)<BILLING_PROFILE_PARTNER_INDEX)return showNotification("Seleccionar uma filial.",0),!1;e.filterByDate=getElementChecked("chbCustPorLisShowDate"),e.initialDate=document.getElementById("txtCustPorLisInitialDate").value,e.endDate=document.getElementById("txtCustPorLisEndDate").value,e.customerType=document.getElementById("selCustPorLisCustomerType").value,e.municipalityId=document.getElementById("selCustPorLisMunicipality").value,e.neiborhood=document.getElementById("selCustPorLisNeiborhood").value,e.customerId=t,e.onlynumber=1,e.startIdx=0,e.endIdx=0,showNotification(),ST_SA_LISTING_SERVER=1;var o=new XMLHttpRequest,n="action=getCustomerPortalListDetails&filterInfo="+JSON.stringify(e),s=URL_SA_CUSTOMER_PORTAL_X;o.open("POST",s,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){ST_SA_LISTING_SERVER=0;try{var t=JSON.parse(this.responseText)}catch(t){showHttpResponseText(o)}var n=Number(t.n);t.length<=0?showNotification("Não encontrado.",0):hideDivFilter();var s=document.getElementById("numResultPageNumber"),r=document.getElementById("numResultItems");function i(){var t=Number(s.value),o=Number(r.value),i=(t-1)*o,a=i+o;a>n&&(a=n),e.totalItems=n,e.startIdx=i,e.endIdx=a,e.onlynumber=0,customerPortalListFilter(e)}s.value=1,setResultTotalPages(s.id,r.id,n),s.onchange=function(){i()},r.onchange=function(){setResultTotalPages(s.id,r.id,n),i()},setElementInnerHtml("lbResultOnList",n),i()}},o.send(n)}catch(t){showNotification(t.message,0)}}function customerPortalListFilter(t){try{showNotification();var e=document.getElementById("tblCustPorLisDetailsTable");e.innerHTML="";var o=new XMLHttpRequest,n="action=getCustomerPortalListDetails&filterInfo="+JSON.stringify(t),s=URL_SA_CUSTOMER_PORTAL_X;o.open("POST",s,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){ST_SA_LISTING_SERVER=0;try{var n=JSON.parse(this.responseText)}catch(t){showHttpResponseText(o)}var s={},r={};setElementInnerHtml("lbResultOnList",t.endIdx+" / "+t.totalItems);for(var i=t.startIdx,a=0;a<n.length;a++){var l=n[a];let t=JSON.parse(l);var u=customerPortalStatu(t.portalstatus),c=getOperatorName(t.operatorName,t.portalstatususer),d=t.billingMunicipality,m=t.billingneiborhood;1,addAmountResume(r,m,1),addAmountResume(s,u,1),i+=1;let o=e.insertRow(-1);o.id="trCustPorList"+t.customerid,o.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_CUSTOMER_PORTAL_LIST",o.id));let C=o.insertCell(-1);C.setAttribute("class","colRowNumber"),C.innerHTML=i;let S=o.insertCell(-1);S.setAttribute("class","colProductId"),S.innerHTML=t.customerid,o.insertCell(-1).innerHTML=CUSTOMER_TYPE[t.customertype],o.insertCell(-1).innerHTML=t.companyname,o.insertCell(-1).innerHTML=t.customertaxid;let T=o.insertCell(-1);T.style.textAlign="center",T.innerHTML=t.contracts,o.insertCell(-1).innerHTML=d,o.insertCell(-1).innerHTML=m,o.insertCell(-1).innerHTML=u;let E=o.insertCell(-1);E.setAttribute("class","colProductId"),E.innerHTML=setLocalDate(t.portalstatusdate,16);let I=o.insertCell(-1);1==t.portalstatus&&(I.setAttribute("class","colProductId"),I.innerHTML=c);let P=o.insertCell(-1);P.setAttribute("class","noPrint");let p=document.createElement("button");p.type="button",p.setAttribute("class","labelDetail");t.customerid;p.onclick=function(){customerPortalShowActivationCode(t),setSelectedRowOnClick(o,"SELECTED_ROW_CUSTOMER_PORTAL_LIST")},P.appendChild(p)}var C=document.getElementById("tblCustPorLisResumeTable");for(var l in C.innerHTML="",i=0,r)i+=1,resume(C,i,"Bairro",r,l);for(var l in i=0,s)i+=1,resume(C,i,"Estado",s,l);hideNotification()}},o.send(n)}catch(t){showNotification(t.message,0)}}