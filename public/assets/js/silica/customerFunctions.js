class _customer{constructor(e=0,t=0,i="",n=1,l="",o=1,r="",s="",a=0,c=0,u="",d="",m="",C="",p="",S="",g="",y=1,h=-1,T=-1,E="",I="",v="",f="",L="",R="",b="",N="",M=-1,_=-1,w=-1,A="",x="",U="",O="",B="",H="",P="",D="",G="",k="",q="",W="",V="",X="",J="",Y=-1,F=-1,z=-1,Q=-1,j=-1,K=10,Z=-1,$=1){this.companyid=e,this.dependencyid=t,this.linkrequestid=c,this.contractnumber=u,this.serie=i,this.sequencenumber=n,this.customerid=l,this.customertype=o,this.companyname=r,this.customertaxid=s,this.selfbillingindicator=a,this.customeradditionalreference=C,this.customeradditionalnumber=p,this.customerclassification1=S,this.customerclassification2=g,this.owenname=d,this.owenidentification=m,this.billingcountry=y,this.billingprovince=h,this.billingmunicipality=T,this.billingcity=E,this.billingdistrict=I,this.billingcomuna=v,this.billingneiborhood=f,this.billingstreetname=L,this.billingbuildingnumber=b,this.billingblock=R,this.billingpostalcode=N,this.shipcountry=M,this.shipprovince=_,this.shipmunicipality=w,this.shipcity=A,this.shipdistrict=x,this.shipcomuna=U,this.shipneiborhood=O,this.shipstreetname=B,this.shipblock=H,this.shipbuildingnumber=P,this.shippostalcode=D,this.telephone1=G,this.telephone2=k,this.telephone3=q,this.email=W,this.website=V,this.contactperson=X,this.contactpersoncharge=J,this.userId=Y,this.coordinatorUser=F,this.managerUser=z,this.directorGeneralUser=Q,this.administratorUser=j,this.request=K,this.registerid=Z,this.status=$}}var CUSTOMER_NEW=new _customer,CUSTOMER_REGISTER_LINES=[];function customerOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){customerGetInfo(-1,e,"{}",10),hideNotification()})}var CUSTOMER_CREDIT_ACCOUNT=0;function customerGetInfo(e,t="",i=null,n=10){setCustomerType(""),(CUSTOMER_NEW=new _customer).companyid=SYSTEM_USER_STATUS.companyId,CUSTOMER_NEW.dependencyid=SYSTEM_USER_STATUS.workplaceId,CUSTOMER_NEW.userId=SYSTEM_USER_STATUS.userId,CUSTOMER_NEW.managerUser=SYSTEM_USER_STATUS.managerUser,CUSTOMER_NEW.request=n,hideParts("btCliCadDelete");const l=document.getElementById("txtCliCadSerie"),o=document.getElementById("txtCliCadCustomerID"),r=document.getElementById("selCliCadCustomerType"),s=document.getElementById("txtCliCadCustomerName"),a=document.getElementById("txtCliCadCustomerNIF"),c=document.getElementById("selCliCadBillProvince"),u=document.getElementById("selCliCadBillMunic"),d=document.getElementById("txtCliCadBillComuna"),m=document.getElementById("selCliCadBillNeiborhood"),C=document.getElementById("txtCliCadBillStreet"),p=document.getElementById("selCliCadBillBlock"),S=document.getElementById("txtCliCadBillBuidNumber"),g=document.getElementById("txtCliCadBillPostal"),y=document.getElementById("txtCliCadTelef1"),h=document.getElementById("txtCliCadTelef2"),T=document.getElementById("txtCliCadTelef3"),E=document.getElementById("txtCliCadEmail"),I=document.getElementById("lbCliCadLinkRequestId"),v=document.getElementById("lbCliCadUpdateBy");if(customerSetAutoComplete("txtCliCadCustomerName"),setAutoCompleteToFiel("txtCliCadCustomerNIF",46,1),setAutoCompleteToFiel("txtCliCadBillComuna",47,1),fillSelectNeiborhood("selCliCadBillNeiborhood",2,-1),setAutoCompleteToFiel("txtCliCadBillStreet",49,1),setAutoCompleteToFiel("txtCliCadBillBuidNumber",51,1),setAutoCompleteToFiel("txtCliCadBillPostal",52,1),maskInputByPlaceHold("txtCliCadBillPostal"),maskInputByPlaceHold("txtCliCadTelef1"),maskInputByPlaceHold("txtCliCadTelef2"),maskInputByPlaceHold("txtCliCadTelef3"),Number(e)<=0)l.value="",o.value="NOVO*",CUSTOMER_CREDIT_ACCOUNT=0,"FROMLKREQ"==t?(setElementInnerHtml("lbCliCadHeader","NOVO CLIENTE A PARTIR DE SOLICITAÇÃO DE LIGAÇÃO"),s.value=i.requestername,a.value=i.requesterdocnumber,r.value=1,c.value=SYSTEM_USER_STATUS.provinceId,u.value=i.billingmunicipality,d.value=i.billingcomuna,fillSelectNeiborhood("selCliCadBillNeiborhood",2,-1,i.billingneiborhood),C.value=i.billingstreetname,p.value=i.billingblock,S.value=i.billingbuildingnumber,g.value=i.billingpostalcode,y.value=i.telephone1,h.value=i.telephone2,T.value=i.telephone3,E.value=i.email,I.innerHTML=i.id):(setElementInnerHtml("lbCliCadHeader","NOVO CLIENTE"),s.value="",a.value="",r.value="1",c.value=SYSTEM_USER_STATUS.provinceId,u.value=SYSTEM_USER_STATUS.municipalityId,d.value="",m.value="",C.value="",p.value="",S.value="",g.value="",y.value="",h.value="",T.value="",E.value="",I.innerHTML=0),v.innerHTML="Actualizado em "+setLocalDate(new Date,16),dispatchOnInputChange();else{setElementInnerHtml("lbCliCadHeader","INFORMAÇÃO DO CLIENTE");var f=new XMLHttpRequest,L="action=getCustomerInfo&&customerId="+e,R=URL_SA_CUSTOMER_X;f.open("POST",R,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e;e=JSON.parse(this.responseText),l.value=e.serie,o.value=e.customerid,r.value=e.customertype,s.value=e.companyname,a.value=e.customertaxid,u.value=e.billingmunicipality,d.value=e.billingcomuna,fillSelectNeiborhood("selCliCadBillNeiborhood",2,-1,e.billingneiborhood),C.value=e.billingstreetname,p.value=e.billingblock,S.value=e.billingbuildingnumber,g.value=e.billingpostalcode,y.value=e.telephone1,h.value=e.telephone2,T.value=e.telephone3,E.value=e.email,I.innerHTML=e.linkrequestid,v.innerHTML="Cadastrado por "+getOperatorName(e.operatorEntry,e.entryUser)+" em "+setLocalDate(e.entrydate,16)+". <br>Actualizado por "+getOperatorName(e.operatorName,e.statususer)+" em "+setLocalDate(e.statusdate,16),checkPermission("0103")?showParts("btCliCadDelete",!0):hideParts("btCliCadDelete"),dispatchOnInputChange()}},f.send(L)}s.focus()}function customerExpdAddress(e){document.getElementById("selCliCadShipCountry").value=document.getElementById("selCliCadBillCountry").value,document.getElementById("selCliCadShipProvince").value=document.getElementById("selCliCadBillProvince").value,document.getElementById("selCliCadShipMunicipality").value=document.getElementById("selCliCadBillMunic").value,document.getElementById("txtCliCadShipCity").value=document.getElementById("txtCliCadBillCity").value,document.getElementById("txtCliCadShipDistrict").value=document.getElementById("txtCliCadBillDistrict").value,document.getElementById("txtCliCadShipComuna").value=document.getElementById("txtCliCadBillComuna").value,document.getElementById("txtCliCadShipNeiborhood").value=document.getElementById("selCliCadBillNeiborhood").value,document.getElementById("txtCliCadShipStreet").value=document.getElementById("txtCliCadBillStreet").value,document.getElementById("txtCliCadShipBuildNumber").value=document.getElementById("txtCliCadBillBuidNumber").value,document.getElementById("txtCliCadShipPostal").value=document.getElementById("txtCliCadBillPostal").value}function customerSaveInfo(e){var t=!1,i="";if(CUSTOMER_NEW.serie=reviewString(document.getElementById("txtCliCadSerie")).toUpperCase(),CUSTOMER_NEW.customerid=document.getElementById("txtCliCadCustomerID").value,CUSTOMER_NEW.linkrequestid=getElementInnerHtml("lbCliCadLinkRequestId"),CUSTOMER_NEW.customertype=document.getElementById("selCliCadCustomerType").value,CUSTOMER_NEW.companyname=reviewString(document.getElementById("txtCliCadCustomerName")).toUpperCase(),""==CUSTOMER_NEW.companyname&&(t=!0,i+="Deve indicar o nome do cliente. <br>"),CUSTOMER_NEW.customertaxid=reviewString(document.getElementById("txtCliCadCustomerNIF")).toUpperCase(),validateTaxId(CUSTOMER_NEW.customertaxid)||(t=!0,i+="BI / NIF fora do formato. <br>"),CUSTOMER_NEW.billingprovince=document.getElementById("selCliCadBillProvince").value,CUSTOMER_NEW.billingmunicipality=document.getElementById("selCliCadBillMunic").value,Number(CUSTOMER_NEW.billingmunicipality)<=0&&(t=!0,i+="Deve indicar o município de facturação do cliente. <br>"),CUSTOMER_NEW.billingcomuna=reviewString(document.getElementById("txtCliCadBillComuna")).toUpperCase(),CUSTOMER_NEW.billingneiborhood=getElementValue("selCliCadBillNeiborhood"),""==CUSTOMER_NEW.billingneiborhood&&(t=!0,i+="Deve indicar o bairro. <br>"),CUSTOMER_NEW.billingstreetname=reviewString(document.getElementById("txtCliCadBillStreet")).toUpperCase(),CUSTOMER_NEW.billingblock=reviewString(document.getElementById("selCliCadBillBlock")).toUpperCase(),CUSTOMER_NEW.billingbuildingnumber=reviewString(document.getElementById("txtCliCadBillBuidNumber")).toUpperCase(),CUSTOMER_NEW.billingpostalcode=reviewString(document.getElementById("txtCliCadBillPostal")).replace(/[^0-9\-]/g,""),CUSTOMER_NEW.telephone1=reviewString(document.getElementById("txtCliCadTelef1")).replace(/[^0-9]/g,""),CUSTOMER_NEW.telephone2=reviewString(document.getElementById("txtCliCadTelef2")).replace(/[^0-9]/g,""),CUSTOMER_NEW.telephone3=reviewString(document.getElementById("txtCliCadTelef3")).replace(/[^0-9]/g,""),CUSTOMER_NEW.email=reviewEmail(document.getElementById("txtCliCadEmail").value),""==CUSTOMER_NEW.telephone1&&""==CUSTOMER_NEW.telephone2&&""==CUSTOMER_NEW.telephone3&&(t=!0,i+="Deve indicar pelo meno um número de telefone. <br>"),""!=CUSTOMER_NEW.email&&(validateEmail(CUSTOMER_NEW.email)||(t=!0,i+="E-mail de facturação fora do formato. <br>")),1==ST_SA_WAITING_SERVER&&(t=!0,i+="Aguardando resposta do servidor. <br>"),1==t)return alert(i),!1;showNotification(),ST_SA_WAITING_SERVER=1;var n=new XMLHttpRequest,l="action=saveCustomerInfo&customerInfo="+JSON.stringify(CUSTOMER_NEW)+"&dictonaryCustomer=cliente",o=URL_SA_CUSTOMER_X;n.open("POST",o,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;var t=JSON.parse(n.responseText);1==t.status?(showNotification(t.msg,1),"CLILIST"==e&&customerCustomerListDetails(),hideParts("divCustomerRegister")):showNotification(t.msg,0)}},n.send(l)}function customerDelete(e){var t=document.getElementById("txtCliCadCustomerID").value,i=document.getElementById("txtCliCadCustomerName").value;if(9999==t)return alert("Não pode eliminar o consumidor final."),!1;showConfirm("Atenção! <br>Não é recomendado eliminar cliente da base de dados. <br><br>Tem a certeza que deseja eliminar "+i+"?",function(){showNotification();var i=new XMLHttpRequest,n="action=deleteCustomerInfo&customerId="+t+"&dictonaryCustomer=cliente",l=URL_SA_CUSTOMER_X;i.open("POST",l,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(i.responseText);1==t.status?(showNotification(t.msg,1),"CLILIST"==e&&customerCustomerListDetails(),hideParts("divCustomerRegister")):showNotification(t.msg,0)}},i.send(n)})}function customerCustomerListOnLoad(e){try{showNotification(),checkUserStatusAfterExecute(function(){setSystemUserBillingProfile(""),fillSelectDependencyFull("selCliLisDependency",-1,1),fillSelectCustomerType("selCLILISCustomerType",-1),fillSelectMunicipality("selCLILISMunicipality",SYSTEM_USER_STATUS.provinceId,-1,-1),fillSelectNeiborhood("selCLILISNeiborhood",2,-1),setTriggerButtonByText("txtCLILISInitialDate","btCliLisViewAll"),setTriggerButtonByText("txtCLILISEndDate","btCliLisViewAll"),document.getElementById("chbCLILISLisShowDate").onclick=function(){setEnableDisableByCheckBox(this.id,"txtCLILISInitialDate","txtCLILISEndDate")},checkPermission("0101")?showParts("btCliLisNewCustomerFromLinkRequest",!0):(hideParts("btCliLisNewCustomer"),hideParts("btCliLisNewCustomerFromLinkRequest"));var e=sessionStorage.getItem("linkrequest_to_customer");if(null!=e&&""!=e){var t=document.getElementById("btCliListPending");showParts(t.id,!0),t.onclick=function(){customerCustomerListShowDetais(-1,"FROMLKREQ",JSON.parse(e)),hideParts(t.id)},sessionStorage.setItem("linkrequest_to_customer","")}customerCustomerListDetails(),hideNotification()})}catch(e){showNotification(e.message,0)}}function customerCustomerListDetails(e=-1){try{if(1==ST_SA_LISTING_SERVER)return showNotification("Procurando...",1),!1;var t={};if(t.companyId=SYSTEM_USER_STATUS.companyId,t.dependencyId=getElementValue("selCliLisDependency"),t.dependencyId<=0&&Number(SYSTEM_USER_STATUS.billingprofile)<BILLING_PROFILE_PARTNER_INDEX)return showNotification("Seleccionar uma filial.",0),!1;t.filterByDate=getElementChecked("chbCLILISLisShowDate"),t.listType=document.getElementById("selCliLisListType").value,t.initialDate=document.getElementById("txtCLILISInitialDate").value,t.endDate=document.getElementById("txtCLILISEndDate").value,t.customerType=document.getElementById("selCLILISCustomerType").value,t.municipalityId=document.getElementById("selCLILISMunicipality").value,t.neiborhood=document.getElementById("selCLILISNeiborhood").value,t.customerId=e,t.onlynumber=1,t.startIdx=0,t.endIdx=0,showNotification(),ST_SA_LISTING_SERVER=1;var i=new XMLHttpRequest,n="action=getCustomerListDetails&filterInfo="+JSON.stringify(t),l=URL_SA_CUSTOMER_X;i.open("POST",l,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){ST_SA_LISTING_SERVER=0;try{var e=JSON.parse(this.responseText)}catch(e){showHttpResponseText(i)}var n=Number(e.n);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter();var l=document.getElementById("numResultPageNumber"),o=document.getElementById("numResultItems");function r(){var e=Number(l.value),i=Number(o.value),r=(e-1)*i,s=r+i;s>n&&(s=n),t.totalItems=n,t.startIdx=r,t.endIdx=s,t.onlynumber=0,customerCustomerListFilter(t)}l.value=1,setResultTotalPages(l.id,o.id,n),l.onchange=function(){r()},o.onchange=function(){setResultTotalPages(l.id,o.id,n),r()},setElementInnerHtml("lbResultOnList",n),r()}},i.send(n)}catch(e){showNotification(e.message,0)}}function customerCustomerListFilter(e){try{showNotification();var t=document.getElementById("tblCLILISDetailsTable");t.innerHTML="";var i=new XMLHttpRequest,n="action=getCustomerListDetails&filterInfo="+JSON.stringify(e),l=URL_SA_CUSTOMER_X;i.open("POST",l,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){ST_SA_LISTING_SERVER=0;try{var n=JSON.parse(this.responseText)}catch(e){showHttpResponseText(i)}var l={},o={};setElementInnerHtml("lbResultOnList",e.endIdx+" / "+e.totalItems);for(var r=e.startIdx,s=0;s<n.length;s++){var a=n[s];let i=JSON.parse(a);var c=CUSTOMER_TYPE[i.customertype],u=getOperatorName(i.operatorName,i.statususer),d=i.billingMunicipality,m=i.billingneiborhood;1,addAmountResume(o,m,1),addAmountResume(l,c,1),r+=1;let C=t.insertRow(-1);C.id="trCliLisList"+i.customerid,C.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_CUSTOMER_LIST",C.id));let p=C.insertCell(-1);p.setAttribute("class","colRowNumber"),p.innerHTML=r;let S=C.insertCell(-1);S.setAttribute("class","colProductId"),S.innerHTML=i.customerid,C.insertCell(-1).innerHTML=c,C.insertCell(-1).innerHTML=i.companyname,C.insertCell(-1).innerHTML=i.customertaxid;let g=C.insertCell(-1);if(g.style.textAlign="center",g.innerHTML=i.contracts,C.insertCell(-1).innerHTML=d,C.insertCell(-1).innerHTML=m,1==e.listType){let e=C.insertCell(-1);e.setAttribute("class","colProductId"),e.innerHTML=setLocalDate(i.statusdate,16),C.insertCell(-1).innerHTML=u}else if(2==e.listType){C.insertCell(-1).innerHTML=i.telephone1+" / "+i.telephone2+" / "+i.telephone3,C.insertCell(-1).innerHTML=i.email}else{let e=C.insertCell(-1);e.style.textAlign="right",e.style.paddingRight="5px",e.style.whiteSpace="nowrap",e.innerHTML=formatNumber(i.totalamount)}let y=C.insertCell(-1);if(y.setAttribute("class","noPrint"),checkPermission("0101")){let e=document.createElement("button");e.type="button",e.setAttribute("class","labelDetail");const t=i.customerid;e.onclick=function(){customerCustomerListShowDetais(t),setSelectedRowOnClick(C,"SELECTED_ROW_CUSTOMER_LIST")},y.appendChild(e)}if(checkPermission("3101")){let e=document.createElement("button");e.innerHTML="Novo contrato",e.type="button",e.onclick=function(){setSelectedRowOnClick(C,"SELECTED_ROW_CUSTOMER_LIST"),i.consumertype=1,sessionStorage.setItem("customer_to_contract",JSON.stringify(i)),window.location.assign("ContractList.php")},y.appendChild(e)}}if(1==e.listType){var C=[["Município","Total"]],p=[["Tipo de conta","Total"]],S=document.getElementById("tblCLILISResumeTable");for(var a in S.innerHTML="",r=0,o)r+=1,C.push([o[a].desigination,Math.abs(o[a].amount)]),resume(S,r,"Bairro",o,a);for(var a in r=0,l)r+=1,p.push([l[a].desigination,Math.abs(l[a].amount)]),resume(S,r,"Tipo",l,a);saleReportCreateGraphic(C,"divCliLisNeiborhoodChart","Gráfico dos bairros"),saleReportCreateGraphic(p,"divCliLisCustomerTypeChart","Gráfico do tipo de conta")}hideNotification()}},i.send(n)}catch(e){showNotification(e.message,0)}}function customerCustomerListTypeChange(e){var t=e.value;const i=document.getElementById("lbCliLisDataFactura");i.innerHTML="Data de cadastro";const n=document.getElementById("trCliLisMainTableHeader"),l=document.getElementById("divCliLisCharts"),o=document.getElementById("divCliClisResume");if(l.style.display="none",o.style.display="none",n.innerHTML="",n.insertCell(-1).innerHTML="#",n.insertCell(-1).innerHTML="Conta",n.insertCell(-1).innerHTML="Tipo",n.insertCell(-1).innerHTML="Cliente",n.insertCell(-1).innerHTML="BI / NIF",n.insertCell(-1).innerHTML="Contratos",n.insertCell(-1).innerHTML="Município",n.insertCell(-1).innerHTML="Bairro",2==t){n.insertCell(-1).innerHTML="Contactos",n.insertCell(-1).innerHTML="E-mail"}else if(3==t){i.innerHTML="Data de facturação",n.insertCell(-1).innerHTML="Valor (AOA)"}else{l.style.display="block",o.style.display="block",n.insertCell(-1).innerHTML="Última actualização",n.insertCell(-1).innerHTML="Operador"}n.insertCell(-1).innerHTML="...",document.getElementById("tblCLILISDetailsTable").innerHTML="",document.getElementById("divCliLisRequestChart").innerHTML="",document.getElementById("divCliLisMunicipalityChart").innerHTML="",document.getElementById("divCliLisCustomerTypeChart").innerHTML="",document.getElementById("tblCLILISResumeTable").innerHTML=""}function customerCustomerListShowDetais(e=-1,t="CLILIST",i=null){showParts("divCustomerRegister"),customerGetInfo(e,t,i,10)}function customerHistoricGetInfo(e,t){setCustomerType(""),setDocumentType("");const i=document.getElementById("txtCliHisCustomerId"),n=document.getElementById("txtCliHistCustomerName"),l=document.getElementById("txtCliHisCustomerNIF"),o=document.getElementById("txtCliHisCustomerType");var r=new XMLHttpRequest,s="action=getCustomerInfo&&customerId="+t,a=URL_SA_CUSTOMER_X;r.open("POST",a,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);i.value=t.customerid,n.value=t.companyname,l.value=t.customertaxid,o.value=CUSTOMER_TYPE[t.customertype],customerHistoricGetHistoric(e,t.customerid)}},r.send(s)}function customerHistoricGetHistoric(e,t){var i=new XMLHttpRequest,n="action=getCustomerHistoric&companyId="+e+"&customerId="+t,l=URL_SA_CUSTOMER_X;i.open("POST",l,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);e.length<=0&&showNotification("Não encontrado.",0),document.getElementById("lbResultOnList").innerHTML=e.length;let o=document.getElementById("tblCliHisMainTable");o.innerHTML="";var t="",i=0,n=0,l=0;e.forEach(e=>(function(e){i+=1;let r=JSON.parse(e);if(t!=r.invoicetype){if(1!=i){let e=o.insertRow(-1);e.style.fontSize="large",e.setAttribute("class","borderGray");let t=e.insertCell(-1);t.innerHTML="TOTAL",t.style.textAlign="center",t.setAttribute("colspan","4");let r=e.insertCell(-1);r.style.textAlign="right",r.style.paddingRight="5px",r.style.whiteSpace="nowrap",r.innerHTML=formatNumber(n);let s=e.insertCell(-1);s.style.textAlign="right",s.style.paddingRight="5px",s.style.whiteSpace="nowrap",s.innerHTML=formatNumber(l),s.setAttribute("colspan","2"),i+=1}n=0,l=0,t=r.invoicetype;let e=o.insertRow(-1);e.style.fontSize="large",e.setAttribute("class","borderGray");let s=e.insertCell(-1);s.innerHTML=DOCUMENT_TYPE[r.invoicetype],s.setAttribute("colspan","7"),i+=1}let s=o.insertRow(-1);s.setAttribute("class","borderGray");let a=s.insertCell(-1);a.setAttribute("class","colRowNumber"),a.innerHTML=i,s.insertCell(-1).innerHTML=r.invoicenumber;let c=s.insertCell(-1);c.style.textAlign="center",c.innerHTML=setLocalDate(r.invoicedate,10),s.insertCell(-1).innerHTML=getDocumentStatus(r.invoicestatus)+" / "+getFirtLastName(r.operatorName);let u=s.insertCell(-1);if(u.setAttribute("class","colAmount"),u.innerHTML=formatNumber(r.totalInvoice).bold(),n+=Number(r.totalInvoice),"PP"!=t&&"OR"!=t&&"NE"!=t){var d=Number(r.totalInvoice)-Number(r.paymentamount),m="Pagamento total";d>0?(l+=d,m=d==r.totalInvoice?"Aguarda pagamento":"Pagamento parcial"):d=0;let e=s.insertCell(-1);e.innerHTML=m;let t=s.insertCell(-1);t.setAttribute("class","colAmount"),t.innerHTML=formatNumber(d)}})(e)),i+=1;let r=o.insertRow(-1);r.style.fontSize="large",r.setAttribute("class","borderGray");let s=r.insertCell(-1);s.innerHTML="TOTAL",s.style.textAlign="center",s.setAttribute("colspan","4");let a=r.insertCell(-1);a.setAttribute("class","colAmount"),a.innerHTML=formatNumber(n);let c=r.insertCell(-1);c.setAttribute("class","colAmount"),c.innerHTML=formatNumber(l),c.setAttribute("colspan","2")}},i.send(n)}function customerShowHideExpeditionAddress(e){var t=document.getElementById("divCliCadShipAddress");"none"===window.getComputedStyle(t).display?(t.style.display="block",e.innerHTML="Ocultar endereço de entrega"):(t.style.display="none",e.innerHTML="Ver endereço de entrega")}function customerBadPayerOnLoad(e){try{showNotification(),checkUserStatusAfterExecute(function(){setCustomerType(""),selectCountryChange("selCLILISCountry","selCLILISProvince","selCLILISMunicipality",""),fillSelectCustomerAdditional("selCLILISAdditionalReference",-1),fillSelectCountry("selCLILISCountry",-1),fillSelectMunicipality("selCLILISMunicipality",-1,-1,-1);const e=document.getElementById("selCLILISProvince");e.onchange=function(){fillSelectMunicipality("selCLILISMunicipality",e.value,-1,-1)},fillSelectProvince("selCLILISProvince",-1),customerBadPayerListDetails(""),hideNotification()})}catch(e){showNotification(e.message,0)}}function customerBadPayerListDetails(e){try{if(1==ST_SA_LISTING_SERVER)return showNotification("Procurando...",1),!1;var t={};t.companyId=SYSTEM_USER_STATUS.companyId,t.additionalReference=document.getElementById("selCLILISAdditionalReference").value,t.countryId=document.getElementById("selCLILISCountry").value,t.provinceId=document.getElementById("selCLILISProvince").value,t.municipalityId=document.getElementById("selCLILISMunicipality").value,t.onlynumber=1,t.startIdx=0,t.endIdx=0,showNotification(),ST_SA_LISTING_SERVER=1;var i=new XMLHttpRequest,n="action=getCustomerBadPayerListDetails&filterInfo="+JSON.stringify(t),l=URL_SA_CUSTOMER_X;i.open("POST",l,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){ST_SA_LISTING_SERVER=0;try{var e=JSON.parse(this.responseText)}catch(e){showHttpResponseText(i)}var n=Number(e.n);n<=0?showNotification("Não encontrado.",0):hideDivFilter();var l=document.getElementById("numResultPageNumber"),o=document.getElementById("numResultItems");function r(){var e=Number(l.value),i=Number(o.value),r=(e-1)*i,s=r+i;s>n&&(s=n),t.totalItems=n,t.startIdx=r,t.endIdx=s,t.onlynumber=0,customerBadPayerListFilter(t)}l.value=1,setResultTotalPages(l.id,o.id,n),l.onchange=function(){r()},o.onchange=function(){setResultTotalPages(l.id,o.id,n),r()},setElementInnerHtml("lbResultOnList",n),r()}},i.send(n)}catch(e){showNotification(e.message,0)}}function customerBadPayerListFilter(e){try{showNotification();var t=document.getElementById("tblCLILISDetailsTable");t.innerHTML="";var i=new XMLHttpRequest,n="action=getCustomerBadPayerListDetails&filterInfo="+JSON.stringify(e),l=URL_SA_CUSTOMER_X;i.open("POST",l,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){ST_SA_LISTING_SERVER=0;var n=JSON.parse(this.responseText);setElementInnerHtml("lbResultOnList",e.endIdx+" / "+e.totalItems);for(var l=e.startIdx,o=0,r=0;r<n.length;r++){var s=n[r];let e=JSON.parse(s);o+=Number(e.totalamount),l+=1;let i=t.insertRow(-1);i.setAttribute("class","borderGray");let a=i.insertCell(-1);a.setAttribute("class","colRowNumber"),a.innerHTML=l;let c=i.insertCell(-1);c.setAttribute("class","colProductId"),c.innerHTML=e.customerid,i.insertCell(-1).innerHTML=e.companyname,i.insertCell(-1).innerHTML=e.customertaxid,i.insertCell(-1).innerHTML=e.customeradditionalreference;let u=i.insertCell(-1);u.style.textAlign="right",u.style.paddingRight="5px",u.style.whiteSpace="nowrap",u.innerHTML=formatNumber(e.totalamount)}let i=t.insertRow(-1);i.setAttribute("class","borderGray"),i.style.fontSize="large";let a=i.insertCell(-1);a.setAttribute("colspan","5"),a.style.textAlign="center",a.innerHTML="TOTAL".bold();let c=i.insertCell(1);c.style.textAlign="right",c.style.paddingRight="5px",c.innerHTML=formatNumber(o).bold(),hideNotification()}},i.send(n)}catch(e){showNotification(e.message,0)}}function customerAssignToServiceOnLoad(e){try{showNotification(),checkUserStatusAfterExecute(function(){fillSelectProductSection("selCliVinServServiceToAssign",-1,1),hideNotification()})}catch(e){showNotification(e.message,0)}}function customerAssignToServiceList(e){try{var t=SYSTEM_USER_STATUS.companyId,i=document.getElementById("selCliVinServServiceToAssign").value;showNotification();var n=new XMLHttpRequest,l="action=getCustomerAssignToServiceList&companyId="+t+"&sectionId="+i,o=URL_SA_CUSTOMER_X;n.open("POST",o,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(this.responseText);e.length<=0&&showNotification("Não encontrado.",0),document.getElementById("lbResultOnList").innerHTML=e.length;let i=document.getElementById("tblCliVinServMainTable");i.innerHTML="";var t=0;e.forEach(e=>(function(e){let n=JSON.parse(e);t+=1;let l=i.insertRow(-1);l.setAttribute("class","borderGray");let o=l.insertCell(-1);o.setAttribute("class","colRowNumber"),o.innerHTML=t;let r=l.insertCell(-1);r.setAttribute("class","colProductId"),r.innerHTML=n.customerid,l.insertCell(-1).innerHTML=n.companyname,l.insertCell(-1).innerHTML=n.customertaxid;let s=l.insertCell(-1);s.style.textAlign="center";var a=0,c="Vinculado",u="DESVINCULAR",d="black",m="labelBrokenLink";1!=n.assignstatus&&(a=1,u="Re-vincular",c="Desvinculado",d="red",m="labelLink");s.innerHTML=c,s.style.color=d;let C=l.insertCell(-1);C.style.textAlign="center",C.innerHTML=n.statusdate,l.insertCell(-1).innerHTML=getFirtLastName(n.operatorName)+" ("+n.statussourceid+")";let p=l.insertCell(-1);if(0==n.nopayment){p.style.textAlign="right",p.style.paddingRight="5px",p.style.whiteSpace="nowrap";var S=new Date(n.lastyear+"-"+n.lastmonth+"-"+n.lastday).toISOString().slice(0,10);3==n.chargetype&&(S=monthName(Number(n.lastmonth)-1).toString().toUpperCase()+" / "+n.lastyear),p.innerHTML=S}let g=l.insertCell(-1);g.setAttribute("class","noPrint");let y=document.createElement("button");y.setAttribute("class",m),y.type="button",y.innerHTML=u,y.name=n.customerid,y.onclick=function(){customerUnAssignService(y.name,a)},g.appendChild(y)})(e)),hideNotification()}},n.send(l)}catch(e){showNotification(e.message,0)}}function customerAssignService(e){var t=!1,i="",n=SYSTEM_USER_STATUS.companyId,l=document.getElementById("selCliVinServServiceToAssign").value,o=SYSTEM_USER_STATUS.userId;if(Number(l)<=0&&(t=!0,i+="Deve seleccionar um serviço válido."),""==e&&(t=!0,i+="Devele indicar um cliente válido."),t)return alert(i),!1;showNotification();var r=new XMLHttpRequest,s="action=assignCustomerToService&companyId="+n+"&sectionId="+l+"&customerId="+e+"&userId="+o,a=URL_SA_CUSTOMER_X;r.open("POST",a,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=JSON.parse(r.responseText);1==e.status?(showNotification(e.msg,1),customerAssignToServiceList("")):showNotification(e.msg,0)}},r.send(s)}function customerUnAssignService(e,t){var i=!1,n="",l=SYSTEM_USER_STATUS.companyId,o=document.getElementById("selCliVinServServiceToAssign").value,r=SYSTEM_USER_STATUS.userId;if(Number(o)<=0&&(i=!0,n+="Deve seleccionar um serviço válido."),""==e&&(i=!0,n+="Devele indicar um cliente válido."),i)return alert(n),!1;showConfirm("Tem a certeze que deseja "+(1==t?"re-vincular":"desvincular"),function(){showNotification();var i=new XMLHttpRequest,n="action=unAssignCustomerToService&companyId="+l+"&sectionId="+o+"&customerId="+e+"&userId="+r+"&nextStatus="+t,s=URL_SA_CUSTOMER_X;i.open("POST",s,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var e=JSON.parse(i.responseText);1==e.status?(showNotification(e.msg,1),customerAssignToServiceList("")):showNotification(e.msg,0)}},i.send(n)})}function fillSelectCustomerPeriodicService(e,t,i){const n=document.getElementById(e),l=document.getElementById(i);if(!validateUserControl(n))return!1;validateUserControl(l)&&(l.style.display="none"),setProductChargeType(""),CUSTOMER_PERIODIC_SERVICE_LIST=[],n.innerHTML="";var o=document.createElement("option");if(o.value="-1",o.setAttribute("class","selectPlaceHolder"),o.innerHTML="Seleccionar",n.appendChild(o),9999==t)return!1;var r=SYSTEM_USER_STATUS.companyId,s=new XMLHttpRequest,a="action=getCustomerPeriodicService&companyId="+r+"&customerId="+t,c=URL_SA_CUSTOMER_X;s.open("POST",c,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);e.length>0&&validateUserControl(l)&&(l.style.display="inline"),e.forEach(e=>(function(e){let t=JSON.parse(e);var i=document.createElement("option");i.value=t.id;var l=t.section+" ("+PRODUCT_CHARGE_TYPES[t.chargetype]+")";i.innerHTML=l,n.appendChild(i),CUSTOMER_PERIODIC_SERVICE_LIST[t.id]=t})(e))}},s.send(a)}function customerQueryByServiceOnLoad(e){try{showNotification(),checkUserStatusAfterExecute(function(){setDocumentType(""),setCustomerType(""),fillSelectProductSection("selCliConServServiceToQuery",-1,1),fillSelectDays("selCliConServPriodicServiceDay"),fillSelectMonth("selCliConServPriodicServiceMonth"),selectCountryChange("selCliConServCountry","selCliConServProvince","selCliConServMunicipality",""),fillSelectCustomerAdditional("selCliConServAdditionalReference",-1),fillSelectDefaultValues("selCliConServCustomerClissification1",1,-1),fillSelectDefaultValues("selCliConServCustomerClissification2",2,-1),fillSelectCountry("selCliConServCountry",-1);const e=document.getElementById("selCliConServProvince");e.onchange=function(){fillSelectMunicipality("selCliConServMunicipality",e.value,-1,-1)},fillSelectProvince("selCliConServProvince",-1),document.getElementById("selCliConServServiceToQuery").onchange=function(){const e=document.getElementById("selCliConServPriodicServiceDay");2==PERIODIC_SERVICE_LIST[this.value].chargetype?e.disabled="":(e.disabled="true",e.value="15"),cleanElement("tblCliConServMainTable")};var t=new Date;document.getElementById("selCliConServPriodicServiceMonth").value=t.getMonth()+1,document.getElementById("numCliConServPriodicServiceYear").value=t.getFullYear(),hideNotification()})}catch(e){showNotification(e.message,0)}}function customerQueryByServiceList(e){try{var t=!1,i="",n=SYSTEM_USER_STATUS.companyId,l=document.getElementById("selCliConServServiceToQuery").value,o=document.getElementById("selCliConServPriodicServiceDay").value,r=document.getElementById("selCliConServPriodicServiceMonth").value,s=document.getElementById("numCliConServPriodicServiceYear").value,a=document.getElementById("selCliConServAdditionalReference").value,c=document.getElementById("selCliConServCustomerClissification1").value,u=document.getElementById("selCliConServCustomerClissification2").value,d=document.getElementById("selCliConServCountry").value,m=document.getElementById("selCliConServProvince").value,C=document.getElementById("selCliConServMunicipality").value,p=s+"-"+r+"-"+o,S=new Date(p);if(p=n+l+dateToProductCode(S),Number(l)<=0&&(t=!0,i+="Deve indicar o serviço periódico a ser consultado. <br>"),validateDate(S)||(t=!0,i+="Data inválida. <br>"),t)return alert(i),!1;showNotification();var g=new XMLHttpRequest,y="action=getCustomerQueryByServiceList&companyId="+n+"&sectionId="+l+"&reference="+p+"&additionalReference="+a+"&classification1="+c+"&classification2="+u+"&countryId="+d+"&provinceId="+m+"&municipalityId="+C,h=URL_SA_CUSTOMER_X;g.open("POST",h,!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.onreadystatechange=function(){if(4==g.readyState&&200==g.status){var e={},t={},i={},n={},l=JSON.parse(this.responseText);l.length<=0?showNotification("Não encontrado.",0):hideDivFilter(),document.getElementById("lbResultOnList").innerHTML=l.length;let C=document.getElementById("tblCliConServMainTable");C.innerHTML="";var o=0;function r(e,t,i){t in e?e[t].amount=Number(e[t].amount)+Number(i):e[t]={desigination:t,amount:i}}l.forEach(l=>(function(l){let s=JSON.parse(l);var a="PAGO";if(null===s.productDescription){var c=new Date(s.assigndate);a=S.getTime()<c.getTime()?"Vinculado depois da referência":"Não pago"}var u=s.customeradditionalreference,d=s.customerclassification1,m=s.customerclassification2,p=Number(s.subtotalLine);1,r(e,a,1),r(t,u+" / "+a,1),r(i,d+" / "+a,1),r(n,m+" / "+a,1),o+=1;let g=C.insertRow(-1);g.setAttribute("class","borderGray");let y=g.insertCell(-1);y.setAttribute("class","colRowNumber"),y.innerHTML=o;let h=g.insertCell(-1);h.setAttribute("class","colProductId"),h.innerHTML=s.customerid,g.insertCell(-1).innerHTML=s.companyname,g.insertCell(-1).innerHTML=s.customertaxid,g.insertCell(-1).innerHTML=u;let T=g.insertCell(-1);T.style.textAlign="center",T.innerHTML=s.customeradditionalnumber,g.insertCell(-1).innerHTML=a;let E=g.insertCell(-1);E.style.textAlign="right",E.style.paddingRight="5px",E.style.whiteSpace="nowrap",E.innerHTML=formatNumber(p);let I=g.insertCell(-1);I.setAttribute("class","noPrint");let v=document.createElement("button");v.setAttribute("class","labelView"),v.type="button",v.name=s.customerid,v.onclick=function(){var e=document.getElementById("lbHearderCompanyName").innerHTML,t=s.companyname,i=s.printnumber,n=DOCUMENT_TYPE[i.slice(0,2)];showPrintOptions(function(){invoicePrintReceipt(i,2)},function(){invoicePrintA4(i,2)},function(){var l=document.getElementById("txtPriPrevCustomerEmail").value;invoiceSendByEmail(i,e,n,t,l)},function(){var e=document.getElementById("btPriPrevSendWhatsApp").value;invoiceSendByWhatsApp(i,n,t,e)},s.email,s.telephone1)},"PAGO"==a&&I.appendChild(v);I.style.textAlign="center",I.style.width="40px"})(l));var s=[["Estado do pagamento","Total"]],a=[["Referência vs estado","Total"]],c=[["Classificação vs estado","Total"]],u=document.getElementById("tblCLILISResumeTable");for(var d in u.innerHTML="",o=0,e)s.push([e[d].desigination,Math.abs(e[d].amount)]),m("Estado do pagamento",e,d);for(var d in o=0,t)a.push([t[d].desigination,Math.abs(t[d].amount)]),m("Referência",t,d);for(var d in o=0,i)c.push([i[d].desigination,Math.abs(i[d].amount)]),m("Classificação 1",i,d);for(var d in o=0,i)m("Classificação 2",i,d);function m(e,t,i){o+=1;let n=u.insertRow(-1);n.setAttribute("class","borderGray");let l=n.insertCell(0);l.setAttribute("class","colRowNumber"),l.innerHTML=o;let r=n.insertCell(1);var s="";1==o&&(s=e,n.style.backgroundColor="rgba(231,249,255)"),r.innerHTML=s.bold();let a=n.insertCell(2);var c=t[i].desigination;""==c&&(c="Não indicado"),a.innerHTML=c;let d=n.insertCell(3);d.style.textAlign="right",d.style.paddingRight="5px",d.innerHTML=formatNumber(t[i].amount)}saleReportCreateGraphic(s,"divCliLisRequestChart","Gráfico do estado de pagamento"),saleReportCreateGraphic(a,"divCliLisMunicipalityChart","Gráfico de referência vs estado"),saleReportCreateGraphic(c,"divCliLisCustomerTypeChart","Gráfico de classificação 1 vs estado"),hideNotification()}},g.send(y)}catch(e){showNotification(e.message,0)}}function customerAccountListOnLoad(e){try{showNotification(),checkUserStatusAfterExecute(function(){selectCountryChange("selCliConCorrCountry","selCliConCorrProvince","selCliConCorrMunicipality",""),fillSelectCustomerAdditional("selCliConCorrAdditionalReference",-1),fillSelectCountry("selCliConCorrCountry",-1),fillSelectMunicipality("selCliConCorrMunicipality",-1,-1,-1);const e=document.getElementById("selCliConCorrProvince");e.onchange=function(){fillSelectMunicipality("selCliConCorrMunicipality",e.value,-1,-1)},fillSelectProvince("selCliConCorrProvince",-1),customerAccountListDetails(),hideNotification()})}catch(e){showNotification(e.message,0)}}function customerAccountListDetails(e=-1){var t={};t.companyId=SYSTEM_USER_STATUS.companyId,t.additionalReference=document.getElementById("selCliConCorrAdditionalReference").value,t.countryId=document.getElementById("selCliConCorrCountry").value,t.provinceId=document.getElementById("selCliConCorrProvince").value,t.municipalityId=document.getElementById("selCliConCorrMunicipality").value,t.customerId=e,t.onlynumber=1,t.startIdx=0,t.endIdx=0,showNotification();var i=new XMLHttpRequest,n="action=getCustomerAccountListDetails&filterInfo="+JSON.stringify(t),l=URL_SA_CUSTOMER_X;i.open("POST",l,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){try{var e=JSON.parse(this.responseText)}catch(e){showHttpResponseText(i)}var n=e.n;n<=0?showNotification("Não encontrado.",0):hideDivFilter();var l=document.getElementById("numResultPageNumber"),o=document.getElementById("numResultItems");function r(){var e=Number(l.value),i=Number(o.value),r=(e-1)*i,s=r+i;s>n&&(s=n),t.totalItems=n,t.startIdx=r,t.endIdx=s,t.onlynumber=0,customerAccountListFilter(t)}l.value=1,setResultTotalPages(l.id,o.id,n),l.onchange=function(){r()},o.onchange=function(){setResultTotalPages(l.id,o.id,n),r()},setElementInnerHtml("lbResultOnList",n),r()}},i.send(n)}function customerAccountListFilter(e){var t=document.getElementById("tblCliConCorrDetailsTable");t.innerHTML="",showNotification();var i=new XMLHttpRequest,n="action=getCustomerAccountListDetails&filterInfo="+JSON.stringify(e),l=URL_SA_CUSTOMER_X;i.open("POST",l,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var n=JSON.parse(this.responseText);setElementInnerHtml("lbResultOnList",e.endIdx+" / "+e.totalItems);for(var l=e.startIdx,o=0;o<n.length;o++){var r=n[o];let e=JSON.parse(r);l+=1;let i=t.insertRow(-1);i.id="trCustomerAccount"+e.customerid,i.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_CUSTOMER_ACCOUNT",i.id));let s=i.insertCell(-1);s.setAttribute("class","colRowNumber"),s.innerHTML=l;let a=i.insertCell(-1);a.setAttribute("class","colProductId"),a.innerHTML=e.customerid;let c=i.insertCell(-1);const u=e.companyname;c.innerHTML=e.companyname,i.insertCell(-1).innerHTML=e.customertaxid;let d=i.insertCell(-1);d.style.textAlign="right",d.style.paddingRight="5px",d.style.whiteSpace="nowrap",d.innerHTML=formatNumber(e.account);let m=i.insertCell(-1);m.setAttribute("class","noPrint");let C=document.createElement("button");C.setAttribute("class","labelView"),C.type="button",C.name=e.customerid,C.onclick=function(){customerAccountSingleDetails(C.name,u),setSelectedRowOnClick(i,"SELECTED_ROW_CUSTOMER_ACCOUNT")},m.appendChild(C),m.style.textAlign="center",m.style.width="40px"}hideNotification()}},i.send(n)}function customerAccountSingleDetails(e,t){showParts("divCliConCorrAccountDetails"),document.getElementById("lbCliConCorrSingleName").innerHTML=t+" ("+e+")";var i=SYSTEM_USER_STATUS.companyId,n=new XMLHttpRequest,l="action=getCustomerAccountSingleDetails&companyId="+i+"&customerId="+e,o=URL_SA_CUSTOMER_X;n.open("POST",o,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(this.responseText);e.length<=0&&showNotification("Não encontrado.",0);let n=document.getElementById("tblCliConCorrSingleTable");n.innerHTML="";var t=0,i=0,l=0;e.forEach(e=>(function(e){let o=JSON.parse(e);t+=1;let r=n.insertRow(-1);r.setAttribute("class","borderGray");let s=r.insertCell(-1);s.setAttribute("class","colRowNumber"),s.innerHTML=t,r.insertCell(-1).innerHTML=o.entrydate,r.insertCell(-1).innerHTML=o.source,r.insertCell(-1).innerHTML=o.reason;let a=r.insertCell(-1);a.style.textAlign="right",a.style.paddingRight="5px",a.style.whiteSpace="nowrap",a.innerHTML=formatNumber(o.amount);let c=r.insertCell(-1);c.style.textAlign="right",c.style.paddingRight="5px",c.style.whiteSpace="nowrap",c.innerHTML=formatNumber(o.balanceamount),i+=Number(o.amount),l+=Number(o.balanceamount)})(e));let o=n.insertRow(-1);o.setAttribute("class","borderGray"),o.style.fontWeight="bold",o.insertCell(-1).setAttribute("class","colRowNumber");o.insertCell(-1);o.insertCell(-1).innerHTML="Total";o.insertCell(-1);let r=o.insertCell(-1);r.style.textAlign="right",r.style.paddingRight="5px",r.style.whiteSpace="nowrap",r.innerHTML=formatNumber(i);let s=o.insertCell(-1);s.style.textAlign="right",s.style.paddingRight="5px",s.style.whiteSpace="nowrap",s.innerHTML=formatNumber(l)}},n.send(l)}function customerRegisterOnLoad(){checkUserStatusAfterExecute(function(){fillSelectCustomerType("selCliCadCustomerType"),fillSelectProvince("selCliCadBillProvince",-1,SYSTEM_USER_STATUS.provinceId),fillSelectMunicipality("selCliCadBillMunic",Number(SYSTEM_USER_STATUS.provinceId),-1),fillSelectZoneBlock("selCliCadBillBlock",-1)})}function customerRegisterLoteOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){CUSTOMER_REGISTER_LINES=[],"GME"==e?showParts("divCustRegLoteNUS"):hideParts("divCustRegLoteNUS"),hideNotification()})}function customerRegisterLoteAddCustomer(e=0){showNotification();let t=document.getElementById("tblCustRegLoteMainTable");var i=Number(t.rows.length)+1,n=new _customer;0!=e?n=e:(n.billingmunicipality=SYSTEM_USER_STATUS.municipalityId,n.customerid=n.serie+n.sequencenumber),n.status=1,n.billingprovince=SYSTEM_USER_STATUS.provinceId,CUSTOMER_REGISTER_LINES[Number(i-1)]=n;let l=t.insertRow(-1);l.setAttribute("class","borderGray"),l.setAttribute("id","rowCustRegLote"+i);let o=l.insertCell(-1);o.setAttribute("class","colRowNumber"),o.innerHTML=i;let r=l.insertCell(-1);r.style.width="50px";let s=document.createElement("input");s.setAttribute("class","textUpperUcase"),s.id="txtCustRegLoteSerie"+i,s.type="text",s.maxlength="95",s.value=n.serie,s.onchange=function(){customerRegisterLoteOnChange(i,this,"serie"),n.customerid=n.serie+n.sequencenumber,setElementValue("txtCustRegLoteCustomerId"+i,n.customerid)},r.appendChild(s);let a=l.insertCell(-1);a.style.width="80px";let c=document.createElement("input");c.setAttribute("class","textUpperUcase"),c.id="txtCustRegLoteSequence"+i,c.type="number",c.min=1,c.value=n.sequencenumber,c.onchange=function(){customerRegisterLoteOnChange(i,this,"sequencenumber"),n.customerid=n.serie+n.sequencenumber,setElementValue("txtCustRegLoteCustomerId"+i,n.customerid)},a.appendChild(c);let u=l.insertCell(-1);u.style.width="100px";let d=document.createElement("input");d.setAttribute("class","textUpperUcase"),d.id="txtCustRegLoteCustomerId"+i,d.type="text",d.maxlength="95",d.value=n.customerid,d.disabled="true",d.onchange=function(){customerRegisterLoteOnChange(i,this,"customerid")},u.appendChild(d);let m=l.insertCell(-1);m.style.width="150px";let C=document.createElement("input");C.setAttribute("class","textUpperUcase"),C.id="txtCustRegLoteCompanyName"+i,C.type="text",C.maxlength="95",C.value=n.companyname,C.onchange=function(){customerRegisterLoteOnChange(i,this,"companyname")},m.appendChild(C);let p=l.insertCell(-1);p.style.width="100px";let S=document.createElement("select");S.id="selCustRegLoteCustomerType"+i,S.onchange=function(){customerRegisterLoteOnChange(i,this,"customertype",!0)},p.appendChild(S),fillSelectCustomerType(S.id,1,n.customertype);let g=l.insertCell(-1);g.style.width="100px";let y=document.createElement("input");y.setAttribute("class","textUpperUcase"),y.id="txtCustRegLoteTaxId"+i,y.type="text",y.maxlength="95",y.value=n.customertaxid,y.onchange=function(){customerRegisterLoteOnChange(i,this,"customertaxid")},g.appendChild(y);let h=l.insertCell(-1);h.style.width="100px";let T=document.createElement("select");T.id="selCustRegLoteMunicipality"+i,T.onchange=function(){customerRegisterLoteOnChange(i,this,"billingmunicipality",!0)},h.appendChild(T),fillSelectMunicipality(T.id,SYSTEM_USER_STATUS.provinceId,1,n.billingmunicipality);let E=l.insertCell(-1);E.style.width="80px";let I=document.createElement("input");I.setAttribute("class","textUpperUcase"),I.id="txtCustRegLoteComuna"+i,I.type="text",I.maxlength="95",I.value=n.billingcomuna,I.onchange=function(){customerRegisterLoteOnChange(i,this,"billingcomuna")},E.appendChild(I);let v=l.insertCell(-1);v.style.width="150px";let f=document.createElement("select");f.id="selCustRegLoteNeiborhood"+i,f.onchange=function(){customerRegisterLoteOnChange(i,this,"billingneiborhood",!0)},v.appendChild(f),fillSelectNeiborhood(f.id,2,-1,n.billingneiborhood);let L=l.insertCell(-1);L.style.width="80px";let R=document.createElement("input");R.setAttribute("class","textUpperUcase"),R.id="txtCustRegLoteStreetName"+i,R.type="text",R.maxlength="95",R.value=n.billingstreetname,R.onchange=function(){customerRegisterLoteOnChange(i,this,"billingstreetname")},L.appendChild(R);let b=l.insertCell(-1);b.style.width="80px";let N=document.createElement("select");N.id="selCustRegLoteBlock"+i,N.onchange=function(){customerRegisterLoteOnChange(i,this,"billingneiborhood",!0)},b.appendChild(N),fillSelectZoneBlock(N.id,-1,n.billingblock);let M=l.insertCell(-1);M.style.width="50px";let _=document.createElement("input");_.setAttribute("class","textUpperUcase"),_.id="txtCustRegLoteBuildNumber"+i,_.type="text",_.maxlength="95",_.value=n.billingbuildingnumber,_.onchange=function(){customerRegisterLoteOnChange(i,this,"billingbuildingnumber")},M.appendChild(_);let w=l.insertCell(-1);w.style.width="50px";let A=document.createElement("input");A.setAttribute("class","textUpperUcase"),A.id="txtCustRegLotePostalCode"+i,A.type="text",A.maxlength="30",A.value=n.billingpostalcode,A.onchange=function(){customerRegisterLoteOnChange(i,this,"billingpostalcode")},w.appendChild(A);let x=l.insertCell(-1);x.style.width="50px";let U=document.createElement("input");U.setAttribute("class","textUpperUcase"),U.id="txtCustRegLotePhone"+i,U.type="text",U.maxlength="30",U.value=n.telephone1,U.onchange=function(){customerRegisterLoteOnChange(i,this,"telephone1")},x.appendChild(U);let O=l.insertCell(-1);O.style.width="100px";let B=document.createElement("input");B.setAttribute("class","textUpperUcase"),B.id="txtCustRegLoteEmail"+i,B.type="text",B.maxlength="95",B.value=n.email,B.onchange=function(){customerRegisterLoteOnChange(i,this,"email")},O.appendChild(B);let H=l.insertCell(-1);var P=document.createElement("button");P.setAttribute("class","labelRemove"),P.type="button",P.onclick=function(){CUSTOMER_REGISTER_LINES[Number(i-1)].status=0,l.innerHTML=""},H.appendChild(P),H.style.textAlign="center",H.style.width="10px",hideNotification()}function customerRegisterLoteOnChange(e,t,i,n=!1){var l=t.value;n||(l=reviewString(t).toString().toUpperCase(),t.value=l),CUSTOMER_REGISTER_LINES[Number(e)-1][i]=l}function customerRegisterLoteCleanTable(){CUSTOMER_REGISTER_LINES=[],cleanElement("tblCustRegLoteMainTable")}function customerRegisterLoteAddProductFromCSV(){document.getElementById("txtCustRegLoteCSV").value.split("/-.").forEach(e=>(function(e){var t=new _customer,i=e.split(";");t.serie=i[0].trim().toUpperCase(),t.sequencenumber=i[1].toUpperCase(),t.customerid=i[2].toUpperCase(),t.companyname=i[3].toUpperCase(),t.customertype=i[4].toUpperCase(),isNaN(t.customertype)&&(t.customertype=1);t.customertaxid=i[5].toUpperCase(),t.billingmunicipality=i[6].toUpperCase(),t.billingcomuna=i[7].toUpperCase(),t.billingneiborhood=i[8].toUpperCase(),t.billingstreetname=i[9].toUpperCase(),t.billingblock=i[10].toUpperCase(),t.billingbuildingnumber=i[11].toUpperCase(),t.billingpostalcode=i[12].toUpperCase(),t.telephone1=i[13].toUpperCase(),t.email=i[14].toUpperCase(),customerRegisterLoteAddCustomer(t)})(e))}var CUSTOMER_LOTE_LAST_ACTIVE=0;function customerRegisterLoteSave(e){if(customerRegisterLoteCheckMandatoryField())return!1;if(customerRegisterLoteCheckDucplicateInfo("customerid","cliente nº"))return!1;if(1==ST_SA_WAITING_SERVER)return alert("Aguardando resposta do servidor. <br>"),!1;var t=SYSTEM_USER_STATUS.companyId,i=SYSTEM_USER_STATUS.workplaceId;if("GME"==e){if(t=reviewString(document.getElementById("txtCustRegLoteNUS")),isNaN(t)||""==t)return alert("Deve indicar o código NUS da empresa"),!1;if(i=reviewString(document.getElementById("txtCustRegLoteDependency")),isNaN(i)||""==i)return alert("Deve indicar a filial de destino."),!1}var n=document.getElementById("divCustRegLoteResulte");n.innerHTML="",showNotification("Esta operação pode demorar alguns minutos.");for(var l=0;l<CUSTOMER_REGISTER_LINES.length;l++){var o=l+1,r=_customer;(r=CUSTOMER_REGISTER_LINES[l]).companyid=t,r.dependencyid=i,r.userId=SYSTEM_USER_STATUS.userId,1==r.status&&s(r,o)}function s(e,t){ST_SA_WAITING_SERVER=1;var i=new XMLHttpRequest,l="action=saveCustomerLoteInfo&customerInfo="+JSON.stringify(e),o=URL_SA_CUSTOMER_X;i.open("POST",o,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;try{var l=JSON.parse(i.responseText)}catch(e){return showHttpResponseText(i),!1}let o=document.createElement("span");o.innerHTML="Linha "+t+", cliente "+e.customerid+", nome "+e.companyname+". Mensagem: "+l.msg,n.appendChild(o),1!=l.status?(document.getElementById("rowCustRegLote"+t).style.color="red",o.style.color="red"):(document.getElementById("rowCustRegLote"+t).style.color="gray",e.status=0),hideNotification()}},i.send(l)}}function customerRegisterLoteCheckMandatoryField(){if(CUSTOMER_REGISTER_LINES.length<=0)return alert("Não foram adicionadas linhas."),!1;for(var e=!1,t="",i=0;i<CUSTOMER_REGISTER_LINES.length;i++){var n,l="";1==(n=CUSTOMER_REGISTER_LINES[i]).status&&(CUSTOMER_LOTE_LAST_ACTIVE=i,""==n.customerid&&(l+="Deve indicar o nº de cliente. "),""==n.companyname&&(l+="Deve indicar o nome completo do cliente. "),""==n.customertaxid&&(l+="Deve indicar o BI / NIF do cliente. "),isNaN(n.billingmunicipality)&&(l+="Deve indicar o município do cliente. "),""!=l&&(e=!0,t+=l="Linha "+Number(i+1)+": "+l+" <br>"))}return e&&alert(t),e}function customerRegisterLoteCheckDucplicateInfo(e,t){if(CUSTOMER_REGISTER_LINES.length<=0)return alert("Não foram adicionadas linhas."),!1;for(var i=!1,n="",l=[],o=0;o<CUSTOMER_REGISTER_LINES.length;o++){var r=CUSTOMER_REGISTER_LINES[o];if(1==r.status&&!l.includes(r[e])){l[o]=r[e];for(var s=0;s<CUSTOMER_REGISTER_LINES.length;s++)if(o!=s){var a=CUSTOMER_REGISTER_LINES[s];1==a.status&&r[e]==a[e]&&(n+="Duplicado "+t+" "+r[e]+" Linhas "+Number(o+1)+" / "+Number(s+1)+" <br>",i=!0)}}}return i&&alert(n),i}function customerGetCreditAccount(e){var t=SYSTEM_USER_STATUS.companyId,i=new XMLHttpRequest,n="action=getCustomerCreditAccount&companyId="+t+"&customerId="+e,l=URL_SA_CUSTOMER_X;i.open("POST",l,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);CUSTOMER_CREDIT_ACCOUNT=Number(e.credit),INVOICE_NEW.customerCredit=CUSTOMER_CREDIT_ACCOUNT,setElementInnerHtml("lbRecPagCreditAccount",formatNumber(CUSTOMER_CREDIT_ACCOUNT)),setElementInnerHtml("lbRecPagSourceAccountBalance",formatNumber(CUSTOMER_CREDIT_ACCOUNT))}},i.send(n)}