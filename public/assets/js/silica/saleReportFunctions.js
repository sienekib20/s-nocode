function saleReportComissionOnLoad(e){showNotification(""),checkUserStatusAfterExecute(function(){hideNotification()})}function saleReportGetDetails(e){var t=SYSTEM_USER_STATUS.companyId,n=SYSTEM_USER_STATUS.userId,l=document.getElementById("txtVDRelComInitialDate").value,i=document.getElementById("txtVDRelComEndDate").value;showNotification();var r=new XMLHttpRequest,o="action=getComissionReport&companyId="+t+"&userId="+n+"&initialDate="+l+"&endDate="+i,a=URL_SA_SALE_REPORT_X;r.open("POST",a,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=JSON.parse(this.responseText);let r=document.getElementById("tblVDRelComDetailsTable");r.innerHTML="";var t=0,n=0,l=0;e.forEach(e=>(function(e){t+=1;let i=JSON.parse(e),o=r.insertRow(-1);o.setAttribute("class","borderGray");let a=o.insertCell(-1);a.setAttribute("class","colRowNumber"),a.innerHTML=t;let s=o.insertCell(-1);const u=i.invoicenumber;s.innerHTML=u,o.insertCell(-1).innerHTML=i.invoicedate;let c=o.insertCell(-1);c.style.textAlign="right",c.style.paddingRight="5px",c.style.whiteSpace="nowrap";let d=Number(i.sellerComission);n+=d,c.innerHTML=formatNumber(d);let m=o.insertCell(-1);m.style.textAlign="right",m.style.paddingRight="5px",m.style.whiteSpace="nowrap";let S=Number(i.managerComission);l+=S,m.innerHTML=formatNumber(S);let p=o.insertCell(-1);p.style.textAlign="right",p.style.paddingRight="5px",p.style.whiteSpace="nowrap";let T=Number(d+S);p.innerHTML=formatNumber(T).bold()})(e));var i=n+l;let o=r.insertRow(-1);o.setAttribute("class","borderGray"),o.style.fontSize="large";let a=o.insertCell(-1);a.setAttribute("colspan","3"),a.style.textAlign="center",a.innerHTML="TOTAL".bold();let s=o.insertCell(-1);s.setAttribute("class","colAmount"),s.innerHTML=formatNumber(n).bold();let u=o.insertCell(-1);u.setAttribute("class","colAmount"),u.innerHTML=formatNumber(l).bold();let c=o.insertCell(-1);c.setAttribute("class","colAmount"),c.innerHTML=formatNumber(i).bold(),hideNotification()}},r.send(o)}function saleReportPaymentsOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setDocumentType(""),setPaymentMechanism(""),setDocumentRequestSource(""),fillSelectDependencyFull("selVDRelDependency",-1,1),setTriggerButtonByText("txtVDRelVDInitialDate","btVDRelPaymentViewAll"),setTriggerButtonByText("txtVDRelVDEndDate","btVDRelPaymentViewAll"),hideNotification()})}function saleReportPaymentDependencyOnChange(e){cleanElement("selVDRelVDSeller"),cleanElement("tblVDRelVDDetailsTable"),cleanElement("tblVDRelVDResumeTable"),saleReportPaymentFillSelectSeller("selVDRelDependency","selVDRelVDSeller")}function saleReportPaymentFillSelectSeller(e,t){var n=SYSTEM_USER_STATUS.companyId,l=document.getElementById(e).value,i=-1;const r=document.getElementById(t);r.innerHTML="";var o=document.createElement("option");if(o.value="-1",o.setAttribute("class","selectPlaceHolder"),o.innerHTML="Seleccionar",r.appendChild(o),Number(SYSTEM_USER_STATUS.billingprofile)<Number(BILLING_PROFILE_PARTNER_INDEX)&&-1==l)return!1;Number(SYSTEM_USER_STATUS.billingprofile)<Number(BILLING_PROFILE_MANAGER_INDEX)&&(i=Number(SYSTEM_USER_STATUS.userId));var a=new XMLHttpRequest,s="action=getSaleReportPaymentFillSelectSeller&companyId="+n+"&dependencyId="+l+"&userId="+i,u=URL_SA_SALE_REPORT_X;a.open("POST",u,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){JSON.parse(this.responseText).forEach(e=>(function(e){let t=JSON.parse(e);var n=document.createElement("option");n.value=t.userid,n.innerHTML=getFirtLastName(t.userfullname)+" ("+t.userid+")",r.appendChild(n)})(e)),i>0&&(r.value=i)}},a.send(s)}function saleReportProductsOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setDocumentRequestSource(""),fillSelectDependencyFull("selVDRelProdDependency",-1,1),fillSelectProductSection("selVDRelVDProdSection",-1),fillSelectProductCategory("selVDRelVDProdCategory",-1),fillSelectProductFamilyBrandModel("selVDRelVDProdFamily","productfamily",-1),fillSelectProductFamilyBrandModel("selVDRelVDProdBrand","productbrand",-1),setTriggerButtonByText("txtVDRelVDProdInitialDate","btVDRelProdViewAll"),setTriggerButtonByText("txtVDRelVDProdEndDate","btVDRelProdViewAll"),hideNotification()})}function saleReportProductDependencyOnChange(e){cleanElement("selVDRelVDProdSeller"),cleanElement("tblVDRelVDProdDetailsTable"),cleanElement("tblVDRelVDProdResumeTable"),saleReportPaymentFillSelectSeller("selVDRelProdDependency","selVDRelVDProdSeller")}function saleReportPaymentDetails(e){var t=SYSTEM_USER_STATUS.companyId,n=document.getElementById("selVDRelDependency").value,l=document.getElementById("txtVDRelVDInitialDate").value,i=document.getElementById("txtVDRelVDEndDate").value,r=document.getElementById("selVDRelVDSeller").value;if(Number(SYSTEM_USER_STATUS.billingprofile)<Number(BILLING_PROFILE_PARTNER_INDEX)&&-1==n)return showNotification("Deve indicar uma filial.",0),!1;if(Number(SYSTEM_USER_STATUS.billingprofile)<Number(BILLING_PROFILE_MANAGER_INDEX)&&-1==r)return showNotification("Deve indicar um vendedor.",0),!1;var o=new Date(l),a=new Date(i);o.getTime()>a.getTime()&&showNotification("Data inicial não deve ser superior a data final.",0),showNotification();var s=new XMLHttpRequest,u="action=getSaleReportPaymentDetails&companyId="+t+"&dependencyId="+n+"&sellerUser="+r+"&initialDate="+l+"&endDate="+i,c=URL_SA_SALE_REPORT_X;s.open("POST",c,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var e={},t={},n={},l={},i={},r={},o={},a=JSON.parse(this.responseText);a.length<=0?showNotification("Não encontrado.",0):hideDivFilter(),document.getElementById("lbResultOnList").innerHTML=a.length;let s=document.getElementById("tblVDRelVDDetailsTable");s.innerHTML="";var u=0,c=0;function d(e,t,n){null!=t&&""!=t&&(t in e?e[t].amount=Number(e[t].amount)+Number(n):e[t]={desigination:t,amount:n})}a.forEach(a=>(function(a){let m=JSON.parse(a);var S=DOCUMENT_REQUEST_SOURCE[m.request],p=getFirtLastName(m.operatorName)+" ("+m.sourceid+")",T=DOCUMENT_TYPE[m.invoicetype],b=PAYMENT_MECHANISM[m.PaymentMechanism].short,R=m.banksource,y=m.accountBankTarget,f=m.tpaterminal,N=Number(m.PaymentAmount);c+=Number(N),d(e,S,N),d(t,p,N),d(n,T,N),d(l,b,N),d(i,R,N),d(r,y,N),d(o,f,N),u+=1;let E=s.insertRow(-1);E.setAttribute("class","borderGray"),N<0?E.style.color="lightgrey":5==m.PaymentMechanism&&(E.style.color="grey");let A=E.insertCell(-1);A.setAttribute("class","colRowNumber"),A.innerHTML=u,E.insertCell(-1).innerHTML=S,E.insertCell(-1).innerHTML=p,E.insertCell(-1).innerHTML=m.invoicenumber,E.insertCell(-1).innerHTML=T;let g=E.insertCell(-1);g.style.textAlign="center",g.innerHTML=setLocalDate(m.transactiondate,10),E.insertCell(-1).innerHTML=b;let M=E.insertCell(-1);M.style.textAlign="center",M.innerHTML=R,E.insertCell(-1).innerHTML=y,E.insertCell(-1).innerHTML=f,E.insertCell(-1).innerHTML=m.reference;let I=E.insertCell(-1);I.style.textAlign="right",I.style.paddingRight="5px",I.style.whiteSpace="nowrap",I.innerHTML=formatNumber(N)})(a));let f=s.insertRow(-1);f.setAttribute("class","borderGray"),f.style.fontSize="large";let N=f.insertCell(-1);N.setAttribute("colspan","10"),N.style.textAlign="center",N.innerHTML="TOTAL".bold();let E=f.insertCell(-1);E.style.textAlign="right",E.style.paddingRight="5px",E.style.whiteSpace="nowrap",E.innerHTML=formatNumber(c).bold();var m=[["Requição","Total"]],S=[["Vendedor","Total"]],p=[["Tipo de documento","Total"]],T=[["Mecanismo de pagamento","Total"]],b=document.getElementById("tblVDRelVDResumeTable");for(var R in b.innerHTML="",u=0,e)m.push([e[R].desigination,Math.abs(e[R].amount)]),y("Requisição",e,R);for(var R in u=0,t)S.push([t[R].desigination,Math.abs(t[R].amount)]),y("Vendedor",t,R);for(var R in u=0,n)p.push([n[R].desigination,Math.abs(n[R].amount)]),y("Tipo de documento",n,R);for(var R in u=0,l)T.push([l[R].desigination,Math.abs(l[R].amount)]),y("Mecanismo de pagamento",l,R);for(var R in u=0,i)y("Banco de origem",i,R);for(var R in u=0,r)y("Conta de destino",r,R);for(var R in u=0,o)y("TPA",o,R);function y(e,t,n){if(1==(u+=1)){let t=b.insertRow(-1);t.setAttribute("class","borderGray");let n=t.insertCell(-1);n.setAttribute("colspan","2"),n.innerHTML=e.bold();let l=t.insertCell(-1);l.innerHTML="Valor (AOA)".bold(),l.style.textAlign="right"}let l=b.insertRow(-1);l.setAttribute("class","borderGray");let i=l.insertCell(-1);i.setAttribute("class","colRowNumber"),i.innerHTML=u,l.insertCell(-1).innerHTML=t[n].desigination;let r=l.insertCell(-1);r.style.textAlign="right",r.style.paddingRight="5px",r.style.whiteSpace="nowrap",r.innerHTML=formatNumber(t[n].amount)}saleReportCreateGraphic(m,"divVDRelRequestChart","Gráfico das requisições"),saleReportCreateGraphic(S,"divVDRelSellerChart","Gráfico dos vendedores"),saleReportCreateGraphic(p,"divVDRelPaymentTypeChart","Gráfico do tipo de documento"),saleReportCreateGraphic(T,"divVDRelPaymentMechanismChart","Gráfico do mecanismo de pagamento"),hideNotification()}},s.send(u)}function saleReportProductDetails(e){var t=SYSTEM_USER_STATUS.companyId,n=Number(document.getElementById("selVDRelProdDependency").value),l=document.getElementById("selVDRelVDProdSeller").value,i=document.getElementById("txtVDRelVDProdInitialDate").value,r=document.getElementById("txtVDRelVDProdEndDate").value,o=document.getElementById("selVDRelVDProdSection").value,a=document.getElementById("selVDRelVDProdCategory").value,s=document.getElementById("selVDRelVDProdFamily").value,u=document.getElementById("selVDRelVDProdBrand").value;if(Number(SYSTEM_USER_STATUS.billingprofile)<Number(BILLING_PROFILE_PARTNER_INDEX)&&-1==n)return showNotification("Deve indicar uma filial.",0),!1;showNotification();var c=new XMLHttpRequest,d="action=getSaleReportProductDetails&companyId="+t+"&dependencyId="+n+"&sellerUser="+l+"&initialDate="+i+"&endDate="+r+"&sectionId="+o+"&category="+a+"&family="+s+"&brand="+u,m=URL_SA_SALE_REPORT_X;c.open("POST",m,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado.",0):hideDivFilter();var t=e.length,n=document.getElementById("numResultPageNumber"),l=document.getElementById("numResultItems");function i(){var i=Number(n.value),r=Number(l.value),o=(i-1)*r,a=o+r;a>t&&(a=t);var s={},u={},c={};setElementInnerHtml("lbResultOnList",a+" / "+t);let d=document.getElementById("tblVDRelVDProdDetailsTable");d.innerHTML="";for(var m=o,S=0,p=0,T=0,b=0,R=0,y=0,f=o;f<a;f++){var N=e[f];let t=JSON.parse(N);var E=DOCUMENT_REQUEST_SOURCE[t.request],A=t.saleType,g=getFirtLastName(t.operatorName)+" ("+t.sourceid+")",M=Number(t.subtotalLine);y+=Number(M),addAmountResume(s,E,M),addAmountResume(c,g,M),addAmountResume(u,A,M);var I=Number(t.quantity),L=Number(t.warehousePrice);L*=1-Number(t.settlementAmount)/100;var h=Number(t.indirectCost)/100+Number(t.commercialCost)/100,D=Number(L+L*h);h=Number(h*L);var v=I*D;S+=v;var C=I*(Number(t.estimatedProfit*D)/100);b+=C;var P=I*((Number(t.sellerComission)/100+Number(t.managerComission)/100)*L);p+=P;var _=I*((Number(t.fundInvestment)/100+Number(t.fundReserve)/100+Number(t.fundSocialaction)/100)*L);T+=_;var w=I*Number(t.ivaValue);R+=w,m+=1;let n=d.insertRow(-1);n.setAttribute("class","borderGray"),M<0&&(n.style.color="gray");let l=n.insertCell(-1);l.setAttribute("class","colRowNumber"),l.innerHTML=m,n.insertCell(-1).innerHTML=E,n.insertCell(-1).innerHTML=A,n.insertCell(-1).innerHTML=g,n.insertCell(-1).innerHTML=t.invoicenumber,n.insertCell(-1).innerHTML=t.productDescription+" - "+t.unitOfMeasure;let i=n.insertCell(-1);i.style.textAlign="center",i.innerHTML=formatNumber(I);let r=n.insertCell(-1);r.setAttribute("class","colAmount"),r.innerHTML=formatNumber(v);let o=n.insertCell(-1);o.setAttribute("class","colAmount"),o.innerHTML=formatNumber(P);let a=n.insertCell(-1);a.setAttribute("class","colAmount"),a.innerHTML=formatNumber(_);let V=n.insertCell(-1);V.setAttribute("class","colAmount"),V.innerHTML=formatNumber(C);let H=n.insertCell(-1);H.setAttribute("class","colAmount"),H.innerHTML=formatNumber(w);let x=n.insertCell(-1);x.setAttribute("class","colAmount"),x.innerHTML=formatNumber(M).bold()}let V=d.insertRow(-1);V.setAttribute("class","borderGray"),V.style.fontSize="large";let H=V.insertCell(-1);H.setAttribute("colspan","7"),H.style.textAlign="center",H.innerHTML="TOTAL".bold();let x=V.insertCell(-1);x.setAttribute("class","colAmount"),x.innerHTML=formatNumber(S).bold();let O=V.insertCell(-1);O.setAttribute("class","colAmount"),O.innerHTML=formatNumber(p).bold();let B=V.insertCell(-1);B.setAttribute("class","colAmount"),B.innerHTML=formatNumber(T).bold();let U=V.insertCell(-1);U.setAttribute("class","colAmount"),U.innerHTML=formatNumber(b).bold();let G=V.insertCell(-1);G.setAttribute("class","colAmount"),G.innerHTML=formatNumber(R).bold();let q=V.insertCell(-1);q.setAttribute("class","colAmount"),q.innerHTML=formatNumber(y).bold();var Y=[["Requição","Total"]],F=[["Tipo de venda","Total"]],X=[["Vendedor","Total"]],J=document.getElementById("tblVDRelVDProdResumeTable");for(var N in J.innerHTML="",m=0,s)m+=1,Y.push([s[N].desigination,Math.abs(s[N].amount)]),resume(J,m,"Requisição",s,N);for(var N in m=0,u)m+=1,F.push([u[N].desigination,Math.abs(u[N].amount)]),resume(J,m,"Tipo de venda",u,N);for(var N in m=0,c)m+=1,X.push([c[N].desigination,Math.abs(c[N].amount)]),resume(J,m,"Vendedor",c,N);saleReportCreateGraphic(Y,"divVDRelProdRequestChart","Gráfico das requisições"),saleReportCreateGraphic(F,"divVDRelProdTypeChart","Gráfico do tipo de venda"),saleReportCreateGraphic(X,"divVDRelProdSellerChart","Gráfico dos vendedores"),hideNotification()}n.value=1,setResultTotalPages(n.id,l.id,t),n.onchange=function(){i()},l.onchange=function(){setResultTotalPages(n.id,l.id,t),i()},i()}},c.send(d)}function saleReportInvoiceMissingPaymentOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setDocumentType(""),fillSelectDependencyFull("selSalInvMisPayDependency",-1,1),fillSelectConsumerTypeAqua("selSalInvMisPayConsumerType",1),fillSelectMunicipality("selSalInvMisPayMunicipality",SYSTEM_USER_STATUS.provinceId,1,SYSTEM_USER_STATUS.municipalityId),fillSelectNeiborhood("selSalInvMisPayNeiborhood",3,-1),setSessionResultSearch("numSalInvMisPayResults");var e=sessionStorage.getItem("customerid");if(null!=e&&""!=e){var t=document.getElementById("btSalInvMisPending");showParts(t.id,!0),t.onclick=function(){saleReportInvoiceMissingPaymentList(JSON.parse(e)),hideParts(t.id)},sessionStorage.setItem("customerid","")}hideNotification()})}var SALE_REPORT_SUBTITLE="";function saleReportInvoiceMissingPaymentList(e=-1,t=-1){if(1==ST_SA_LISTING_SERVER)return showNotification("Procurando...",1),!1;var n={};if(n.companyId=SYSTEM_USER_STATUS.companyId,n.dependencyId=Number(getElementValue("selSalInvMisPayDependency")),n.dependencyId<=0)return showNotification("Deve indicar uma filial.",0),!1;n.initialDate=getElementValue("txtSalInvMisPayInitialDate"),n.endDate=getElementValue("txtSalInvMisPayEndDate"),n.consumertype=getElementValue("selSalInvMisPayConsumerType"),n.municipalityId=getElementValue("selSalInvMisPayMunicipality"),n.neiborhood=getElementValue("selSalInvMisPayNeiborhood"),n.customerId=e,n.contractId=t,-1!=e?(n.customerId=e.customerid,SALE_REPORT_SUBTITLE="Cliente: "+e.companyname+" ["+n.customerId+"]"):-1!=t?(n.contractId=t.contractid,SALE_REPORT_SUBTITLE="Cliente: "+t.companyname+" [Contrato nº "+n.contractId+"]"):SALE_REPORT_SUBTITLE="",n.onlynumber=1,n.startIdx=0,n.endIdx=0,showNotification(),ST_SA_LISTING_SERVER=1;var l=new XMLHttpRequest,i="action=getSaleReportInvoiceMissingPaymentList&filterInfo="+JSON.stringify(n),r=URL_SA_SALE_REPORT_X;l.open("POST",r,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){ST_SA_LISTING_SERVER=0;try{var e=JSON.parse(this.responseText)}catch(e){return showHttpResponseText(l),!1}var t=e.n;t<=0?showNotification("Não encontrado.",0):hideDivFilter(),cleanElement("tblSalInvMisPayMainTable");var i=document.getElementById("numResultPageNumber"),r=document.getElementById("numResultItems");function o(){var e=Number(i.value),l=Number(r.value),o=(e-1)*l,a=o+l;a>t&&(a=t),n.onlynumber=0,n.totalItems=t,n.startIdx=o,n.endIdx=a,saleReportInvoiceMissingPaymentListResult(n)}i.value=1,setResultTotalPages(i.id,r.id,t),i.onchange=function(){o()},r.onchange=function(){setResultTotalPages(i.id,r.id,t),o()},o()}},l.send(i)}function saleReportInvoiceMissingPaymentListResult(e){showNotification();var t=new XMLHttpRequest,n="action=getSaleReportInvoiceMissingPaymentList&filterInfo="+JSON.stringify(e),l=URL_SA_SALE_REPORT_X;t.open("POST",l,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){ST_SA_LISTING_SERVER=0;try{var n=JSON.parse(this.responseText)}catch(e){return showHttpResponseText(t),!1}setElementInnerHtml("lbResultOnList",e.endIdx+" / "+e.totalItems);let d=document.getElementById("tblSalInvMisPayMainTable");d.innerHTML="";for(var l=e.startIdx,i=0,r=0;r<n.length;r++){var o=n[r];l+=1;let e=JSON.parse(o);const t=e.invoicenumber,m=e.printnumber;e.customerid;let S=d.insertRow(-1);S.id="trSaleMissingPayment"+t,S.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_SALE_MISSING_PAYMENT",S.id));let p=S.insertCell(-1);p.setAttribute("class","colRowNumber"),p.innerHTML=l;let T=S.insertCell(-1);T.setAttribute("class","colProductId"),T.innerHTML=e.contractid;let b=S.insertCell(-1);b.setAttribute("class","colProductId"),b.innerHTML=e.cil;let R=S.insertCell(-1);R.style.minWidth="200px",R.innerHTML=e.customername+" ("+e.customerid+")";let y=S.insertCell(-1);y.style.whiteSpace="nowrap",y.innerHTML=t;let f=S.insertCell(-1);1==e.consumptioninvoice&&(f.style.textAlign="center",f.innerHTML=dateYearMonthExtension(e.billingstartdate));let N=S.insertCell(-1);N.setAttribute("class","colAmount noPrint"),N.innerHTML=formatNumber(e.paymentamount);let E=S.insertCell(-1);E.setAttribute("class","colAmount");var a=Number(e.amountMissing);i+=a,E.innerHTML=formatNumber(a);let A=S.insertCell(-1);A.style.minWidth="70px",A.setAttribute("class","colProductId"),A.innerHTML=setLocalDate(e.installmentdate,10);var s="",u=Number(e.delayDays),c="Faltam ";u<0?(s="rgb(255,143,143)",c="Atrasado "+Math.abs(u)+" dias"):0==u?(s="rgb(143,143,255)",c="HOJE".bold()):u<=3?(s="rgb(255,222,117)",c+=u+" dias"):c+=u+" dias";let g=S.insertCell(-1);g.setAttribute("class","colProductId noPrint"),g.innerHTML=c,g.style.backgroundColor=s;let M=S.insertCell(-1);if(M.setAttribute("class","noPrint"),checkPermission("0205")){let t=document.createElement("button");t.innerHTML="Recibo",t.type="button",t.setAttribute("class","labelPayment"),t.onclick=function(){setSelectedRowOnClick(S,"SELECTED_ROW_SALE_MISSING_PAYMENT"),e.transactiondate=e.invoicedate,sessionStorage.setItem("invoiceInvoiceInvoiceNumber",JSON.stringify(e)),window.location.assign("SalePayment.php")},M.appendChild(t),M.style.textAlign="center"}let I=document.createElement("button");I.setAttribute("class","labelPrint"),I.type="button",I.onclick=function(){var n=document.getElementById("lbHearderCompanyName").innerHTML,l=e.newCustomerName,i=DOCUMENT_TYPE[t.slice(0,2)]+" nº"+t;showPrintOptions(function(){invoicePrintReceipt(m,2)},function(){invoicePrintA4(m,2)},function(){var e=document.getElementById("txtPriPrevCustomerEmail").value;invoiceSendByEmail(m,n,i,l,e)},function(){var e=document.getElementById("btPriPrevSendWhatsApp").value;invoiceSendByWhatsApp(m,i,l,e)},e.newEmail,e.newTelephone)},M.appendChild(I);let L=document.createElement("button");L.innerHTML=" Aviso",L.type="button",L.setAttribute("class","labelPrint"),L.onclick=function(){setSelectedRowOnClick(S,"SELECTED_ROW_SALE_MISSING_PAYMENT"),saleReportShowBillingNotice(e.contractid)},M.appendChild(L),M.style.textAlign="center"}let m=d.insertRow(-1);m.setAttribute("class","borderGray"),m.style.fontSize="large";let S=m.insertCell(-1);S.setAttribute("colspan","5"),S.style.textAlign="center",S.innerHTML="TOTAL".bold();let p=m.insertCell(-1);p.setAttribute("class","colAmount"),p.innerHTML=formatNumber(i).bold(),hideNotification()}},t.send(n)}function saleReportShowBillingNotice(e=-1){var t={};if(t.companyId=SYSTEM_USER_STATUS.companyId,t.dependencyId=Number(getElementValue("selSalInvMisPayDependency")),Number(SYSTEM_USER_STATUS.billingprofile)<Number(BILLING_PROFILE_PARTNER_INDEX)&&t.dependencyId<=0)return showNotification("Deve indicar uma filial.",0),!1;t.consumertype=getElementValue("selSalInvMisPayConsumerType"),t.municipalityId=getElementValue("selSalInvMisPayMunicipality"),t.neiborhood=getElementValue("selSalInvMisPayNeiborhood"),t.contractId=e,sessionStorage.setItem("billingNoticeFilterInfo",JSON.stringify(t)),window.open("printBillingNoticeA4.php")}function saleConsumptionReportOnLoad(){try{showNotification(),checkUserStatusAfterExecute(function(){setDocumentType(""),setPaymentMechanism(""),setLinkRequestStatus(),setElementValue("numSaleConsuRepYear",(new Date).getFullYear()),fillSelectDependencyFull("selSaleConsuRepDependency",-1,1),fillSelectMonth("selSaleConsuRepMonth",1,(new Date).getMonth()+1),fillSelectConsumerTypeAqua("selSaleConsuRepConsumerType",-1),fillSelectMunicipality("selSaleConsuRepMunicipality",SYSTEM_USER_STATUS.provinceId,-1,-1),fillSelectNeiborhood("selSaleConsuRepNeiborhood",3,-1),setTriggerButtonByText("txtSaleConsuRepInitialDate","btSaleConsuRepViewAll"),setTriggerButtonByText("txtSaleConsuRepEndDate","btSaleConsuRepViewAll"),saleConsumptionReportDetails(),hideNotification()})}catch(e){showNotification(e.message,0)}}function saleConsumptionReportDetails(){try{if(1==ST_SA_LISTING_SERVER)return showNotification("Procurando...",1),!1;var e={};if(e.companyId=SYSTEM_USER_STATUS.companyId,e.dependencyId=getElementValue("selSaleConsuRepDependency"),e.dependencyId<=0&&Number(SYSTEM_USER_STATUS.billingprofile)<BILLING_PROFILE_PARTNER_INDEX)return showNotification("Seleccionar uma filial.",0),!1;var t=Number(getElementValue("numSaleConsuRepYear")),n=Number(getElementValue("selSaleConsuRepMonth"))-1;e.initialDate=setLocalDate(new Date(t,n,1),10),e.endDate=setLocalDate(new Date(t,n,daysInMonth(n,t)),10),e.consumertype=getElementValue("selSaleConsuRepConsumerType"),e.municipalityId=getElementValue("selSaleConsuRepMunicipality"),e.neiborhood=getElementValue("selSaleConsuRepNeiborhood"),e.fullReport=1;var l=document.getElementById("tblSaleConsuRepListTable");l.innerHTML="",showNotification(),ST_SA_LISTING_SERVER=1;var i=new XMLHttpRequest,r="action=getSaleConsumptionReportDetails&filterInfo="+JSON.stringify(e),o=URL_SA_SALE_REPORT_X;i.open("POST",o,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){ST_SA_LISTING_SERVER=0;try{var e=JSON.parse(this.responseText)}catch(e){return showHttpResponseText(i),!1}e.length<=0?showNotification("Não encontrado.",0):hideDivFilter();for(var t=0,n=0,r=0,o=0,a=0,s=0,u=0;u<e.length;u++){var c=e[u];let i=JSON.parse(c);t+=1;let b=l.insertRow(-1);b.setAttribute("class","borderGray");let R=b.insertCell(-1);R.setAttribute("class","colRowNumber"),R.innerHTML=t,b.insertCell(-1).innerHTML=dateYearMonthExtension(i.billingstartdate).toUpperCase();let y=b.insertCell(-1);y.setAttribute("class","colAmount"),y.innerHTML=i.nInvoices,n+=Number(i.nInvoices);let f=b.insertCell(-1);f.setAttribute("class","colAmount"),f.innerHTML=formatNumber(i.consumptionamount),r+=Number(i.consumptionamount);let N=b.insertCell(-1);N.setAttribute("class","colAmount");var d=Number(i.totalInvoice);N.innerHTML=formatNumber(d),o+=d;let E=b.insertCell(-1);E.setAttribute("class","colAmount");var m=Number(i.paymentamount);m>d&&(m=d),E.innerHTML=formatNumber(m),a+=m;let A=b.insertCell(-1);A.setAttribute("class","colAmount");var S=m/d*100;A.innerHTML=formatNumber(S)+"%";let g=b.insertCell(-1);g.setAttribute("class","colAmount");var p=d-m;p<0&&(p=0),g.innerHTML=formatNumber(p),s+=p;let M=b.insertCell(-1);M.setAttribute("class","colAmount");var T=p/d*100;M.innerHTML=formatNumber(T)+"%"}let b=l.insertRow(-1);b.setAttribute("class","borderGray"),b.style.fontSize="large";let R=b.insertCell(-1);R.setAttribute("colspan","2"),R.style.textAlign="center",R.innerHTML="TOTAL".bold();let y=b.insertCell(-1);y.setAttribute("class","colAmount"),y.innerHTML=n;let f=b.insertCell(-1);f.setAttribute("class","colAmount"),f.innerHTML=formatNumber(r);let N=b.insertCell(-1);N.setAttribute("class","colAmount"),N.innerHTML=formatNumber(o);let E=b.insertCell(-1);E.setAttribute("class","colAmount"),E.innerHTML=formatNumber(a);let A=b.insertCell(-1);A.setAttribute("class","colAmount");S=a/o*100;A.innerHTML=formatNumber(S)+"%";let g=b.insertCell(-1);g.setAttribute("class","colAmount"),g.innerHTML=formatNumber(s);let M=b.insertCell(-1);M.setAttribute("class","colAmount");T=s/o*100;M.innerHTML=formatNumber(T)+"%",hideNotification()}},i.send(r)}catch(e){showNotification(e.message,0)}}