class _licenseType{constructor(e="",t="",n=0,i=0,s=-1,c=-1,a=-1,l=-1,o=-1,r=0,d=-1,u=1){this.licensetypeid=e,this.designation=t,this.selfdomain=n,this.silicatype=i,this.desktoptype=s,this.maxusers=c,this.maxproducts=a,this.maxinvoices=l,this.saleamount=o,this.salepercentage=r,this.duration=d,this.licenselevel=u}}class _licenseAssigned{constructor(e=0,t="",n="",i=-1,s=-1){this.companyid=e,this.invoicenumber=t,this.productdescription=n,this.licensetypeid=i,this.entryuser=s}}function licenseTypeOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){licenseTypeNew(""),licenseTypeList(""),hideNotification()})}function licenseTypeNew(e){showDivFilter(),document.getElementById("txtLicTipId").value="Novo tipo de licença",document.getElementById("txtLicTipDesignation").value="",document.getElementById("selLicTipSelfDomain").value="0",document.getElementById("selLicTipSilicaType").value="0",document.getElementById("selLicTipDesktopType").value="-1",document.getElementById("numLicTipLicenseLevel").value="1",document.getElementById("numLicTipMaxUsers").value="-1",document.getElementById("numLicTipMaxProducts").value="-1",document.getElementById("numLicTipMaxInvoices").value="-1",document.getElementById("numLicTipSalesAmount").value="-1",document.getElementById("numLicTipSalePercentage").value="0",document.getElementById("numLicTipDuration").value="-1",document.getElementById("txtLicTipDesignation").focus}function licenseTypeSave(e){var t=new _licenseType;if(t.licensetypeid=document.getElementById("txtLicTipId").value,t.designation=reviewString(document.getElementById("txtLicTipDesignation")),t.selfdomain=document.getElementById("selLicTipSelfDomain").value,t.silicatype=document.getElementById("selLicTipSilicaType").value,t.desktoptype=document.getElementById("selLicTipDesktopType").value,t.maxusers=document.getElementById("numLicTipMaxUsers").value,t.maxproducts=document.getElementById("numLicTipMaxProducts").value,t.maxinvoices=document.getElementById("numLicTipMaxInvoices").value,t.saleamount=document.getElementById("numLicTipSalesAmount").value,t.salepercentage=document.getElementById("numLicTipSalePercentage").value,t.duration=document.getElementById("numLicTipDuration").value,t.licenselevel=document.getElementById("numLicTipLicenseLevel").value,""==t.designation)return showNotification("Deve indicar a designação",0),document.getElementById("txtLicTipDesignation").focus,!1;showNotification();var n=new XMLHttpRequest,i="action=saveLicenseType&licenseTypeInfo="+JSON.stringify(t),s=URL_SA_LICENSE_X;n.open("POST",s,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(n.responseText);1==e.status?(showNotification("Tipo de licença actualizado com sucesso.",1),licenseTypeList(""),licenseTypeNew("")):showNotification(e.msg,0)}},n.send(i)}function licenseTypeList(e){showNotification();var t=new XMLHttpRequest,n=URL_SA_LICENSE_X;t.open("POST",n,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);let n=document.getElementById("tblLicTipMainTable");n.innerHTML="";var t=0;e.forEach(e=>(function(e){t+=1;let i=JSON.parse(e),s=n.insertRow(-1);s.setAttribute("class","borderGray");let c=s.insertCell(0);c.setAttribute("class","colRowNumber"),c.innerHTML=t;let a=s.insertCell(1);a.setAttribute("class","colProductId"),a.innerHTML=i.id,s.insertCell(2).innerHTML=i.designation;let l=s.insertCell(3);l.style.textAlign="center",l.innerHTML=0==i.selfdomain?"Não":"Sim";let o=s.insertCell(4);o.style.textAlign="center",o.innerHTML=-1==i.maxusers?"Ilimitado":formatNumber(i.maxusers);let r=s.insertCell(5);r.style.textAlign="center",r.innerHTML=-1==i.maxproducts?"Ilimitado":formatNumber(i.maxproducts);let d=s.insertCell(6);d.style.textAlign="center",d.innerHTML=-1==i.maxinvoices?"Ilimitado":formatNumber(i.maxinvoices);let u=s.insertCell(7);u.style.textAlign="center",u.innerHTML=-1==i.saleamount?"Ilimitado":formatNumber(i.saleamount);let m=s.insertCell(8);m.style.textAlign="center",m.innerHTML=formatNumber(i.salepercentage);let p=s.insertCell(9);p.style.textAlign="center",p.innerHTML=-1==i.duration?"Ilimitado":formatNumber(i.duration);let y=s.insertCell(10);y.setAttribute("class","noPrint");var L=document.createElement("button");L.setAttribute("class","labelEdit"),L.type="button",L.name=i.id,L.onclick=function(){licenseTypeEdit(L.name)},y.appendChild(L),y.style.textAlign="center";var T=document.createElement("button");T.setAttribute("class","labelDelete"),T.type="button",T.name=i.id,T.onclick=function(){licenseTypeDelete(T.name)},y.appendChild(T)})(e)),hideDivFilter(),setAutoCompleteToFiel("txtLicTipDesignation",2),hideNotification()}},t.send("action=getLicenseList")}function licenseTypeEdit(e){var t=new XMLHttpRequest,n="action=licenseTypeEdit&licenseTypeId="+e,i=URL_SA_LICENSE_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){var t=JSON.parse(e);document.getElementById("txtLicTipId").value=t.id,document.getElementById("txtLicTipDesignation").value=t.designation,document.getElementById("selLicTipSelfDomain").value=t.selfdomain,document.getElementById("selLicTipSilicaType").value=t.silicatype,document.getElementById("selLicTipDesktopType").value=t.desktoptype,document.getElementById("numLicTipMaxUsers").value=t.maxusers,document.getElementById("numLicTipMaxProducts").value=t.maxproducts,document.getElementById("numLicTipMaxInvoices").value=t.maxinvoices,document.getElementById("numLicTipSalesAmount").value=t.saleamount,document.getElementById("numLicTipSalePercentage").value=t.salepercentage,document.getElementById("numLicTipDuration").value=t.duration,document.getElementById("numLicTipLicenseLevel").value=t.licenselevel,document.getElementById("txtLicTipDesignation").focus})(e)),showDivFilter()}},t.send(n)}function licenseTypeDelete(e){showConfirm("Esta acção poderá afectar alguns clientes. <br><br> Tem a certeza que deseja eliminar tipo de licença?",function(){var t=new XMLHttpRequest,n="action=deleteLicenseType&licenseTypeId="+e,i=URL_SA_LICENSE_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4==this.readyState&&200==this.status&&(showNotification(this.responseText,1),licenseTypeList(""))},t.send(n)})}function licenseAssignedOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setLicenseStatus(""),fillSelectCompany("selLicAssCompany",-1),fillSelectLicenseType("selLicAssLicenseType",-1),licenseAssignedList(""),document.getElementById("selLicAssCompany").onchange=function(){licenseAssignedList(""),fillSelectInvoice("selLicAssInvoice",-1)},hideNotification()})}function fillSelectCompany(e,t=1){const n=document.getElementById(e);if(!validateUserControl(n))return!1;if(n.innerHTML="",-1==t){var i=document.createElement("option");i.value="-1",i.setAttribute("class","selectPlaceHolder"),i.innerHTML="Seleccionar",n.appendChild(i)}var s=new XMLHttpRequest,c=URL_SA_LICENSE_X;s.open("POST",c,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){let t=JSON.parse(e);var i=document.createElement("option");i.value=t.id,i.innerHTML=t.companyname+" ("+t.id+")",n.appendChild(i)})(e))}},s.send("action=getCompanyList")}function fillSelectLicenseType(e,t=1){const n=document.getElementById(e);if(!validateUserControl(n))return!1;if(n.innerHTML="",-1==t){var i=document.createElement("option");i.value="-1",i.setAttribute("class","selectPlaceHolder"),i.innerHTML="Seleccionar",n.appendChild(i)}var s=new XMLHttpRequest,c=URL_SA_LICENSE_X;s.open("POST",c,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){let t=JSON.parse(e);var i=document.createElement("option");i.value=t.id;var s=0==t.selfdomain?"":"Servidor autónomo, ";s+=formatNumber(t.salepercentage)+"% em vendas, ",s+="Duração - ",s+=-1==t.duration?"Ilimitado":t.duration+" dias ",i.innerHTML=t.designation+" ("+s+")",n.appendChild(i)})(e))}},s.send("action=getLicenseList")}function licenseAssignedSave(e){var t=SYSTEM_USER_STATUS.userId,n=new _licenseAssigned;n.companyid=document.getElementById("selLicAssCompany").value,n.invoicenumber=document.getElementById("selLicAssInvoice").value,n.productdescription=document.getElementById("selLicAssService").value,n.licensetypeid=document.getElementById("selLicAssLicenseType").value,n.entryuser=t;var i=!1,s="";if(n.companyid<1&&(i=!0,s="Deve indicar o contratante. <br>"),n.licensetypeid<1&&(i=!0,s="Deve indicar o tipo de licença. <br>"),1==i)return alert(s),!1;showNotification();var c=new XMLHttpRequest,a="action=saveLicenseAssigned&licenseAssignedInfo="+JSON.stringify(n),l=URL_SA_LICENSE_X;c.open("POST",l,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){4==this.readyState&&200==this.status&&(1==c.responseText?(showNotification("Licença gerada com sucesso.",1),licenseAssignedList("")):hideNotification())},c.send(a)}function licenseAssignedList(e){var t=document.getElementById("selLicAssCompany").value;showNotification();var n=new XMLHttpRequest,i="action=getLicenseAssignedList&companyId="+t+"&licenseType=-1",s=URL_SA_LICENSE_X;n.open("POST",s,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);let n=document.getElementById("tblLicAssMainTable");n.innerHTML="";var t=0;e.forEach(e=>(function(e){t+=1;let i=JSON.parse(e);var s=Number(i.status);let c=n.insertRow(-1);c.setAttribute("class","borderGray"),-1==s?c.style.color="red":0==s?c.style.color="rgb(72,0,0)":1==s&&(c.style.fontWeight="bold");let a=c.insertCell(0);a.setAttribute("class","colRowNumber"),a.innerHTML=t;let l=c.insertCell(1);l.setAttribute("class","colProductId"),l.innerHTML=i.id,c.insertCell(2).innerHTML=i.companyname,c.insertCell(3).innerHTML=i.invoicenumber+", "+i.productdescription,c.insertCell(4).innerHTML=i.licensetype;let o=c.insertCell(5);o.style.textAlign="center",o.innerHTML=LICENSE_STATUS[Number(i.status)];let r=c.insertCell(6);r.style.textAlign="center",r.innerHTML=i.enddate,c.insertCell(7).innerHTML=getFirtLastName(i.operatorname)+" ("+i.entryuser+")";let d=c.insertCell(8);d.style.textAlign="center",d.innerHTML=i.entrydate;let u=c.insertCell(9);u.setAttribute("class","noPrint");var m=document.createElement("button");m.setAttribute("class","labelDelete"),m.type="button",m.name=i.id,m.onclick=function(){licenseAssignedDelete(m.name)},u.appendChild(m),u.style.textAlign="center"})(e)),hideNotification()}},n.send(i)}function licenseAssignedDelete(e){showConfirm("Tem a certeza que deseja eliminar esta licença?",function(){var t=new XMLHttpRequest,n="action=deleteLicenseAssigned&licenseAssignedId="+e,i=URL_SA_LICENSE_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4==this.readyState&&200==this.status&&(showNotification(this.responseText,1),licenseAssignedList(""))},t.send(n)})}function fillSelectInvoice(e,t=1){const n=document.getElementById(e);if(!validateUserControl(selLicense))return!1;if(n.innerHTML="",-1==t){var i=document.createElement("option");i.value="",i.setAttribute("class","selectPlaceHolder"),i.innerHTML="Seleccionar",n.appendChild(i)}var s=document.getElementById("selLicAssCompany").value;if(-1==s)return!1;var c=new XMLHttpRequest,a="action=getInvoiceList&customerId="+s,l=URL_SA_LICENSE_X;c.open("POST",l,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){let t=JSON.parse(e);var i=document.createElement("option");i.value=t.invoicenumber,i.innerHTML=t.invoicenumber+" ("+t.invoicestatus+")",n.appendChild(i)})(e))}},c.send(a)}function licenseDesktopActivateOnLoad(){showNotification(),checkUserStatusAfterExecute(function(){setLicenseStatus(""),fillSelectCompany("selLicAssCompany",-1),licenseDesktopActivateList(),document.getElementById("selLicAssCompany").onchange=function(){licenseDesktopActivateList()},hideNotification()})}function licenseDesktopActivateList(){var e=document.getElementById("selLicAssCompany").value;showNotification();var t=new XMLHttpRequest,n="action=getLicenseAssignedList&companyId="+e+"&licenseType=1",i=URL_SA_LICENSE_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);let n=document.getElementById("tblLicAssMainTable");n.innerHTML="";var t=0;e.forEach(e=>(function(e){t+=1;let i=JSON.parse(e);var s=Number(i.status);let c=n.insertRow(-1);c.setAttribute("class","borderGray"),-1==s?c.style.color="red":0==s?c.style.color="rgb(72,0,0)":1==s&&(c.style.fontWeight="bold");let a=c.insertCell(-1);a.setAttribute("class","colRowNumber"),a.innerHTML=t;let l=c.insertCell(-1);l.setAttribute("class","colProductId"),l.innerHTML=i.id,c.insertCell(-1).innerHTML=i.companyname,c.insertCell(-1).innerHTML=i.licensetype,c.insertCell(-1).innerHTML=i.serialnumber;let o=c.insertCell(-1);o.style.textAlign="center",o.innerHTML=LICENSE_STATUS[Number(i.status)];let r=c.insertCell(-1);r.style.textAlign="center",r.innerHTML=i.enddate;let d=c.insertCell(-1);d.style.textAlign="center",d.innerHTML=setLocalDate(i.entrydate,16);let u=c.insertCell(-1);if(u.setAttribute("class","noPrint"),2==s){var m=document.createElement("button");m.type="button",m.innerHTML="Activar",m.name=i.id,m.onclick=function(){licenseDesktopActivateShowActive(i)},u.appendChild(m)}else if(1==s){var p=document.createElement("button");p.type="button",p.innerHTML="Download",p.name=i.id,p.onclick=function(){window.open("_lic/index.php?sn="+i.serialnumber)},u.appendChild(p)}u.style.textAlign="center"})(e)),hideNotification()}},t.send(n)}function licenseDesktopActivateShowActive(e){showParts("divLicenseDesktopActivate"),setElementInnerHtml("lbLicDeskActCompanyId",e.companyid),setElementInnerHtml("lbLicDeskActCompanyName",e.companyname),setElementInnerHtml("lbLicDeskActLicenseType",e.licensetype),setElementInnerHtml("lbLicDeskActSerialNumber",e.serialnumber),setElementValue("txtLicDeskActMacAddress1"),setElementValue("txtLicDeskActMacAddress2"),setElementValue("txtLicDeskActMacAddress3"),document.getElementById("btLicDeskActFinish").onclick=function(){licenseDesktopActivateActivate(e)}}function licenseDesktopActivateActivate(e){var t={licenseId:e.id,companyid:e.companyid,serialnumber:e.serialnumber,mac1:"",mac2:"",mac3:"",licensetype:1,statususer:SYSTEM_USER_STATUS.userId};if(e.licensetype.toString().includes("TALCO")?t.licensetype=2:e.licensetype.toString().includes("GESSO")&&(t.licensetype=3),t.mac1=reviewString(document.getElementById("txtLicDeskActMacAddress1")).toLocaleUpperCase().replace(/[^A-F0-9]/g,""),t.mac2=reviewString(document.getElementById("txtLicDeskActMacAddress2")).toLocaleUpperCase().replace(/[^A-F0-9]/g,""),t.mac3=reviewString(document.getElementById("txtLicDeskActMacAddress3")).toLocaleUpperCase().replace(/[^A-F0-9]/g,""),""==t.mac1&&""==t.mac2&&""==t.mac3)return alert("Deve indicar um endereço físico válido"),!1;showNotification();var n=new XMLHttpRequest,i="action=activateLicenseAssigned&licenseInfo="+JSON.stringify(t),s=URL_SA_LICENSE_X;n.open("POST",s,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);1==e.status?(showNotification(e.msg,1),hideParts("divLicenseDesktopActivate"),window.open("_lic/index.php?sn="+t.serialnumber),licenseDesktopActivateList()):hideNotification()}},n.send(i)}