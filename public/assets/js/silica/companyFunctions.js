class _companyDependency{constructor(e,t=0,n=-1,i=-1,a="",o=-1,l=1,r="",s="",c="",d="",m="",p="",u="",y="",g=""){this.companyid=e,this.dependencyid=t,this.provinceid=n,this.municipalityid=i,this.designation=a,this.coordinatoruser=o,this.printlayout=l,this.address=r,this.phone1=s,this.phone2=c,this.phone3=d,this.email=m,this.website=p,this.facebook=u,this.whatsapp=y,this.slogan=g}}function companyGetInfo(e,t=""){isNaN(e)&&(e=-1);var n=document.getElementById("txtEmpCadCompanyId"),i=document.getElementById("txtEmpCadOficialDesignation"),a=document.getElementById("txtEmpCadNIF"),o=document.getElementById("selEmpCadType");if("COMCAD"==t)var l=document.getElementById("numEmpCadFiscalYear"),r=document.getElementById("selEmpCadIvaGroup"),s=document.getElementById("selEmpCadIrtGroup"),c=document.getElementById("selEmpCadIIGroup"),d=document.getElementById("selEmpCadContabilityStatus");var m=document.getElementById("selEmpCadBillCountry"),p=document.getElementById("selEmpCadBillProvince"),u=document.getElementById("selEmpCadBillMunicipality"),y=document.getElementById("txtEmpCadBillCity"),g=document.getElementById("txtEmpCadBillDistrict"),E=document.getElementById("txtEmpCadBillComuna"),h=document.getElementById("txtEmpCadBillNeiborhood"),v=document.getElementById("txtEmpCadBillStreet"),C=document.getElementById("txtEmpCadBillBuidNumber"),S=document.getElementById("txtEmpCadBillPostal"),f=document.getElementById("txtEmpCadTelef1"),I=document.getElementById("txtEmpCadTelef2"),T=document.getElementById("txtEmpCadTelef3"),N=document.getElementById("txtEmpCadEmail"),b=document.getElementById("txtEmpCadWebsite");if("COMCAD"==t)var w=document.getElementById("lbEmpCadNewLogo"),R=document.getElementById("imgEmpCadCompanyLogo");var L=document.getElementById("lbEmpCadLastStatus");if(-1==e)n.value="Novo contratante",i.value="",a.value="",o.value=1,"COMCAD"==t&&(l.value=2021,r.value=1,s.value=1,c.value=1,d.value=1),m.value=1,p.value=-1,u.value=-1,y.value="",g.value="",E.value="",h.value="",v.value="",C.value="",S.value="",f.value="",I.value="",T.value="",N.value="",b.value="","COMCAD"==t&&(w.innerHTML="",R.setAttribute("src","")),L.innerHTML="",dispatchOnInputChange();else{var A=new XMLHttpRequest,P="action=getCompanyInformation&companyId="+e,B=URL_SA_COMPANY_X;A.open("POST",B,!0),A.setRequestHeader("Content-type","application/x-www-form-urlencoded"),A.onreadystatechange=function(){if(4==A.readyState&&200==A.status){var e=JSON.parse(this.responseText);n.value=e.companyid,i.value=e.companyname,a.value=e.companytaxid,o.value=e.companytype,"COMCAD"==t&&(l.value=e.fiscalyear,r.value=e.ivagroup,s.value=e.irtgroup,c.value=e.iigroup,d.value=e.contabilitystatus),m.value=e.billingcountry,p.value=e.billingprovince,fillSelectMunicipality("selEmpCadBillMunicipality",e.billingprovince,-1,e.billingmunicipality),u.value=e.billingmunicipality,y.value=e.billingcity,g.value=e.billingdistrict,E.value=e.billingcomuna,h.value=e.billingneiborhood,v.value=e.billingstreetname,C.value=e.billingbuildingnumber,S.value=e.billingpostalcode,f.value=e.billingtelephone1,I.value=e.billingtelephone2,T.value=e.billingtelephone3,N.value=e.billingemail,b.value=e.billingwebsite,"COMCAD"==t&&(w.innerHTML=e.logofilename,""!=e.logofilename&&R.setAttribute("src",e.logopath+e.logofilename)),L.innerHTML=("* Cadastrado em: "+e.entrydate+". Actualizado em: "+e.statusdate).toString().italics(),dispatchOnInputChange()}},A.send(P)}i.focus()}class _company{constructor(e,t,n,i,a=-1,o=-1,l="",r=1,s="",c="",d=-1,m="",p=-1,u="",y="",g="",E=2021,h=1,v=1,C=1,S=1,f=1,I=-1,T=-1,N="",b="",w="",R="",L="",A="",P="",B="",x="",M="",_="",D="",O=""){this.companyId=e,this.companyName=t,this.companyTaxId=n,this.companyType=i,this.gmecustomerid=a,this.fundid=o,this.businessline=l,this.systemtype=r,this.personname=s,this.personfunction=c,this.identificationdoc=d,this.identificationnumber=m,this.personnationality=p,this.personphone1=u,this.personphone2=y,this.personemail=g,this.fiscalYear=E,this.ivaGroup=h,this.irtGroup=v,this.iiGroup=C,this.contabilityStatus=S,this.billingCountry=f,this.billingProvince=I,this.billingMunicipality=T,this.billingCity=N,this.billingDistrict=b,this.billingComuna=w,this.billingNeiborhood=R,this.billingStreetName=L,this.billingBuildNumber=A,this.billingPostalCode=P,this.billingPhone1=B,this.billingPhone2=x,this.billingPhone3=M,this.billingEmail=_,this.billingWebsite=D,this.logofilename=O}}function companySaveInfo(e,t=10){var n="",i=!1,a=new _company,o=SYSTEM_USER_STATUS.userId;if(a.companyId=document.getElementById("txtEmpCadCompanyId").value,a.companyName=reviewString(document.getElementById("txtEmpCadOficialDesignation")),""==a.companyName&&(i=!0,n+="Deve indicar o nome da instituição. <br>"),a.companyTaxId=reviewString(document.getElementById("txtEmpCadNIF")),a.companyType=document.getElementById("selEmpCadType").value,"COMCAD"==e&&(a.fiscalYear=document.getElementById("numEmpCadFiscalYear").value,isNaN(a.fiscalYear)&&(i=!0,n+="Deve indicar o ano fiscal da instituição. <br>"),a.ivaGroup=document.getElementById("selEmpCadIvaGroup").value,a.irtGroup=document.getElementById("selEmpCadIrtGroup").value,a.iiGroup=document.getElementById("selEmpCadIIGroup").value,a.contabilityStatus=document.getElementById("selEmpCadContabilityStatus").value),a.billingCountry=document.getElementById("selEmpCadBillCountry").value,a.billingProvince=document.getElementById("selEmpCadBillProvince").value,a.billingMunicipality=document.getElementById("selEmpCadBillMunicipality").value,a.billingCity=reviewString(document.getElementById("txtEmpCadBillCity")),""==a.billingCity&&(i=!0,n+="Deve indicar a cidade da sede da instituição. <br>"),a.billingDistrict=reviewString(document.getElementById("txtEmpCadBillDistrict")),a.billingComuna=reviewString(document.getElementById("txtEmpCadBillComuna")),a.billingNeiborhood=reviewString(document.getElementById("txtEmpCadBillNeiborhood")),a.billingStreetName=reviewString(document.getElementById("txtEmpCadBillStreet")),a.billingBuildNumber=reviewString(document.getElementById("txtEmpCadBillBuidNumber")),a.billingPostalCode=reviewString(document.getElementById("txtEmpCadBillPostal")).replace(/[^0-9\-]/g,""),a.billingPhone1=reviewString(document.getElementById("txtEmpCadTelef1")).replace(/[^0-9]/g,""),a.billingPhone2=reviewString(document.getElementById("txtEmpCadTelef2")).replace(/[^0-9]/g,""),a.billingPhone3=reviewString(document.getElementById("txtEmpCadTelef3")).replace(/[^0-9]/g,""),""==a.billingPhone1&&""==a.billingPhone2&&""==a.billingPhone3&&(i=!0,n+="Deve indicar o telefone da sede da instituição. <br>"),a.billingEmail=reviewEmail(document.getElementById("txtEmpCadEmail").value),""==a.billingEmail?(i=!0,n+="Deve indicar o e-mail da sede da instituição. <br>"):validateEmail(a.billingEmail)||(i=!0,n+="O e-mail da sede está incorreto. <br>"),a.billingWebsite=reviewString(document.getElementById("txtEmpCadWebsite")),"COMCAD"==e&&(a.logofilename=document.getElementById("lbEmpCadNewLogo").innerHTML),1==ST_SA_WAITING_SERVER&&(i=!0,n+="Aguardando resposta do servidor. <br>"),i)return alert(n),!1;showNotification(),ST_SA_WAITING_SERVER=1;var l=new XMLHttpRequest,r="action=saveCompanyInformation&companyInfo="+JSON.stringify(a)+"&sender="+e+"&userId="+o+"&request="+t,s=URL_SA_COMPANY_X;l.open("POST",s,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){4==l.readyState&&200==l.status&&(ST_SA_WAITING_SERVER=0,1==JSON.parse(this.responseText).status?showNotification("Dados da instituição actualizados com sucessos.",1):hideNotification())},l.send(r)}var COMPANY_WHOCALL="";function companyOnLoad(e){COMPANY_WHOCALL=e,showNotification(),checkUserStatusAfterExecute(function(){var t=SYSTEM_USER_STATUS.companyId;selectCountryChange("selEmpCadBillCountry","selEmpCadBillProvince","selEmpCadBillMunicipality","lbEmpCadBillCity"),fillSelectCountry("selEmpCadBillCountry"),fillSelectProvince("selEmpCadBillProvince",-1),fillSelectMunicipality("selEmpCadBillMunicipality",-1,-1),maskInputByPlaceHold("txtEmpCadBillPostal"),maskInputByPlaceHold("txtEmpCadTelef1"),maskInputByPlaceHold("txtEmpCadTelef2"),maskInputByPlaceHold("txtEmpCadTelef3");let n=document.getElementById("selEmpCadBillProvince");n.onclick=function(){fillSelectMunicipality("selEmpCadBillMunicipality",n.value,-1)},companyGetInfo(t,e),hideNotification()})}function companySearchCompany(e,t){var n=document.getElementById("selUdaConProContractorType").value,i=document.getElementById("numUdaConProSearchLimit").value,a=reviewString(document.getElementById("txtUdaConProContractorSearch").value);isNaN(i)&&(i=5);var o=new XMLHttpRequest,l="action=getCompanyListSearch&&companyType="+n+"&&searchLimit="+i+"&&searchTag="+a,r=URL_SA_COMPANY_X;o.open("POST",r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){var n=JSON.parse(this.responseText);n.length<=0&&showNotification("Não encontrado.",0);let a=document.getElementById("tblUdaConProMainTable");a.innerHTML="";var i=0;n.forEach(n=>(function(n){i+=1;let o=JSON.parse(n),l=a.insertRow(-1);l.id="trCompSearRow"+i,l.setAttribute("class","borderGray");let r=l.insertCell(-1);r.setAttribute("class","colRowNumber"),r.innerHTML=i,r.style.width="10px";let s=l.insertCell(-1);s.setAttribute("class","colProductId"),s.innerHTML=o.companyid,l.insertCell(-1).innerHTML=o.companyname,l.insertCell(-1).innerHTML=o.companytaxid;let c=l.insertCell(-1),d=document.createElement("div");d.id="btCompSearView"+i,d.name=o.companyid,d.onclick=function(){"UDACONCAD"==t&&companyContractorNew(-1,d.name),a.innerHTML="",hideParts(e)},c.appendChild(d),c.style.textAlign="center",c.style.height="30px",setTriggerButtonByRowDobleClick(l.id,d.id)})(n))}},o.send(l)}function companyDependencyOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){var e=SYSTEM_USER_STATUS.companyId;fillSelectProvince("selEmpDepProvince",-1,-1,1);const t=document.getElementById("selEmpDepProvince");t.onchange=function(){fillSelectMunicipality("selEmpDepMunicipality",t.value,-1,-1,1)},fillSelectSystemUserBillingUser("selEmpDepCoordinator",2,-1),maskInputByPlaceHold("txtCompDepPhone1"),maskInputByPlaceHold("txtCompDepPhone2"),maskInputByPlaceHold("txtCompDepPhone3"),setAutoCompleteToFiel("txtEmpDepDesignation",3,1),companyDependencyList(e),hideNotification()})}function companyDependencyNew(e){showParts("divCompDepDependencyRegister"),document.getElementById("txtEmpDepDependencyId").value="Nova dependência",document.getElementById("selEmpDepProvince").value=-1,document.getElementById("selEmpDepMunicipality").value=-1,document.getElementById("txtEmpDepDesignation").value="",document.getElementById("selEmpDepCoordinator").value=-1,document.getElementById("selCompDepPrintLayout").value=1,document.getElementById("txtCompDepAddress").value="",document.getElementById("txtCompDepPhone1").value="",document.getElementById("txtCompDepPhone2").value="",document.getElementById("txtCompDepPhone3").value="",document.getElementById("txtCompDepEmail").value="",document.getElementById("txtCompDepWebsite").value="",document.getElementById("txtCompDepFacebook").value="",document.getElementById("txtCompDepWhatsApp").value="",document.getElementById("txtCompDepInvSlogan").value="",document.getElementById("txtEmpDepDesignation").focus,dispatchOnInputChange()}function companyDependencySave(e){var t=new _companyDependency;t.companyid=SYSTEM_USER_STATUS.companyId,t.dependencyid=document.getElementById("txtEmpDepDependencyId").value,t.provinceid=document.getElementById("selEmpDepProvince").value,t.municipalityid=document.getElementById("selEmpDepMunicipality").value,t.designation=reviewString(document.getElementById("txtEmpDepDesignation")),t.coordinatoruser=document.getElementById("selEmpDepCoordinator").value,t.printlayout=document.getElementById("selCompDepPrintLayout").value,t.address=document.getElementById("txtCompDepAddress").value,t.phone1=reviewString(document.getElementById("txtCompDepPhone1")).replace(/[^0-9]/g,""),t.phone2=reviewString(document.getElementById("txtCompDepPhone2")).replace(/[^0-9]/g,""),t.phone3=reviewString(document.getElementById("txtCompDepPhone3")).replace(/[^0-9]/g,""),t.email=reviewEmail(document.getElementById("txtCompDepEmail").value),t.website=document.getElementById("txtCompDepWebsite").value,t.facebook=document.getElementById("txtCompDepFacebook").value,t.whatsapp=reviewString(document.getElementById("txtCompDepWhatsApp")).replace(/[^0-9]/g,""),t.slogan=reviewString(document.getElementById("txtCompDepInvSlogan"));var n=!1,i="";if(Number(t.provinceid)<1&&(n=!0,i="Deve indicar a província onde está localizada a filial. <br>"),Number(t.municipalityid)<1&&(n=!0,i="Deve indicar o município onde está localizada a filial. <br>"),""==t.designation&&(n=!0,i="Deve indicar a designação da filial. <br>"),""==t.address&&(n=!0,i="Deve indicar o endereço do cabeçalho. <br>"),""==t.phone1&&(n=!0,i="Deve indicar pelo menos um telefone. <br>"),""!=t.email&&(validateEmail(t.email)||(n=!0,i="E-mail fora do formato. <br>")),1==ST_SA_WAITING_SERVER&&(n=!0,i+="Aguardando resposta do servidor. <br>"),1==n)return alert(i),!1;showNotification(),ST_SA_WAITING_SERVER=1;var a=new XMLHttpRequest,o="action=saveCompanyDependency&dependencyInfo="+JSON.stringify(t),l=URL_SA_COMPANY_X;a.open("POST",l,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;var e=JSON.parse(a.responseText);1==e.status?(showNotification(e.msg,1),hideParts("divCompDepDependencyRegister"),companyDependencyList(t.companyid)):showNotification(e.msg,0)}},a.send(o)}function companyDependencyList(e){showNotification();var t=new XMLHttpRequest,n="action=getCompanyDependencyList&companyId="+e+"&dependencyId=-1",i=URL_SA_COMPANY_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);t.length<=0?showNotification("Não encontrado.",0):hideDivFilter(),document.getElementById("lbResultOnList").innerHTML=t.length;let i=document.getElementById("tblEmpDepMainTable");i.innerHTML="";var n=0;t.forEach(t=>(function(t){n+=1;let a=JSON.parse(t),o=i.insertRow(-1);o.setAttribute("class","borderGray");let l=o.insertCell(0);l.setAttribute("class","colRowNumber"),l.innerHTML=n,o.insertCell(1).innerHTML=a.province,o.insertCell(2).innerHTML=a.municipality,o.insertCell(3).innerHTML=a.designation,o.insertCell(4).innerHTML=getFirtLastName(a.coordinator)+" ("+a.coordinatoruser+")";let r=o.insertCell(5);r.setAttribute("class","noPrint");var s=document.createElement("button");s.setAttribute("class","labelEdit"),s.type="button",s.name=a.id,s.onclick=function(){showDivFilter(),companyDependecyEdit(e,s.name)},r.appendChild(s);var c=document.createElement("button");c.setAttribute("class","labelDelete"),c.type="button",c.name=a.id,c.onclick=function(){}})(t)),hideNotification()}},t.send(n)}function companyDependecyEdit(e,t){var n=new XMLHttpRequest,i="action=getCompanyDependencyList&companyId="+e+"&dependencyId="+t,a=URL_SA_COMPANY_X;n.open("POST",a,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){var t=JSON.parse(e);showParts("divCompDepDependencyRegister"),document.getElementById("txtEmpDepDependencyId").value=t.id,document.getElementById("selEmpDepProvince").value=t.provinceid,fillSelectMunicipality("selEmpDepMunicipality",t.provinceid,-1,t.municipalityid),document.getElementById("txtEmpDepDesignation").value=t.designation,document.getElementById("selEmpDepCoordinator").value=t.coordinatoruser,document.getElementById("selCompDepPrintLayout").value=t.printlayout,document.getElementById("txtCompDepAddress").value=t.address,document.getElementById("txtCompDepPhone1").value=t.phone1,document.getElementById("txtCompDepPhone2").value=t.phone2,document.getElementById("txtCompDepPhone3").value=t.phone3,document.getElementById("txtCompDepEmail").value=t.email,document.getElementById("txtCompDepWebsite").value=t.website,document.getElementById("txtCompDepFacebook").value=t.facebook,document.getElementById("txtCompDepWhatsApp").value=t.whatsapp,document.getElementById("txtCompDepInvSlogan").value=t.slogan,document.getElementById("txtEmpDepDesignation").focus,dispatchOnInputChange()})(e))}},n.send(i)}function companyDependencyDelete(e,t){showConfirm("Tem a certeza que deseja eliminar esta dependência?",function(){var n=new XMLHttpRequest,i="action=deleteCompanyDependency&dependecyId="+t,a=URL_SA_COMPANY_X;n.open("POST",a,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(showNotification(this.responseText,1),companyDependencyList(e))},n.send(i)})}function companyProvinceOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){var e=SYSTEM_USER_STATUS.companyId;fillSelectProvince("selEmpProProvince"),fillSelectSystemUserBillingUser("selEmpProManager",3,-1),companyProvinceList(e),hideNotification()})}function companyProvinceList(e){showNotification();var t=new XMLHttpRequest,n="action=getCompanyProvinceList&companyId="+e,i=URL_SA_COMPANY_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);t.length<=0?showNotification("Não encontrado.",0):(hideDivFilter(),document.getElementById("btEmpProSave").style.display="none");let i=document.getElementById("tblEmpProMainTable");i.innerHTML="";var n=0;t.forEach(t=>(function(t){n+=1;let a=JSON.parse(t),o=i.insertRow(-1);o.setAttribute("class","borderGray"),2==a.provincetype&&(o.style.fontWeight="bold");let l=o.insertCell(-1);l.setAttribute("class","colRowNumber"),l.innerHTML=n,o.insertCell(-1).innerHTML=a.type,o.insertCell(-1).innerHTML=a.province,o.insertCell(-1).innerHTML=getFirtLastName(a.manager)+" ("+a.manageruser+")";let r=o.insertCell(-1);var s=document.createElement("button");s.setAttribute("class","labelEdit"),s.type="button",s.name=a.id,s.onclick=function(){showDivFilter(),companyProvinceEdit(e,s.name)},r.appendChild(s),r.style.textAlign="center",r.style.width="60px"})(t)),hideNotification()}},t.send(n)}function companyProvinceEdit(e,t){var n=new XMLHttpRequest,i="action=companyProvinceEdit&companyId="+e+"&provinceId="+t,a=URL_SA_COMPANY_X;n.open("POST",a,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){var t=JSON.parse(e);document.getElementById("txtEmpProProvinceId").value=t.id,document.getElementById("selEmpProProvince").value=t.provinceid,document.getElementById("selEmpProManager").value=t.manageruser,document.getElementById("btEmpProSave").style.display="inline"})(e))}},n.send(i)}function companyProvinceSave(e){var t=SYSTEM_USER_STATUS.companyId,n=document.getElementById("txtEmpProProvinceId").value,i=document.getElementById("selEmpProManager").value;showNotification();var a=new XMLHttpRequest,o="action=saveCompanyProvince&provinceId="+n+"&managerUser="+i,l=URL_SA_COMPANY_X;a.open("POST",l,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4==this.readyState&&200==this.status&&(1==a.responseText?(showNotification("Província / região actualizada com sucesso.",1),companyProvinceList(t)):hideNotification())},a.send(o)}function companyHierarchyOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){var e=SYSTEM_USER_STATUS.companyId;setSystemUserBillingProfile(""),fillSelectSystemUserBillingUser("selEmpHierAdministrator",7,-1),fillSelectSystemUserBillingUser("selEmpHierDirectorGeneral",6,-1),document.getElementById("cellEmpHierAdministrator").innerHTML=SYSTEM_USER_BILLING_PROFILE[7],document.getElementById("cellEmpHierDirectorGeneral").innerHTML=SYSTEM_USER_BILLING_PROFILE[6],setTimeout(function(){companyHierarchyList(e)},2e3),hideNotification()})}function companyHierarchyList(e){showNotification();var t=new XMLHttpRequest,n="action=getCompanyHierarchyList&companyId="+e,i=URL_SA_COMPANY_X;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){JSON.parse(this.responseText).forEach(e=>(function(e){let t=JSON.parse(e);7==t.billingprofile&&(document.getElementById("selEmpHierAdministrator").value=t.userid);6==t.billingprofile&&(document.getElementById("selEmpHierDirectorGeneral").value=t.userid)})(e)),hideNotification()}},t.send(n)}function companyHierarchySave(e){showConfirm("Tem a certeza que deseja actualizar a hierarquia administrativa da instituição? <br><br>Todos funcionário serão afectados.",function(){var e=SYSTEM_USER_STATUS.companyId,t=document.getElementById("selEmpHierAdministrator").value,n=document.getElementById("selEmpHierDirectorGeneral").value;showNotification();var i=new XMLHttpRequest,a="action=saveCompanyHierarchy&companyId="+e+"&administratorUser="+t+"&directorGeneralUser="+n,o=URL_SA_COMPANY_X;i.open("POST",o,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){4==this.readyState&&200==this.status&&(1==i.responseText?(showNotification("Hierarqui actualizada com sucesso.",1),companyHierarchyList(e)):hideNotification())},i.send(a)})}function companyContratorOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setCustomerType(""),fillSelectCustomerType("selCliProCustomerType",-1),fillSelectCustomerType("selEmpCadType",-1),fillSelectCustomerType("selUdaConProContractorType",-1),fillSelectFund("selEmpCadFundId"),fillSelectSystemType("selEmpCadSystemType"),companyContractorNew(-1,-1),setAutoCompleteToFiel("txtEmpCadOficialDesignation",0),setAutoCompleteToFiel("txtEmpCadNIF",1),hideNotification()})}function companyContractorNew(e=-1,t=-1){var n=document.getElementById("txtEmpCadCompanyId"),i=document.getElementById("txtEmpCadCustomerId"),a=document.getElementById("txtEmpCadOficialDesignation"),o=document.getElementById("txtEmpCadNIF"),l=document.getElementById("selEmpCadType"),r=document.getElementById("selEmpCadFundId"),s=document.getElementById("selEmpCadSystemType"),c=document.getElementById("btUdaConCadSave");if(-1==t){if(n.value="Novo contratante",i.value=e,a.value="",o.value="",l.value=1,r.value=-1,s.value=1,-1!=e){var d=new XMLHttpRequest,m="action=getCustomerInfo&&customerId="+e,p=URL_SA_CUSTOMER_X;d.open("POST",p,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);l.value=e.customertype,a.value=e.companyname,o.value=e.customertaxid,r.value=e.fundid,s.value=e.systemtype}},d.send(m)}}else{var u=new XMLHttpRequest;m="action=getCompanyInformation&companyId="+t,p=URL_SA_COMPANY_X;u.open("POST",p,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.onreadystatechange=function(){if(4==u.readyState&&200==u.status){var e=JSON.parse(u.responseText);n.value=e.companyid,i.value=e.gmecustomerid,a.value=e.companyname,o.value=e.companytaxid,l.value=e.companytype,r.value=e.fundid,s.value=e.systemtype}},u.send(m)}c.style.display=-1==t&&-1==e?"none":"inline"}function companyContractorSaveInfo(e,t=10){var n="",i=!1,a=SYSTEM_USER_STATUS.userId,o=new _company;if(o.companyId=document.getElementById("txtEmpCadCompanyId").value,o.gmecustomerid=document.getElementById("txtEmpCadCustomerId").value,o.companyName=reviewString(document.getElementById("txtEmpCadOficialDesignation")).toUpperCase(),""==o.companyName&&(i=!0,n+="Deve indicar o nome do contratante. <br>"),o.companyTaxId=reviewString(document.getElementById("txtEmpCadNIF")),""==o.companyTaxId&&(i=!0,n+="Deve indicar o NIF. <br>"),o.companyType=document.getElementById("selEmpCadType").value,Number(o.companyType)<=0&&(i=!0,n+="Deve indicar o tipo de contratante. <br>"),o.fundid=document.getElementById("selEmpCadFundId").value,Number(o.fundid)<=0&&(i=!0,n+="Deve indicar um fundo de apoio. <br>"),o.systemtype=document.getElementById("selEmpCadSystemType").value,Number(o.systemtype)<=0&&(i=!0,n+="Deve indicar o tipo de sistema. <br>"),i)return alert(n),!1;showNotification();var l=new XMLHttpRequest,r="action=saveCompanyInformation&companyInfo="+JSON.stringify(o)+"&sender="+e+"&userId="+a+"&request="+t,s=URL_SA_COMPANY_X;l.open("POST",s,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){var e=JSON.parse(this.responseText);1==e.status?(showNotification("Dados do contratante actualizados com sucessos.",1),companyContractorNew(-1,-1),setAutoCompleteToFiel("txtUdaConProContractorSearch",0),setAutoCompleteToFiel("txtEmpCadOficialDesignation",0),setAutoCompleteToFiel("txtEmpCadNIF",1)):(showNotification(e.msg,0),hideNotification())}},l.send(r)}function companyListOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setCustomerType(""),fillSelectCustomerType("selUdaConLisType",-1),fillSelectFund("selUdaConLisFundId",-1),fillSelectSystemType("selUdaConLisSystemType",-1),hideNotification()})}function companyListDetails(e){try{var t=document.getElementById("txtUdaConLisInitialDate").value,n=document.getElementById("txtUdaConLisEndDate").value,i=document.getElementById("selUdaConLisType").value,a=document.getElementById("selUdaConLisFundId").value,o=document.getElementById("selUdaConLisSystemType").value,l=new Date(t),r=new Date(n);if(l.getTime()>r.getTime())return showNotification("Date inicial não pode ser superior a data final.",0),!1;showNotification();var s=new XMLHttpRequest,c="action=getCompanyListDetails&initialDate="+t+"&endDate="+n+"&contratorType="+i+"&fund="+a+"&systemType="+o,d=URL_SA_COMPANY_X;s.open("POST",d,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var e=JSON.parse(this.responseText);e.length<=0?showNotification("Não encontrado",0):hideDivFilter();var t={},n={},i={},a={};let s=document.getElementById("tblUdaConLisDetailsTable");s.innerHTML="";var o=0,l=0;function r(e,t,n){t in e?e[t].amount=Number(e[t].amount)+Number(n):e[t]={desigination:t,amount:n}}e.forEach(e=>(function(e){let c=JSON.parse(e);var d=getFirtLastName(c.operatorName)+" ("+c.entryuser+")",m=CUSTOMER_TYPE[c.companytype],p=c.fund,u=SYSTEM_TYPES[c.systemtype];l+=1,r(t,d,1),r(n,m,1),r(i,p,1),r(a,u,1),o+=1;let y=s.insertRow(-1);y.setAttribute("class","borderGray");let g=y.insertCell(y.cells.length);g.setAttribute("class","colRowNumber"),g.innerHTML=o;let E=y.insertCell(y.cells.length);E.style.textAlign="center",E.setAttribute("class","colProductId"),E.innerHTML=c.companyid;let h=y.insertCell(y.cells.length);h.setAttribute("class","colDescription"),h.innerHTML=c.companyname;let v=y.insertCell(y.cells.length);v.setAttribute("class","colProductId"),v.innerHTML=c.companytaxid,y.insertCell(y.cells.length).innerHTML=m,y.insertCell(y.cells.length).innerHTML=p,y.insertCell(y.cells.length).innerHTML=u,y.insertCell(y.cells.length).innerHTML=d;let C=y.insertCell(y.cells.length);C.style.textAlign="center",C.setAttribute("class","colNoWrap"),C.innerHTML=setLocalDate(c.entrydate,10)})(e));let g=s.insertRow(-1);g.setAttribute("class","borderGray"),g.style.fontSize="large";let E=g.insertCell(g.cells.length);E.setAttribute("colspan","8"),E.style.textAlign="center",E.innerHTML="TOTAL".bold();let h=g.insertCell(g.cells.length);h.style.textAlign="right",h.style.paddingRight="5px",h.innerHTML=formatNumber(l).bold();var c=[["Tipo de conta","Total"]],d=[["Fundo de apoio","Total"]],m=[["Tipo de sistema","Total"]],p=document.getElementById("tblUdaConLisResumeTable");for(var u in p.innerHTML="",o=0,t)y("Cadastrante",t,u);for(var u in o=0,n)c.push([n[u].desigination,Math.abs(n[u].amount)]),y("Tipo de contratante",n,u);for(var u in o=0,i)d.push([i[u].desigination,Math.abs(i[u].amount)]),y("Fundo de apoio",i,u);for(var u in o=0,a)m.push([a[u].desigination,Math.abs(a[u].amount)]),y("Tipo",a,u);function y(e,t,n){o+=1;let i=p.insertRow(-1);i.setAttribute("class","borderGray");let a=i.insertCell(0);a.setAttribute("class","colRowNumber"),a.innerHTML=o;let l=i.insertCell(1);var r="";1==o&&(r=e,i.style.backgroundColor="rgba(231,249,255)"),l.innerHTML=r.bold();let s=i.insertCell(2);var c=t[n].desigination;""==c&&(c="Não indicado"),s.innerHTML=c;let d=i.insertCell(3);d.style.textAlign="right",d.style.paddingRight="5px",d.innerHTML=formatNumber(t[n].amount)}hideNotification(),saleReportCreateGraphic(c,"divUdaConLisTypeChart","Gráfico de tipo de contratante"),saleReportCreateGraphic(d,"divUdaConLisFundChart","Gráfico do fundo de apoio"),saleReportCreateGraphic(m,"divUdaConLisSystemTypeChart","Gráfico do tipo de sistema")}},s.send(c)}catch(e){showNotification(e.message,0)}}function companyPartnershipOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){SYSTEM_USER_STATUS.companyId,fillSelectSystemUserBillingUser("selEmpEstSocPartner",8,-1),companyPartnershipList(""),setTriggerButtonByText("selEmpEstSocPartner","btEmpEstSocAddPartner"),hideNotification()})}var COMPANY_PARTNERSHIP_PARTNERS=[];function companyPartnershipList(e){showNotification(),COMPANY_PARTNERSHIP_PARTNERS=[];var t=SYSTEM_USER_STATUS.companyId,n=new XMLHttpRequest,i="action=getCompanyPartnershipList&companyId="+t,a=URL_SA_COMPANY_X;n.open("POST",a,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);e.length<=0&&showNotification("Percentagens não encontrado.",0),document.getElementById("tblEmpEstSocMainTable").innerHTML="",e.forEach(e=>(function(e){companyPartnershipAddSingleLine(JSON.parse(e))})(e)),companyPartnershipRecalculateTotal(""),hideNotification()}},n.send(i)}function companyPartnershipAddSingleLine(e){let t=document.getElementById("tblEmpEstSocMainTable");var n=t.rows.length+1;let i=t.insertRow(-1);i.id="rowEmpEstSocPartner"+n,i.setAttribute("class","borderGray");let a=i.insertCell(i.cells.length);a.setAttribute("class","colRowNumber"),a.innerHTML=n,i.insertCell(i.cells.length).innerHTML=e.userfullname;let o=i.insertCell(i.cells.length),l=document.createElement("input");l.type="number",l.id="numEmpEstSocPartnerPerc"+n,l.min=0,l.value=Number(e.percentage).toFixed(2),l.max=100,l.step="any",l.onchange=function(){companyPartnershipRecaculateLine(n)},o.appendChild(l),o.style.textAlign="center",o.style.width="60px";let r=i.insertCell(i.cells.length);r.setAttribute("class","noPrint");var s=document.createElement("button");s.setAttribute("class","labelRemove"),s.type="button",s.name=n,s.onclick=function(){companyPartnershipRemoveLine(n)},r.appendChild(s),COMPANY_PARTNERSHIP_PARTNERS[Number(n-1)]=e}function companyPartnershipAddPartner(e){var t=document.getElementById("selEmpEstSocPartner"),n=t.value,i=t.options[t.selectedIndex].text;return Number(n)<=0?(showNotification("Deve indicar um sócio.",0),!1):companyPartnershipCheckPartnerOnLines(n)?(showNotification("Sócio já adicionado",0),!1):(companyPartnershipAddSingleLine({partnershipid:0,partnerid:n,userfullname:i,percentage:0,status:1}),void companyPartnershipRecalculateTotal(""))}function companyPartnershipCheckPartnerOnLines(e){var t=!1;return COMPANY_PARTNERSHIP_PARTNERS.forEach(n=>(function(n){if(n.partnerid==e&&1==n.status)return t=!0,!0})(n)),t}function companyPartnershipRecalculateTotal(e){var t=0;COMPANY_PARTNERSHIP_PARTNERS.forEach(e=>(function(e){1==e.status&&(t+=Number(e.percentage))})(e));var n=document.getElementById("lbEmpEstSocTotalPercentage");return n.innerHTML=formatNumber(t),100!=t?(n.style.color="red",showNotification("O total das percentagem de ser igual a 100.",0),!1):(n.style.color="black",!0)}function companyPartnershipRemoveLine(e){document.getElementById("rowEmpEstSocPartner"+e).innerHTML="",COMPANY_PARTNERSHIP_PARTNERS[Number(e)-1].status=0,companyPartnershipRecalculateTotal("")}function companyPartnershipRecaculateLine(e){try{var t=document.getElementById("numEmpEstSocPartnerPerc"+e),n=t.value;isNaN(n)&&(n=0),n<0&&(n=0),n>100&&(n=100),COMPANY_PARTNERSHIP_PARTNERS[Number(e)-1].percentage=n,t.value=n,companyPartnershipRecalculateTotal("")}catch(e){showNotification(e.message,0)}}function companyPartnershipSave(e){try{if(1==companyPartnershipRecalculateTotal("")){showConfirm("Tem a certeza que deseja guardar esta estrutura societária?",function(){var e="&companyId="+SYSTEM_USER_STATUS.companyId;e+="&partners={";var t=0;COMPANY_PARTNERSHIP_PARTNERS.forEach(n=>(function(n){0!=n.status&&(0!=t&&(e+=","),e+='"'+t+'":'+JSON.stringify(n),t+=1)})(n)),e+="}",showNotification();var n=new XMLHttpRequest,i="action=saveCompanyPartnership"+e;e=URL_SA_COMPANY_X,n.open("POST",e,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(n.responseText);1==e.status?(showNotification(e.msg,1),companyPartnershipList("")):showNotification(e.msg,0)}},n.send(i)})}}catch(e){showNotification(e.message,0)}}function indexRequestOnLoad(e){setCustomerType(),fillSelectCustomerType("selIndReqCompanyType"),fillSelectProvince("selIndReqBillProvince",-1),fillSelectMunicipality("selIndReqBillMunicipality",-1,-1),document.getElementById("selIndReqBillProvince").onchange=function(){fillSelectMunicipality("selIndReqBillMunicipality",this.value,-1)},maskInputByPlaceHold("txtIndReqPhone1"),indexRequestCheckCart()}function indexRequestCheckCart(){for(var e=getCookie("silicawebcart").toString().split("-/-"),t="* ",n=0;n<e.length;n++){var i=e[n].toString();Number(i)>0&&(t+=i+", ")}var a=document.getElementById("lbIndReqInCart");a.innerHTML=t,setTimeout(function(){a.style.display="none"},5e3)}function indexRequestSaveCompany(){var e=!1,t="",n=new _company;n.companyId=sessionStorage.getItem("silicawebIndReqCompanyId"),n.companyName=reviewString(document.getElementById("txtIndReqOficialDenomination")).toUpperCase(),n.companyTaxId=reviewString(document.getElementById("txtIndReqTaxId")),n.companyType=document.getElementById("selIndReqCompanyType").value,n.businessline=document.getElementById("selIndReqBusinessLine").value,n.billingProvince=Number(document.getElementById("selIndReqBillProvince").value),n.billingMunicipality=Number(document.getElementById("selIndReqBillMunicipality").value),n.billingEmail=document.getElementById("txtIndReqUserEmail").value;var i=getCookie("recomendationUser");if(isNaN(i)&&(i=-1),""==n.companyName&&(e=!0,t+="Deve indicar o nome da organização. <br>"),""==n.companyTaxId?(e=!0,t+="Deve indicar o NIF da organização. <br>"):validateTaxId(n.companyTaxId)||(e=!0,t+="NIF fora do formato. <br>"),(isNaN(n.billingProvince)||n.billingProvince<=0)&&(e=!0,t+="Deve indicar a província onde está localizada a organização. <br>"),(isNaN(n.billingMunicipality)||n.billingMunicipality<=0)&&(e=!0,t+="Deve indicar o município onde está localizada a organização. <br>"),e)return alert(t),!1;showNotification();var a=new XMLHttpRequest,o="action=saveCompanySelfRegist&companyInfo="+JSON.stringify(n)+"&silicaUser="+i,l=URL_SA_COMPANY_X;a.open("POST",l,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=JSON.parse(this.responseText);if(1==e.status){showNotification(e.msg,1);var t=getCookie("silicawebcart");if(null!=t&&""!=t){var o=e.cid,l=document.getElementById("txtIndReqUserEmail").value,r=t.split("-/-");indexRequestOpenOrder(i,o,r,n.companyName,l)}setTimeout(function(){window.location.assign("index.php?req=newlic")},3e3)}else hideNotification()}},a.send(o)}function indexRequestOpenOrder(e,t,n,i="",a=""){try{SYSTEM_USER_STATUS.taxGroup=2,SYSTEM_USER_STATUS.userId=e,SYSTEM_USER_STATUS.managerUser=e,SYSTEM_USER_STATUS.companyId=5e3,SYSTEM_USER_STATUS.workplaceId=2,invoiceSetNew(5,20,"PRECADCAD"),INVOICE_NEW.customerId=t,INVOICE_NEW.expeditiondate=setLocalDate(new Date,16),INVOICE_NEW.extraNote="NOTA: Após pagamento, por favor enviar o comprovativo para cc@silicaweb.ao, ou para WhatsApp 993700757. Indicar o número da encomenda.";var o="0";n.forEach(e=>(function(e){""!=e&&(isNaN(e)||(o+=", "+e))})(e)),showNotification(o);var l=new XMLHttpRequest,r="action=getProductFullDescription&companyId=5000&productId="+o+"&isNote=0&isList=1&workplaceId=0",s=URL_SA_INVOICE_X;l.open("POST",s,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText),t=0;e.forEach(e=>(function(e){t+=1;let n=JSON.parse(e);invoiceAddSingleLine(n,"",9999,t,0,-1)})(e)),invoiceSaveDocument("PRECADCAD",1,"GM Empreendimentos, Lda",i,a)}},l.send(r)}catch(e){showNotification(e.message,0)}}function indexRequestReNewLicenseLoad(e){setCustomerType(),indexRequestReNewLicenseStartInvoice(),indexRequestCheckCart()}function indexRequestReNewLicenseStartInvoice(){var e=getCookie("renewLicenseNUS");function t(){document.getElementById("lbIndReqReNewMessage").innerHTML="Não foi possível gerar a nota de encomenda. <br>Tente novamente a partir do sistema. <br>Se a situação persistir, entre em contacto com os serviços de apoio ao Sílica."}if(null==e?e=0:""==e?e=0:isNaN(e)&&(e=0),e<=0)return t(),!1;showNotification();var n=new XMLHttpRequest,i="action=getCompanyCustomerIdByContract&contractorId="+e,a=URL_SA_COMPANY_X;n.open("POST",a,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status)try{var e=JSON.parse(this.responseText);if(1==e.status){var i=getCookie("silicawebcart");if(null!=i&&""!=i){var a=e.customerid,o=e.entryUser,l=e.companyname,r=e.email;indexRequestOpenOrder(o,a,i.split("-/-"),l,r)}}else t(),hideNotification()}catch(e){t(),hideNotification()}},n.send(i)}function companyLicenseAssignedOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setLicenseStatus(""),companyLicenseAssignedList(""),hideNotification()})}function companyLicenseAssignedList(e){var t=SYSTEM_USER_STATUS.companyId;showNotification();var n=new XMLHttpRequest,i="action=getLicenseAssignedList&companyId="+t,a=URL_SA_LICENSE_X;n.open("POST",a,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);let n=document.getElementById("tblCompLicAssMainTable");n.innerHTML="";var t=0;e.forEach(e=>(function(e){t+=1;let i=JSON.parse(e);var a=Number(i.status);let o=n.insertRow(-1);o.setAttribute("class","borderGray"),-1==a?o.style.color="red":0==a?o.style.color="rgb(72,0,0)":1==a&&(o.style.fontWeight="bold");let l=o.insertCell(0);l.setAttribute("class","colRowNumber"),l.innerHTML=t;let r=o.insertCell(1);r.setAttribute("class","colProductId"),r.innerHTML=i.id,o.insertCell(2).innerHTML=i.companyname,o.insertCell(3).innerHTML=i.invoicenumber,o.insertCell(4).innerHTML=i.licensetype;let s=o.insertCell(5);s.style.textAlign="center",s.innerHTML=LICENSE_STATUS[a];let c=o.insertCell(6);c.style.textAlign="center",c.innerHTML=i.enddate})(e)),hideNotification()}},n.send(i)}function gmeFrontAccessOnLoad(){showNotification(),checkUserStatusAfterExecute(function(){gmeFrontAccessList(),hideNotification()})}function gmeFrontAccessList(){try{var e=document.getElementById("txtGmeFrontAccInitialDate").value,t=document.getElementById("txtGmeFrontAccEndDate").value;showNotification();var n=new XMLHttpRequest,i="action=getGmeFrontAccess&initialDate="+e+"&endDate="+t,a=URL_SA_COMPANY_X;n.open("POST",a,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e={},t={},i={},a=JSON.parse(this.responseText);a.length<=0&&showNotification("Não encontrado.",0);var o=0;a.forEach(n=>(function(n){let a=JSON.parse(n);var o=getFirtLastName(a.operatorName)+" ["+a.recomendationuser+"]",l=(s=a.socialnetwork,"fb"==s?"Facebook":"wa"==s?"WhatsApp":"li"==s?"LinkedIn":"ig"==s?"Instagram":s),r=o+" / "+l;var s;addAmountResume(e,o,1),addAmountResume(t,l,1),addAmountResume(i,r,1)})(n));var l=[["Operador","Total"]],r=[["Rede social","Total"]],s=document.getElementById("tblCLILISResumeTable");for(var c in s.innerHTML="",o=0,e)o+=1,l.push([e[c].desigination,Math.abs(e[c].amount)]),resume(s,o,"Operador",e,c,"Acessos");for(var c in o=0,t)o+=1,r.push([t[c].desigination,Math.abs(t[c].amount)]),resume(s,o,"Rede social",t,c,"Acessos");for(var c in o=0,i)o+=1,resume(s,o,"Operador / Rede social",i,c,"Acessos");saleReportCreateGraphic(l,"divGmeFrontAccUserChart","Gráfico de acessos por operador"),saleReportCreateGraphic(r,"divGmeFrontAccSocialChart","Gráfico de acesso por rede social"),hideNotification()}},n.send(i)}catch(e){showNotification(e.message,0)}}var COMPANY_WORK_SCHEDULE_LIST=[];function companyWorkScheduleOnLoad(){try{showNotification(),checkUserStatusAfterExecute(function(){setConsumerTypeAqua(),fillSelectDependencyFull("selComWorSchDependency",-1,1),hideNotification()})}catch(e){showNotification(e.message,0)}}function companyWorkScheduleList(){var e=document.getElementById("tblComWorSchListTable");e.innerHTML="";var t={};if(t.companyId=SYSTEM_USER_STATUS.companyId,t.dependencyId=getElementValue("selComWorSchDependency"),COMPANY_WORK_SCHEDULE_LIST=[],t.dependencyId<=0)return alert("Deve indicar uma filial."),!1;showNotification();var n=new XMLHttpRequest,i="action=getCompanyWorkScheduleList&filterInfo="+JSON.stringify(t),a=URL_SA_COMPANY_X;n.open("POST",a,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){try{var t=JSON.parse(this.responseText)}catch(e){showHttpResponseText(n)}for(var i=0,a=0;a<t.length;a++){var o=t[a];let n=JSON.parse(o);COMPANY_WORK_SCHEDULE_LIST[i]=n,i+=1;let l=e.insertRow(-1);l.id="trCompWorSchList"+n.id,l.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_COMPANY_WORK_SCHEDULE_LIST",l.id)),0!=n.weekday&&6!=n.weekday||(l.style.color="orange");let r=l.insertCell(-1);r.setAttribute("class","colRowNumber"),r.innerHTML=i,l.insertCell(-1).innerHTML=n.designation+" ["+n.dependencyid+"]",l.insertCell(-1).innerHTML=weekDay(n.weekday);let s=l.insertCell(-1),c=document.createElement("input");c.type="time",c.value=getTimeOnDate(n.starttime);let d=i;c.onchange=function(){companyWorkScheduleOnChange(d,"starttime",this)},s.appendChild(c);let m=l.insertCell(-1),p=document.createElement("input");p.type="time",p.value=getTimeOnDate(n.endtime),p.onchange=function(){companyWorkScheduleOnChange(d,"endtime",this)},m.appendChild(p),setElementValue("rangeComWorSchUseWorkSchedule",n.useworkschedule)}hideNotification()}},n.send(i)}function companyWorkScheduleOnChange(e,t,n){var i="2021-01-01 "+n.value;if(!validateDate(new Date(i)))return showNotification("Deve indicar um horário válido"),!1;COMPANY_WORK_SCHEDULE_LIST[Number(e-1)][t]=i}function companyWorkScheduleSave(){if(COMPANY_WORK_SCHEDULE_LIST.length<=0)return alert("Lista vazia."),!1;if(1==ST_SA_WAITING_SERVER)return alert("Aguardando resposta do servidor. <br>"),!1;var e="&scheduleInfo={",t=0;COMPANY_WORK_SCHEDULE_LIST.forEach(n=>(function(n){0!=t&&(e+=",");e+='"'+t+'":'+JSON.stringify(n),t+=1})(n)),e+="}",e+="&useWorkSchedule="+getElementValue("rangeComWorSchUseWorkSchedule"),showNotification(),ST_SA_WAITING_SERVER=1;var n=new XMLHttpRequest,i="action=saveCompanyWorkSchedule"+e;e=URL_SA_COMPANY_X;n.open("POST",e,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){ST_SA_WAITING_SERVER=0;try{var e=JSON.parse(this.responseText)}catch(e){showHttpResponseText(n)}1==e.status?(showNotification(e.msg,1),document.getElementById("selComWorSchDependency").dispatchEvent(new Event("change"))):showNotification(e.msg,0)}},n.send(i)}