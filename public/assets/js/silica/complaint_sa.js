class _complaint{constructor(e="NOVA*",t=0,n=0,a="2021-01-01",o="",i="",l="",s="",r="",c="",m="",p=1,d=0,u=10,C=-1){this.id=e,this.companyid=t,this.dependencyid=n,this.complaintdate=a,this.reference=o,this.category=i,this.type=l,this.treatment=s,this.complaintsource=r,this.customerid=c,this.details=m,this.complaintstatus=p,this.statususer=d,this.request=u,this.nextStatus=C}}function complaintRegisterOnLoad(){checkUserStatusAfterExecute(function(){fillSelectComplaintStatus("selComplRegComplaintStatus")})}function complaintNewComplaint(e){showParts("divComplaintDetails"),complaintGetComplaintDetails(-1,e)}function complaintEditComplaint(e){showParts("divComplaintDetails"),complaintGetComplaintDetails(e)}function complaintGetComplaintDetails(e,t=null){const n=document.getElementById("h2ComplRegHeaderTitle"),a=document.getElementById("txtComplRegComplaintId"),o=document.getElementById("txtComplRegComplaintDate"),i=document.getElementById("txtComplRegReference"),l=document.getElementById("selComplRegComplaintStatus"),s=document.getElementById("txtComplRegCategory"),r=document.getElementById("txtComplRegType"),c=document.getElementById("txtComplRegDetails"),m=document.getElementById("txtComplRegTreatment"),p=document.getElementById("selComplRegComplaintSource"),d=document.getElementById("txtComplRegCustomerId"),u=document.getElementById("txtComplRegCustomerName"),C=document.getElementById("txtComplRegPhone"),g=document.getElementById("lbComplRegUpdateBy");if(showParts("btComplRegSave",!0),hideParts("btComplRegCancel"),hideParts("btComplRegApprove"),-1==e){var S=new Date;n.innerHTML="Nova reclamação",a.value="NOVA*",o.value=setLocalDate(S,10),i.value="",l.value=1,s.value="",r.value="",c.value="",m.value="",p.value="",d.value=t.customerid,u.value=t.companyname,C.value=t.telephone1+" / "+t.telephone2+" / "+t.telephone3,g.innerHTML="Data de actualizaçao: "+setLocalDate(S,16)}else{n.innerHTML="DETALHES da reclamação";var T=new XMLHttpRequest,I="action=getComplaintDetails&complaintId="+e,R=URL_SA_COMPLAINT_X;T.open("POST",R,!0),T.setRequestHeader("Content-type","application/x-www-form-urlencoded"),T.onreadystatechange=function(){if(4==T.readyState&&200==T.status){var e=JSON.parse(this.responseText);a.value=e.id,o.value=setLocalDate(e.complaintdate,10),i.value=e.reference,l.value=e.complaintstatus,s.value=e.category,r.value=e.type,c.value=e.details,m.value=e.treatment,p.value=e.complaintsource,d.value=e.customerid,u.value=e.companyname,C.value=e.telephone1+" / "+e.telephone2+" / "+e.telephone3,g.innerHTML="Cadastrado por "+getOperatorName(e.operatorEntry,e.entryuser)+" em "+setLocalDate(e.entrydate,16)+". <br>Actualizado por "+getOperatorName(e.operatorName,e.statususer)+" em "+setLocalDate(e.statusdate,16);var t=e.complaintstatus;3==t&&hideParts("btComplRegSave"),checkPermission("3302")&&3!=t&&showParts("btComplRegCancel",!0),checkPermission("3301")&&1==t&&showParts("btComplRegApprove",!0)}},T.send(I)}setAutoCompleteToFiel(i.id,66,1),setAutoCompleteToFiel(s.id,67,1),setAutoCompleteToFiel(r.id,68,1),setAutoCompleteToFiel(c.id,69,1),setAutoCompleteToFiel(m.id,70,1),dispatchOnInputChange()}function complaintRegisterSave(e=-1){var t=!1,n="",a=new _complaint;if(a.id=getElementValue("txtComplRegComplaintId"),a.companyid=SYSTEM_USER_STATUS.companyId,a.dependencyid=SYSTEM_USER_STATUS.workplaceId,a.complaintdate=getElementValue("txtComplRegComplaintDate"),a.reference=reviewString(document.getElementById("txtComplRegReference")).toUpperCase(),a.category=reviewString(document.getElementById("txtComplRegCategory")).toUpperCase(),a.type=reviewString(document.getElementById("txtComplRegType")).toUpperCase(),a.treatment=reviewString(document.getElementById("txtComplRegTreatment")).toUpperCase(),a.complaintsource=getElementValue("selComplRegComplaintSource"),a.customerid=getElementValue("txtComplRegCustomerId"),a.details=reviewString(document.getElementById("txtComplRegDetails")).toUpperCase(),a.complaintstatus=getElementValue("selComplRegComplaintStatus"),a.statususer=SYSTEM_USER_STATUS.userId,a.nextStatus=e,validateDate(new Date(a.complaintdate))||(t=!0,n+="Data da reclamação fora do formato. <br>"),""==a.reference&&(t=!0,n+="Deve indicar a referência. <br>"),""==a.customerid&&(t=!0,n+="Deve indicar o cliente. <br>"),1==ST_SA_WAITING_SERVER&&(t=!0,n+="Aguardando resposta do servidor. <br>"),t)return alert(n),!1;showNotification(),ST_SA_WAITING_SERVER=1;var o=new XMLHttpRequest,i="action=saveComplaintRegister&complaintInfo="+JSON.stringify(a),l=URL_SA_COMPLAINT_X;o.open("POST",l,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ST_SA_WAITING_SERVER=0;try{var e=JSON.parse(o.responseText)}catch(e){showHttpResponseText(o)}1==e.status?(showNotification(e.msg,1),complaintListDetails(a.customerid),hideParts("divComplaintDetails")):showNotification(e.msg,0)}},o.send(i)}function complaintListOnLoad(){try{showNotification(),checkUserStatusAfterExecute(function(){setComplaintStatus(),fillSelectDependencyFull("selComplLisDependency",-1,1),setTriggerButtonByText("txtComplLisInitialDate","btComplLisViewAll"),setTriggerButtonByText("txtComplLisEndDate","btComplLisViewAll"),document.getElementById("chbComplLisShowDate").onclick=function(){setEnableDisableByCheckBox(this.id,"txtComplLisInitialDate","txtComplLisEndDate")},checkPermission("3301")?showParts("btContrLisNewContract",!0):hideParts("btContrLisNewContract"),complaintListDetails(),hideNotification()})}catch(e){showNotification(e.message,0)}}function complaintListDetails(e=-1,t=-1){if(1==ST_SA_LISTING_SERVER)return showNotification("Procurando...",1),!1;var n={};if(n.companyId=SYSTEM_USER_STATUS.companyId,n.dependencyId=getElementValue("selComplLisDependency"),n.dependencyId<=0&&Number(SYSTEM_USER_STATUS.billingprofile)<BILLING_PROFILE_PARTNER_INDEX)return showNotification("Seleccionar uma filial.",0),!1;n.filterByDate=getElementChecked("chbComplLisShowDate"),n.initialDate=getElementValue("txtComplLisInitialDate"),n.endDate=getElementValue("txtComplLisEndDate"),n.customerid=e,n.userId=t,n.onlynumber=1,n.startIdx=0,n.endIdx=0,showNotification(),ST_SA_LISTING_SERVER=1;var a=new XMLHttpRequest,o="action=getComplaintListDetails&filterInfo="+JSON.stringify(n),i=URL_SA_COMPLAINT_X;a.open("POST",i,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){ST_SA_LISTING_SERVER=0;try{var e=JSON.parse(this.responseText)}catch(e){showHttpResponseText(a)}var t=Number(e.n);t<=0?showNotification("Não encontrado.",0):hideDivFilter();var o=document.getElementById("numResultPageNumber"),i=document.getElementById("numResultItems");function l(){var e=Number(o.value),a=Number(i.value),l=(e-1)*a,s=l+a;s>t&&(s=t),n.totalItems=t,n.startIdx=l,n.endIdx=s,n.onlynumber=0,complaintListFilter(n)}o.value=1,setResultTotalPages(o.id,i.id,t),o.onchange=function(){l()},i.onchange=function(){setResultTotalPages(o.id,i.id,t),l()},setElementInnerHtml("lbResultOnList",t),l()}},a.send(o)}function complaintListFilter(e){try{showNotification();var t=document.getElementById("tblComplLisMainTable");t.innerHTML="";var n=new XMLHttpRequest,a="action=getComplaintListDetails&filterInfo="+JSON.stringify(e),o=URL_SA_COMPLAINT_X;n.open("POST",o,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){ST_SA_LISTING_SERVER=0;var a=JSON.parse(this.responseText);setElementInnerHtml("lbResultOnList",e.endIdx+" / "+e.totalItems);for(var o=e.startIdx,i=0;i<a.length;i++){var l=a[i];let e=JSON.parse(l);var s=COMPLAINT_STATUS[Number(e.complaintstatus)],r=getOperatorName(e.operatorName,e.statususer);o+=1;let n=t.insertRow(-1);n.id="trComplList"+e.id,n.setAttribute("class","borderGray"+setSelectedRowBackground("SELECTED_ROW_COMPLAINT_LIST",n.id));let d=n.insertCell(-1);d.setAttribute("class","colRowNumber"),d.innerHTML=o;let u=n.insertCell(-1);u.setAttribute("class","colProductId"),u.innerHTML=e.id;let C=n.insertCell(-1);C.setAttribute("class","colProductId"),C.innerHTML=setLocalDate(e.complaintdate,10),n.insertCell(-1).innerHTML=e.reference,n.insertCell(-1).innerHTML=e.category,n.insertCell(-1).innerHTML=e.type,n.insertCell(-1).innerHTML=e.companyname+" ["+e.customerid+"]";var c="black",m="c ",p=e.complaintstatus;2==p?m="textUpperUcase textBold":3==p&&(c="red");let g=n.insertCell(-1);g.setAttribute("class",m),g.innerHTML=s,g.style.color=c;let S=n.insertCell(-1);S.setAttribute("class","colProductId"),S.innerHTML=setLocalDate(e.statusdate,16);let T=n.insertCell(-1);T.setAttribute("class","colProductId"),T.innerHTML=r;let I=n.insertCell(-1);I.setAttribute("class","noPrint");let R=document.createElement("button");R.type="button",R.setAttribute("class","labelDetail");const y=e.id;R.onclick=function(){complaintEditComplaint(y),setSelectedRowOnClick(n,"SELECTED_ROW_COMPLAINT_LIST")},I.appendChild(R);let h=document.createElement("button");h.setAttribute("class","labelPrint"),h.type="button",h.onclick=function(){setSelectedRowOnClick(n,"SELECTED_ROW_COMPLAINT_LIST"),sessionStorage.setItem("complaint_to_print",JSON.stringify(e)),window.open("printComplaintLayoutA4.php")},I.appendChild(h)}hideNotification()}},n.send(a)}catch(e){showNotification(e.message,0)}}