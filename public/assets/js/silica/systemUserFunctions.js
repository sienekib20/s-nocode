class _user{constructor(e,t,n,s,i=1,a=-1,r="",l=-1,o=-1,d=-1,c=-1,u="",m=0){this.uId=e,this.uFullName=t,this.uName=n,this.email=s,this.accountstatus=i,this.uTle=a,this.uTleSign=r,this.bProfile=l,this.pLevel=d,this.workplaceid=o,this.companyId=c,this.photo=u,this.sourceid=m}}var SYSTEM_USER_TITLE=[],SYSTEM_USER_WHO_CALL="UTIINFO",SYSTEM_USER_TARGET="",SYSTEM_USER_PERMISSIN_LIST=[];function systemUserOnLoad(e){SYSTEM_USER_WHO_CALL=e,showNotification(),checkUserStatusAfterExecute(function(){var t="UTIINFO"==e?SYSTEM_USER_STATUS.userId:-1;setSystemUserBillingProfile(""),fillSelectSystemUserTitle("selUtiCadTitle"),fillSelectSystemUserBillingProfile("selUtiCadBillingprofile"),fillSelectSystemUserPermissionLevel("selUtiCadPermissionLevel"),fillSelectDependencyFull("selUtiCadDependency",-1,1),systemUserGetUserInfo(t);const n=document.getElementById("divButtonsBar");if(n.innerHTML="","UTICAD"==e||"UDAUTICAD"==e){let e=document.createElement("button");e.setAttribute("class","mainButton labelSearck-RedDark"),e.type="button",e.innerHTML="Procurar utilizador",e.style.marginRight="5px",e.onclick=function(){showDivSearcher("divSearchUser","btUtiProSearchUser")},n.appendChild(e);let t=document.createElement("button");t.setAttribute("class","mainButton labelNew-RedDard"),t.type="button",t.innerHTML="Novo utilizador",t.style.marginRight="5px",t.onclick=function(){systemUserGetUserInfo(-1)},n.appendChild(t)}let s=document.createElement("button");s.setAttribute("class","mainButton labelSave-RedDark"),s.type="button",s.innerHTML="Guardar",s.onclick=function(){systemUserSaveUser("")},n.appendChild(s);let i=document.createElement("button");i.setAttribute("class","mainButton labelPrint-RedDark"),i.type="button",i.onclick=function(){printPageA4("")},n.appendChild(i),systemUserAutocomplete("txtUtiCadUserFullName"),systemUserSetUploadPhoto(),hideNotification()})}function userCheckLicenseLimit(){return!(Number(LICENSE_STATUS.maxusers)>-1&&Number(LICENSE_STATUS.currentUsers)>=Number(LICENSE_STATUS.maxusers))||(showParts("divUtiCadLicenseLimit"),!1)}function systemUserSetUploadPhoto(e=1024e3,t="USER"){var n={1:"JPEG",2:"JPG",3:"PNG"};n=JSON.stringify(n);var s=document.getElementById("divUtiCadUploadPhoto");s.ondragover=s.ondragenter=function(e){e.stopPropagation(),e.preventDefault()},s.ondrop=function(s){s.stopPropagation(),s.preventDefault();for(var i=s.dataTransfer.files,a=0;a<i.length;a++)sendFile(i[a],n,e,t,"pUtiCadUploadMsg","lbUtiCadOldPhoto","lbUtiCadNewPhoto","imgUtiCadPhoto")}}function systemUserGetPermissinList(e){SYSTEM_USER_PERMISSIN_LIST=[];var t="UDAUTICAD"!=SYSTEM_USER_WHO_CALL?"":"GME",n=LICENSE_STATUS.licenselevel,s=new XMLHttpRequest,i="action=getSystemUserPermissionList&&userId="+e+"&target="+t+"&licenseLevel="+n,a=URL_SA_SYSTEM_USER_X;s.open("POST",a,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){const s=document.getElementById("divUtiCadPermissions");s.innerHTML="";var e=document.createElement("tbody"),t=0,n="";JSON.parse(this.responseText).forEach(i=>(function(i){let a=JSON.parse(i);a.permissionCode;let r="class"+a.groupName.replace(/[^0-9\A-z\-]/g,"")+a.permissionGroup;if(SYSTEM_USER_PERMISSIN_LIST[t]=a,t+=1,n!=a.groupName){n=a.groupName;let t=document.createElement("div");s.appendChild(t),t.style.display="flex";let i=document.createElement("button");i.type="button",i.setAttribute("class","smallButtom"),i.innerHTML="+",i.id="bt"+n.replace(/[^0-9\A-z\-]/g,"");let l=document.createElement("legend");l.style.padding="7px 0",l.innerHTML="Permissões para "+n;let o=document.createElement("input");o.type="range",o.min=0,o.max=1,o.name=r,o.value=0,o.onchange=function(){systemUserPerssionGroupChange(this)},"UTIINFO"==SYSTEM_USER_WHO_CALL&&(o.disabled="true"),t.appendChild(i),t.appendChild(l),t.appendChild(o);let d=document.createElement("div");d.id="div"+n.replace(/[^0-9\A-z\-]/g,""),s.appendChild(d);let c=document.createElement("table");c.style.width="100%",d.appendChild(c);let u=document.createElement("thead");u.setAttribute("class","tblHead1"),c.appendChild(u);let m=u.insertRow(-1);m.setAttribute("class","tblTdInvoice");let S=m.insertCell(-1);S.innerHTML="#";let U=m.insertCell(-1);U.innerHTML="Permissão";let p=m.insertCell(-1);p.innerHTML="Nível";let E=m.insertCell(-1);E.innerHTML="Estado",e=document.createElement("tbody"),c.appendChild(e),setSpanHideFieldSet(i.id,d.id)}let l=e.insertRow(-1);l.setAttribute("class","borderGray");let o=l.insertCell(-1);o.setAttribute("class","colRowNumber"),o.innerHTML=t,l.insertCell(-1).innerHTML=a.permissionName;let d=l.insertCell(-1);d.setAttribute("class","colProductId"),d.innerHTML=a.level;let c=l.insertCell(-1),u=document.createElement("input");u.classList.add(r),u.title=a.level,u.type="range",u.id="rangeUtiCadPermissionStatus"+t,u.min=0,u.max=1,u.name=t,u.value=a.permissionstatus,u.onchange=function(){systemUserPermissionChange(u.name)},("UTIINFO"==SYSTEM_USER_WHO_CALL||Number(SYSTEM_USER_STATUS.permissionlevel)<Number(a.level)||!checkPermission("2004"))&&(u.disabled=!0);c.appendChild(u),c.style.textAlign="center",c.style.width="60px"})(i))}},s.send(i)}function systemUserPermissionChange(e){var t=document.getElementById("rangeUtiCadPermissionStatus"+e).value;SYSTEM_USER_PERMISSIN_LIST[Number(e)-1].permissionstatus=t}function systemUserPerssionGroupChange(e){var t=e.name,n=e.value;const s=document.getElementsByClassName(t);Array.prototype.filter.call(s,function(e){Number(e.title)<=Number(SYSTEM_USER_STATUS.permissionlevel)&&(e.value=n,systemUserPermissionChange(e.name))})}function systemUserGetUserInfo(e){try{const i=SYSTEM_USER_STATUS.companyId,a=document.getElementById("txtUtiCadUserId"),r=document.getElementById("txtUtiCadUserFullName"),l=document.getElementById("txtUtiCadUserName"),o=document.getElementById("txtUtiCadUserEmail"),d=document.getElementById("selUtiCadTitle"),c=document.getElementById("txtUtiCadSignCharge"),u=document.getElementById("selUtiCadAccountStatus"),m=document.getElementById("selUtiCadBillingprofile"),S=document.getElementById("selUtiCadDependency"),U=document.getElementById("selUtiCadPermissionLevel");document.getElementById("lbUtiCadOldPhoto").innerHTML="";const p=document.getElementById("lbUtiCadNewPhoto"),E=document.getElementById("imgUtiCadPhoto");if(isNaN(e)&&(e=-1),"UTICAD"!=SYSTEM_USER_WHO_CALL?(u.disabled="true",m.disabled="true",U.disabled="true"):(u.disabled=checkPermission("2002")?"":"true",m.disabled=checkPermission("2003")?"":"true",U.disabled=checkPermission("2004")?"":"true"),Number(e)<1)a.value="Novo utilizador",r.value="",l.value="",o.value="",o.disabled="",u.value=1,d.value=1,c.value="",m.value=1,S.value=-1,U.value=-1,p.innerHTML="",E.src="",r.focus(),dispatchOnInputChange();else{var t="&companyId="+i+"&userId="+e+"&searchLimit=-1&searchTag=",n=new XMLHttpRequest,s="action=getSystemUser"+t;t=URL_SA_SYSTEM_USER_X;n.open("POST",t,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){JSON.parse(this.responseText).forEach(e=>(function(e){let t=JSON.parse(e);a.value=t.id,r.value=t.userfullname,l.value=t.username,o.value=t.email,"UTIINFO"!=SYSTEM_USER_WHO_CALL?1==t.needconfirmemail?o.disabled="":o.disabled="true":o.disabled="";d.value=t.title,c.value=t.sigintitle,u.value=t.accountstatus,m.value=t.billingprofile,S.value=t.workplaceid,U.value=t.permissionlevel;var n=t.photo,s=n.lastIndexOf("/")+1;p.innerHTML=n.substring(s),E.src=n,dispatchOnInputChange()})(e))}},n.send(s)}systemUserGetPermissinList(e),document.getElementById("lbUtiCadUserNameExist").innerHTML=""}catch(e){showNotification(e.message,0)}}function systemUserSaveUser(e){try{var t="UDAUTICAD"!=SYSTEM_USER_WHO_CALL?"":"UDAOX",n=SYSTEM_USER_STATUS.companyId,s=new _user;s.uId=document.getElementById("txtUtiCadUserId").value;var i=document.getElementById("txtUtiCadUserFullName");if(s.uFullName=reviewString(i).toString().toLocaleUpperCase(),s.email=reviewEmail(document.getElementById("txtUtiCadUserEmail").value),s.uName=s.email,s.accountstatus=document.getElementById("selUtiCadAccountStatus").value,s.uTle=document.getElementById("selUtiCadTitle").value,s.uTleSign=document.getElementById("txtUtiCadSignCharge").value,s.bProfile=document.getElementById("selUtiCadBillingprofile").value,s.pLevel=document.getElementById("selUtiCadPermissionLevel").value,s.workplaceid=document.getElementById("selUtiCadDependency").value,s.companyId=n,s.photo=document.getElementById("lbUtiCadNewPhoto").innerHTML,s.sourceid=SYSTEM_USER_STATUS.userId,"UDAUTICAD"!=SYSTEM_USER_WHO_CALL&&isNaN(s.uId)&&0==userCheckLicenseLimit())return!1;var a=!1,r="";if(""==s.userFullName&&(a=!0,r="Deve indicar o nome completo. <br>"),""==s.email?(a=!0,r+="Deve indicar o email. <br>"):validateEmail(s.email)||(a=!0,r+="Email fora do formato. <br>"),1==ST_SA_WAITING_SERVER&&(a=!0,r+="Aguardando resposta do servidor. <br>"),a)return alert(r),!1;var l="&userInfo="+JSON.stringify(s);l+="&userPermissions={";var o=0;SYSTEM_USER_PERMISSIN_LIST.forEach(e=>(function(e){0!=o&&(l+=",");l+='"'+o+'":{"pC":"'+e.permissionCode+'","pS":"'+e.permissionstatus+'"}',o+=1})(e)),l+="}",showNotification(),ST_SA_WAITING_SERVER=1;var d=new XMLHttpRequest,c="action=saveSystemUser"+l+"&target="+t;l=URL_SA_SYSTEM_USER_X;d.open("POST",l,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){ST_SA_WAITING_SERVER=0;var e=JSON.parse(this.responseText);1==e.result?("UTIINFO"==SYSTEM_USER_WHO_CALL?systemUserGetUserInfo(s.userId):systemUserOnLoad(SYSTEM_USER_WHO_CALL,-1),alert(e.msg),systemUserAutocomplete("txtUtiCadUserFullName"),systemUserAutocomplete("txtUtiProSearchUser")):showNotification(e.msg,0)}},d.send(c)}catch(e){showNotification(e.message,0)}}var USERNAME_STATUS=0,USERNAME_TRYING=0;function systemUserCreateUserName(e){var t=document.getElementById("txtUtiCadUserId"),n=document.getElementById("txtUtiCadUserName"),s=reviewString(document.getElementById("txtUtiCadUserFullName")),i=reviewString(n);if(""==i){var a=s.toString().split(" ");i=(i=a.length<=1?s:a[0]+"."+a[a.length-1]).toLowerCase(),isNaN(i)||(i="u"+i),USERNAME_STATUS=0;var r=0,l=i;systemUserCheckUserName(t,i),function e(){1==USERNAME_TRYING?setTimeout(function(){e()},1e3):1==USERNAME_STATUS?n.value=i:r>=11?n.value=i:(systemUserCheckUserName(t,i=l+(r+=1)),setTimeout(function(){e()},1e3))}()}}function systemUserCheckUserName(e,t){var n=document.getElementById("txtUtiCadUserId"),s=document.getElementById("txtUtiCadUserName"),i=document.getElementById("lbUtiCadUserNameExist");""==e&&(e=n.value),""==t&&(t=s.value),""==(t=reviewString(t))&&(i.innerHTML="Nome do utlizador em branco".italics()),t=t.toString().toLowerCase(),USERNAME_TRYING=1;var a=new XMLHttpRequest,r="action=checkSystemUserUsername&&userId="+e+"&&userName="+t,l=URL_SA_SYSTEM_USER_X;a.open("POST",l,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=JSON.parse(this.responseText);return i.innerHTML=e.msg.italics(),USERNAME_STATUS=e.result,USERNAME_TRYING=0,e.result}},a.send(r)}function systemUserResetPassOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){document.getElementById("txtUtiPassUserId").value=SYSTEM_USER_STATUS.userId,document.getElementById("txtUtiPassUserFullName").value=SYSTEM_USER_STATUS.userFullName,hideNotification()})}function systemUserResetPassSave(e,t=""){var n=document.getElementById("txtUtiPassUserId").value,s=document.getElementById("txtUtiPassOldPass").value,i=document.getElementById("txtUtiPassNewPass").value,a=document.getElementById("txtUtiPassNewPassRepit").value,r=!1,l="";if(""==s&&(r=!0,l="Deve indicar a antiga palavra-passe. <br>"),i.length<6&&(r=!0,l+="A nova palavra-passe deve ter no mínimo 6 caracteres. <br>"),""==a&&(r=!0,l+="Deve repitir a nova palavra-passe. <br>"),i!=a&&(r=!0,l+="Nova palavra-passe não combina. <br>"),1==ST_SA_WAITING_SERVER&&(r=!0,l+="Aguardando resposta do servidor. <br>"),r)return alert(l),!1;showNotification(),ST_SA_WAITING_SERVER=1;var o="&userId="+n+"&oldPass="+s+"&newPass="+i,d=new XMLHttpRequest,c="action=saveSystemUserResetPassWord"+o;o=URL_SA_SYSTEM_USER_X;d.open("POST",o,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){4==d.readyState&&200==d.status&&(ST_SA_WAITING_SERVER=0,1==d.responseText?(showNotification("Palavra passe alterada com sucesso.",1),"INITPAG"==e&&hideParts(t)):showNotification("Antiga palavra-passe inválida.",0))},d.send(c)}function fillSelectSystemUserTitle(e){const t=document.getElementById(e);if(null!==t){t.innerHTML="";for(var n=1;n<SYSTEM_USER_TITLE.length;n++){let e=document.createElement("option");e.value=n,e.innerHTML=SYSTEM_USER_TITLE[n],t.appendChild(e)}}}function fillSelectSystemUserBillingProfile(e){const t=document.getElementById(e);if(null!==t){t.innerHTML="";var n=document.createElement("option");n.value="-1",n.setAttribute("class","selectPlaceHolder"),n.innerHTML="Seleccionar",t.appendChild(n),SYSTEM_USER_BILLING_PROFILE.forEach(function(e,n){if(Number(n)>0){let s=document.createElement("option");s.value=n,s.innerHTML=e,t.appendChild(s)}})}}function fillSelectSystemUserPermissionLevel(e){const t=document.getElementById(e);if(null!==t){t.innerHTML="",t.innerHTML="";var n=document.createElement("option");n.value="-1",n.setAttribute("class","selectPlaceHolder"),n.innerHTML="Seleccionar",t.appendChild(n);var s=Number(SYSTEM_USER_STATUS.permissionlevel);if(s>0)for(var i=1;i<=s;i++){let e=document.createElement("option");e.value=i,e.innerHTML="Nível "+i,t.appendChild(e)}}}function systemUserListOnLoad(e){function t(){cleanElement("tblUtiLisDetailsTable"),cleanElement("tblUtiLisResumeTable"),setTriggerButtonByText("txtUtiLisInitialDate","btUTILISViewAll"),setTriggerButtonByText("txtUtiLisEndDate","btUTILISViewAll"),systemUserListDetails(""),document.getElementById("lbResultOnList").innerHTML=0}showNotification(),checkUserStatusAfterExecute(function(){setSystemUserBillingProfile(""),fillSelectSystemUserBillingProfile("selUtiLisBillingprofile"),fillSelectSystemUserPermissionLevel("selUtiLisPermissionLevel"),document.getElementById("txtUtiLisInitialDate").onchange=function(){t()},document.getElementById("txtUtiLisEndDate").onchange=function(){t()},document.getElementById("selUtiLisBillingprofile").onchange=function(){t()},document.getElementById("selUtiLisPermissionLevel").onchange=function(){t()},hideNotification()})}function systemUserListDetails(e){try{var t=SYSTEM_USER_STATUS.companyId,n=document.getElementById("txtUtiLisInitialDate").value,s=document.getElementById("txtUtiLisEndDate").value,i=document.getElementById("selUtiLisBillingprofile").value,a=document.getElementById("selUtiLisPermissionLevel").value;showNotification();var r=new XMLHttpRequest,l="action=getSystemUserListDetails&companyId="+t+"&initialDate="+n+"&endDate="+s+"&billingProfile="+i+"&permissionLevel="+a,o=URL_SA_SYSTEM_USER_X;r.open("POST",o,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e={},t={},n={},s=JSON.parse(this.responseText);s.length<=0?showNotification("Não encontrado.",0):hideDivFilter(),document.getElementById("lbResultOnList").innerHTML=s.length;let r=document.getElementById("tblUtiLisDetailsTable");r.innerHTML="";var i=0;s.forEach(s=>(function(s){let a=JSON.parse(s);var l=getFirtLastName(a.operatorName)+" ("+a.sourceid+")",o=SYSTEM_USER_BILLING_PROFILE[a.billingprofile],d=Number(a.permissionlevel)<=0?"":"Nível "+a.permissionlevel;1,addAmountResume(e,l,1),addAmountResume(t,o,1),addAmountResume(n,d,1),i+=1;let c=r.insertRow(-1);c.setAttribute("class","borderGray");let u=c.insertCell(c.cells.length);u.setAttribute("class","colRowNumber"),u.innerHTML=i;let m=c.insertCell(c.cells.length);if(""!=a.photo){let e=document.createElement("img");e.setAttribute("class","imgOnList"),e.src=a.photo,m.appendChild(e)}let S=c.insertCell(c.cells.length);S.setAttribute("class","colProductId"),S.innerHTML=a.id,c.insertCell(c.cells.length).innerHTML=a.userfullname,c.insertCell(c.cells.length).innerHTML=a.username,c.insertCell(c.cells.length).innerHTML=a.email,c.insertCell(c.cells.length).innerHTML=o,c.insertCell(c.cells.length).innerHTML=d,c.insertCell(c.cells.length).innerHTML=l;let U=c.insertCell(c.cells.length);U.setAttribute("class","colProductId"),U.innerHTML=setLocalDate(a.entrydate,10)})(s));var a=document.getElementById("tblUtiLisResumeTable");for(var l in a.innerHTML="",i=0,e)i+=1,resume(a,i,"Cadastrante",e,l,"Cadastrados");for(var l in i=0,t)i+=1,resume(a,i,"Perfil de facturação",t,l,"Cadastrados");for(var l in i=0,n)i+=1,resume(a,i,"Nível de permissão",n,l,"Cadastrados");hideNotification()}},r.send(l)}catch(e){showNotification(e.message,0)}}function systemUserRestartPassOnLoad(e){showNotification(),checkUserStatusAfterExecute(function(){setSystemUserBillingProfile(""),hideNotification()})}function systemUserRestartPassListDetails(e=-1){try{var t=SYSTEM_USER_STATUS.companyId;showNotification();var n=new XMLHttpRequest,s="action=getSystemUserRestartPassListDetails&companyId="+t+"&userId="+e,i=URL_SA_SYSTEM_USER_X;n.open("POST",i,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(this.responseText);e.length<=0&&showNotification("Não encontrado.",0),document.getElementById("lbResultOnList").innerHTML=e.length;let n=document.getElementById("tblUtiReinPassDetailsTable");n.innerHTML="";var t=0;e.forEach(e=>(function(e){let s=JSON.parse(e);t+=1;let i=n.insertRow(-1);i.setAttribute("class","borderGray");let a=i.insertCell(i.cells.length);a.setAttribute("class","colRowNumber"),a.innerHTML=t;let r=i.insertCell(i.cells.length);r.setAttribute("class","colProductId"),r.innerHTML=s.userid,i.insertCell(i.cells.length).innerHTML=s.userfullname;let l=i.insertCell(i.cells.length);l.style.textAlign="center",l.innerHTML=setLocalDate(s.entrydate,10);let o=i.insertCell(i.cells.length);const d=s.requeststatus;o.innerHTML=1==d?"Feito":"Aguarda decisão";let c=i.insertCell(i.cells.length);1==d&&(c.innerHTML=setLocalDate(s.attendencedate,10));i.insertCell(i.cells.length).innerHTML=getFirtLastName(s.operatorName)+" ("+s.attendenceuserid+")";let u=i.insertCell(i.cells.length);if(0==d){let e=document.createElement("button");e.type="button",e.innerHTML="Reiniciar";const t=s.requestid;e.onclick=function(){systemUserRestartPass(t)},u.appendChild(e)}})(e)),hideNotification()}},n.send(s)}catch(e){showNotification(e.message,0)}}function systemUserRestartPass(e){var t=SYSTEM_USER_STATUS.userId,n=new XMLHttpRequest,s="action=saveSystemUserRestartPass&requestId="+e+"&sourceId="+t,i=URL_SA_SYSTEM_USER_X;n.open("POST",i,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(n.responseText);alert(e.msg),1==e.status&&systemUserRestartPassListDetails()}},n.send(s)}function systemUserSelfRegisterOnLoad(e){document.getElementById("txtUtiCadUserFullName").value="",document.getElementById("txtUtiCadUserName").value="",document.getElementById("txtUtiCadUserEmail").value="",document.getElementById("txtUtiCadNewPass").value="",document.getElementById("txtUtiCadPassRepit").value="",document.getElementById("txtUtiCadUserFullName").focus()}function systemUserSelfRegisterSave(){try{var e=reviewString(document.getElementById("txtUtiCadUserFullName")).toString().toUpperCase(),t=reviewEmail(document.getElementById("txtIndReqUserEmail").value),n=t,s=reviewString(document.getElementById("txtIndReqPhone1")).replace(/[^0-9\-]/g,""),i=document.getElementById("txtIndReqNewPass").value,a=document.getElementById("txtIndReqPassRepit").value,r=getCookie("recomendationUser");isNaN(r)&&(r=-1);var l=!1,o="";if(""==e&&(l=!0,o="Deve indicar o nome completo. <br>"),""==t?(l=!0,o+="Deve indicar o email. <br>"):validateEmail(t)||(l=!0,o+="Email fora do formato. <br>"),""==s&&(l=!0,o+="Deve indicar o contacto telefónico. <br>"),i.length<6&&(l=!0,o+="A palavra passe deve ter no mínimo 6 caracteres. <br>"),i!=a&&(l=!0,o+="Palavra passe não combina com a repetição. <br>"),l)return alert(o),!1;var d=new XMLHttpRequest,c="action=saveSystemUserSelfRegister&silicaUser="+r+"&userFullName="+e+"&userName="+n+"&email="+t+"&phone="+s+"&pass="+i,u=URL_SA_SYSTEM_USER_X;d.open("POST",u,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var e=JSON.parse(this.responseText);1==e.status?(showNotification("Utilizador cadastrado com sucesso.",1),showParts("divIndReqAboutBusiness"),hideParts("divIndReqAboutUser"),sessionStorage.setItem("silicawebIndReqCompanyId",e.nus)):showNotification(e.msg,0)}},d.send(c)}catch(e){alert(e.message)}}function systemUserGetPermissinList_old(e){SYSTEM_USER_PERMISSIN_LIST=[];var t="UDAUTICAD"!=SYSTEM_USER_WHO_CALL?"":"GME",n=LICENSE_STATUS.licenselevel,s=new XMLHttpRequest,i="action=getSystemUserPermissionList&&userId="+e+"&target="+t+"&licenseLevel="+n,a=URL_SA_SYSTEM_USER_X;s.open("POST",a,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){let n=document.getElementById("tblUtiCadPermissionTable");n.innerHTML="";var e=0,t="";JSON.parse(this.responseText).forEach(s=>(function(s){let i=JSON.parse(s);i.permissionCode;SYSTEM_USER_PERMISSIN_LIST[e]=i,e+=1;let a=n.insertRow(-1);a.setAttribute("class","borderGray");let r=a.insertCell(0);r.setAttribute("class","colRowNumber"),r.innerHTML=e;let l=a.insertCell(1);l.innerHTML="",t!=i.groupName&&(l.innerHTML=i.groupName.toString().bold(),t=i.groupName);a.insertCell(2).innerHTML=i.permissionName;let o=a.insertCell(3);o.setAttribute("class","colProductId"),o.innerHTML=i.level;let d=a.insertCell(4),c=document.createElement("input");c.type="range",c.id="rangeUtiCadPermissionStatus"+e,c.min=0,c.max=1,c.name=e,c.value=i.permissionstatus,c.onchange=function(){systemUserPermissionChange(selStatus.name)},("UTIINFO"==SYSTEM_USER_WHO_CALL||Number(SYSTEM_USER_STATUS.permissionlevel)<Number(i.level)||!checkPermission("2004"))&&(c.disabled=!0);d.appendChild(c),d.style.textAlign="center",d.style.width="60px"})(s))}},s.send(i)}function systemUserDashBordOnLoad(){showNotification(),checkUserStatusAfterExecute(function(){systemUserDashBordLoadInfo(),hideNotification()})}function systemUserDashBordLoadInfo(){systemUserDashBordGetInterest(),systemUserDashBordGetOrders(),systemUserDashBordGetSales(),systemUserDashBordGetComissions()}function systemUserDashBordGetInterest(){var e=SYSTEM_USER_STATUS.companyId,t=SYSTEM_USER_STATUS.userId,n=document.getElementById("txtUDSBdInitialDate").value,s=document.getElementById("txtUDSBdEndDate").value;const i=document.getElementById("divUDSBdInterest");if(5e3!=e)return i.style.display="none",!1;i.style.display="inline",showNotification();var a=new XMLHttpRequest,r="action=getSystemUserSilicaInterest&&userId="+t+"&initialDate="+n+"&endDate="+s,l=URL_SA_SYSTEM_USER_X;a.open("POST",l,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(a.responseText).interests;animateValue(document.getElementById("lbUDSBdInterestQuant"),0,e,2),hideNotification()}},a.send(r)}function systemUserDashBordGetOrders(){var e=SYSTEM_USER_STATUS.companyId,t=SYSTEM_USER_STATUS.userId,n=document.getElementById("txtUDSBdInitialDate").value,s=document.getElementById("txtUDSBdEndDate").value;showNotification();var i=new XMLHttpRequest,a="action=getSystemUserOrdersSales&companyId="+e+"&userId="+t+"&initialDate="+n+"&endDate="+s+"&type=W",r=URL_SA_SYSTEM_USER_X;i.open("POST",r,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(i.responseText),t=e.quantity,n=e.amount;animateValue(document.getElementById("lbUDSBdOrderQuant"),0,t,2),animateValue(document.getElementById("lbUDSBdOrderAmount"),0,n,2,!0),hideNotification()}},i.send(a)}function systemUserDashBordGetSales(){var e=SYSTEM_USER_STATUS.companyId,t=SYSTEM_USER_STATUS.userId,n=document.getElementById("txtUDSBdInitialDate").value,s=document.getElementById("txtUDSBdEndDate").value;showNotification();var i=new XMLHttpRequest,a="action=getSystemUserOrdersSales&companyId="+e+"&userId="+t+"&initialDate="+n+"&endDate="+s+"&type=I",r=URL_SA_SYSTEM_USER_X;i.open("POST",r,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(i.responseText),t=e.quantity,n=e.amount;animateValue(document.getElementById("lbUDSBdSaleQuant"),0,t,2),animateValue(document.getElementById("lbUDSBdSaleAmount"),0,n,2,!0),hideNotification()}},i.send(a)}function systemUserDashBordGetComissions(){var e=SYSTEM_USER_STATUS.companyId,t=SYSTEM_USER_STATUS.userId,n=document.getElementById("txtUDSBdInitialDate").value,s=document.getElementById("txtUDSBdEndDate").value;showNotification();var i=new XMLHttpRequest,a="action=getSystemUserComissions&companyId="+e+"&userId="+t+"&initialDate="+n+"&endDate="+s,r=URL_SA_SYSTEM_USER_X;i.open("POST",r,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(i.responseText),t=e.quantity,n=e.amount;animateValue(document.getElementById("lbUDSBdComissionQuant"),0,t,2),animateValue(document.getElementById("lbUDSBdComissionAmount"),0,n,2,!0),hideNotification()}},i.send(a)}function systemUserPromotionSilicaOnLoad(e="U"){showNotification(),checkUserStatusAfterExecute(function(){"U"==e?(hideParts("btPromoSilViewAll"),hideParts("btPromoSilSearchUser"),systemUserPromotionSilicaList(SYSTEM_USER_STATUS.userId)):systemUserPromotionSilicaList(),hideNotification()})}var PROMOTION_SILICA_LIST=[];function systemUserPromotionSilicaList(e=-1,t=!1){t||hideParts("btPromoSilSave"),showNotification(),PROMOTION_SILICA_LIST=[];var n=new XMLHttpRequest,s="action=getSystemUserPromotionSilica&userId="+e,i=URL_SA_SYSTEM_USER_X;n.open("POST",i,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(this.responseText);e.length<=0&&showNotification("Não encontrado.",0),document.getElementById("lbResultOnList").innerHTML=e.length;let n=document.getElementById("tblPromoSilDetailsTable");n.innerHTML="";var s=0;e.forEach(e=>(function(e){let i=JSON.parse(e);PROMOTION_SILICA_LIST[s]=i,s+=1;let a=n.insertRow(-1);a.setAttribute("class","borderGray");let r=a.insertCell(-1);r.setAttribute("class","colRowNumber"),r.innerHTML=s;let l=a.insertCell(-1);l.innerHTML=i.userfullname,l.style.width="200px";let o=a.insertCell(-1);o.innerHTML=i.socialnetwork,o.style.width="70px";let d=a.insertCell(-1),c=document.createElement("input");c.type="text",c.id="txtPromoSilLink"+s,c.value=i.fulllink,c.onchange=function(){PROMOTION_SILICA_LIST[Number(s)-1].fulllink=this.value},t||c.setAttribute("readonly",!0);d.appendChild(c);let u=a.insertCell(-1),m=document.createElement("button");m.type="button",m.innerHTML="Copiar",m.onclick=function(){c.select(),c.setSelectionRange(0,99999),document.execCommand("copy")},u.appendChild(m),u.style.width="30px"})(e)),hideNotification()}},n.send(s)}function systemUserPromotionSilicaSaveLinks(){var e="&links={",t=0;PROMOTION_SILICA_LIST.forEach(n=>(function(n){0!=t&&(e+=",");e+='"'+t+'":'+JSON.stringify(n),t+=1})(n)),e+="}";var n=new XMLHttpRequest,s="action=saveSystemUserPromotionSilica"+e;e=URL_SA_SYSTEM_USER_X;n.open("POST",e,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(this.responseText);1==e.status?showNotification(e.msg,1):showNotification(e.msg,0)}},n.send(s)}function systemUserListLogedOnLoad(){showNotification(),checkUserStatusAfterExecute(function(){fillSelectDependencyFull("selUserLisLogDependency",-1,1),setTriggerButtonByText("txtUserLisLogInitialDate","btUserLisLogViewAll"),setTriggerButtonByText("txtUserLisLogInitialDate","btUserLisLogViewAll"),hideNotification()})}function systemUserListLogedList(){try{var e={};e.companyId=SYSTEM_USER_STATUS.companyId,e.dependencyId=getElementValue("selUserLisLogDependency"),e.initialDate=document.getElementById("txtUserLisLogInitialDate").value,e.endDate=document.getElementById("txtUserLisLogEndDate").value,e.onlynumber=1,e.startIdx=0,e.endIdx=0,showNotification();var t=new XMLHttpRequest,n="action=getSystemUserLogedList&filterInfo="+JSON.stringify(e),s=URL_SA_SYSTEM_USER_X;t.open("POST",s,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){try{var n=JSON.parse(this.responseText)}catch(e){showHttpResponseText(t)}var s=n.n;s<=0?showNotification("Não encontrado.",0):hideDivFilter();var i=document.getElementById("numResultPageNumber"),a=document.getElementById("numResultItems");function r(){var t=Number(i.value),n=Number(a.value),r=(t-1)*n,l=r+n;l>s&&(l=s),e.totalItems=s,e.startIdx=r,e.endIdx=l,e.onlynumber=0,systemUserListLogedListFilter(e)}i.value=1,setResultTotalPages(i.id,a.id,s),i.onchange=function(){r()},a.onchange=function(){setResultTotalPages(i.id,a.id,s),r()},r()}},t.send(n)}catch(e){showNotification(e.message,0)}}function systemUserListLogedListFilter(e){var t=document.getElementById("tblUserLisLogDetailsTable");t.innerHTML="",showNotification();var n=new XMLHttpRequest,s="action=getSystemUserLogedList&filterInfo="+JSON.stringify(e),i=URL_SA_SYSTEM_USER_X;n.open("POST",i,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){try{var s=JSON.parse(this.responseText)}catch(e){showHttpResponseText(n)}setElementInnerHtml("lbResultOnList",e.endIdx+" / "+e.totalItems);for(var i={},a=e.startIdx,r=0;r<s.length;r++){var l=s[r];let e=JSON.parse(l);var o=e.idaddress;addAmountResume(i,o,1),a+=1;let n=t.insertRow(-1);n.setAttribute("class","borderGray");let d=n.insertCell(n.cells.length);d.setAttribute("class","colRowNumber"),d.innerHTML=a;let c=n.insertCell(n.cells.length);c.setAttribute("class","colProductId"),c.innerHTML=e.id,n.insertCell(n.cells.length).innerHTML=e.userfullname,n.insertCell(n.cells.length).innerHTML=o;let u=n.insertCell(n.cells.length);u.setAttribute("class","text-align-center"),u.innerHTML=setLocalDate(e.sessiontime,16);let m=n.insertCell(n.cells.length);m.setAttribute("class","text-align-center"),m.innerHTML=setLocalDate(e.sessionouttime,16);let S=n.insertCell(n.cells.length);S.setAttribute("class","text-align-center"),S.innerHTML=e.sessinduration,1==e.onlinestatus&&(S.style.backgroundColor="lightgreen")}var d=document.getElementById("tblUserLisLogResumeTable");for(var l in d.innerHTML="",a=0,i)a+=1,resume(d,a,"Endereço IP",i,l,"Acessos");hideNotification()}},n.send(s)}